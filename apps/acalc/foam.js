function FEATURE_ENABLED(labels){for(var i=0;i<labels.length;i++)if(FLAGS[labels[i]])return!0}function MODEL(model){function defineProperty(proto,key,map){map.value&&proto!==Object.prototype&&proto!==Array.prototype?proto[key]=map.value:Object.defineProperty_.apply(this,arguments)}var proto
if(model.name?(GLOBAL[model.name]||(model.extendsModel?GLOBAL[model.name]={__proto__:GLOBAL[model.extendsModel]}:GLOBAL[model.name]={}),proto=GLOBAL[model.name]):proto=model.extendsProto?GLOBAL[model.extendsProto].prototype:GLOBAL[model.extendsObject],model.properties)for(var i=0;i<model.properties.length;i++){var p=model.properties[i]
defineProperty(proto,p.name,{get:p.getter,enumerable:!1})}for(key in model.constants)defineProperty(proto,key,{value:model.constants[key],writable:!0,enumerable:!1})
if(Array.isArray(model.methods))for(var i=0;i<model.methods.length;i++){var m=model.methods[i]
defineProperty(proto,m.name,{value:m,writable:!0,enumerable:!1})}else for(var key in model.methods)defineProperty(proto,key,{value:model.methods[key],writable:!0,enumerable:!1})}function prep(arg){return"string"==typeof arg?literal(arg):arg}function prepArgs(args){for(var i=0;i<args.length;i++)args[i]=prep(args[i])
return args}function range(c1,c2){var f=function(ps){return ps.head?ps.head<c1||ps.head>c2?void 0:ps.tail.setValue(ps.head):void 0}
return f.toString=function(){return"range("+c1+", "+c2+")"},f}function literal(str,opt_value){var f=function(ps){for(var i=0;i<str.length;i++,ps=ps.tail)if(str.charAt(i)!==ps.head)return void 0
return ps.setValue(opt_value||str)}
return f.toString=function(){return'"'+str+'"'},f}function literal_ic(str,opt_value){str=str.toLowerCase()
var f=function(ps){for(var i=0;i<str.length;i++,ps=ps.tail)if(!ps.head||str.charAt(i)!==ps.head.toLowerCase())return void 0
return ps.setValue(opt_value||str)}
return f.toString=function(){return'"'+str+'"'},f}function anyChar(ps){return ps.head?ps.tail:void 0}function notChar(c){return function(ps){return ps.head&&ps.head!==c?ps.tail.setValue(ps.head):void 0}}function notChars(s){return function(ps){return ps.head&&-1==s.indexOf(ps.head)?ps.tail.setValue(ps.head):void 0}}function not(p,opt_else){p=prep(p),opt_else=prep(opt_else)
var f=function(ps){return this.parse(p,ps)?void 0:opt_else?this.parse(opt_else,ps):ps}
return f.toString=function(){return"not("+p+")"},f}function optional(p){p=prep(p)
var f=function(ps){return this.parse(p,ps)||ps.setValue(void 0)}
return f.toString=function(){return"optional("+p+")"},f}function copyInput(p){p=prep(p)
var f=function(ps){var res=this.parse(p,ps)
return res?res.setValue(ps.str_.toString().substring(ps.pos,res.pos)):res}
return f.toString=function(){return"copyInput("+p+")"},f}function lookahead(p){p=prep(p)
var f=function(ps){return this.parse(p,ps)&&ps}
return f.toString=function(){return"lookahead("+p+")"},f}function repeat(p,opt_delim,opt_min,opt_max){p=prep(p),opt_delim=prep(opt_delim)
var f=function(ps){for(var ret=[],i=0;!opt_max||opt_max>i;i++){var res
if(opt_delim&&0!=ret.length){if(!(res=this.parse(opt_delim,ps)))break
ps=res}if(!(res=this.parse(p,ps)))break
ret.push(res.value),ps=res}return opt_min&&ret.length<opt_min?void 0:ps.setValue(ret)}
return f.toString=function(){return"repeat("+p+", "+opt_delim+", "+opt_min+", "+opt_max+")"},f}function plus(p){return repeat(p,void 0,1)}function noskip(p){return function(ps){return this.skip_=!1,ps=this.parse(p,ps),this.skip_=!0,ps}}function repeat0(p){return p=prep(p),function(ps){for(var res;res=this.parse(p,ps);)ps=res
return ps.setValue("")}}function seq(){var args=prepArgs(arguments),f=function(ps){for(var ret=[],i=0;i<args.length;i++){if(!(ps=this.parse(args[i],ps)))return void 0
ret.push(ps.value)}return ps.setValue(ret)}
return f.toString=function(){return"seq("+argsToArray(args).join(",")+")"},f}function seq1(n){var args=prepArgs(argsToArray(arguments).slice(1)),f=function(ps){for(var ret,i=0;i<args.length;i++){if(!(ps=this.parse(args[i],ps)))return void 0
i==n&&(ret=ps.value)}return ps.setValue(ret)}
return f.toString=function(){return"seq1("+n+", "+argsToArray(args).join(",")+")"},f}function invalidateParsers(){parserVersion_++}function simpleAlt(){var args=prepArgs(arguments)
if(1==args.length)return args[0]
var f=function(ps){for(var i=0;i<args.length;i++){var res=this.parse(args[i],ps)
if(res)return res}return void 0}
return f.toString=function(){return"alt("+argsToArray(args).join(" | ")+")"},f}function alt(){function nullParser(){return void 0}function testParser(p,ps){var trapPS=TrapPStream.create(ps)
return this.parse(p,trapPS),trapPS.goodChar}function getParserForChar(ps){var c=ps.head,p=map[c]
if(!p){for(var alts=[],i=0;i<args.length;i++){var parser=args[i]
testParser.call(this,parser,ps)&&alts.push(parser)}p=0==alts.length?nullParser:1==alts.length?alts[0]:simpleAlt.apply(null,alts),map[c]=p}return p}var SIMPLE_ALT=simpleAlt.apply(null,arguments),args=prepArgs(arguments),map={},parserVersion=parserVersion_
return function(ps){parserVersion!==parserVersion_&&(map={},parserVersion=parserVersion_)
var r1=this.parse(getParserForChar.call(this,ps),ps)
return r1}}function str(p){p=prep(p)
var f=function(ps){var ps=this.parse(p,ps)
return ps?ps.setValue(ps.value.join("")):void 0}
return f.toString=function(){return"str("+p+")"},f}function pick(as,p){p=prep(p)
var f=function(ps){var ps=this.parse(p,ps)
if(!ps)return void 0
for(var ret=[],i=0;i<as.length;i++)ret.push(ps.value[as[i]])
return ps.setValue(ret)}
return f.toString=function(){return"pick("+as+", "+p+")"},f}function parsedebug(p){return function(ps){var old=DEBUG_PARSE
DEBUG_PARSE=!0
var ret=this.parse(p,ps)
return DEBUG_PARSE=old,ret}}function sym(name){var f=function(ps){var p=this[name]
return p||console.log("PARSE ERROR: Unknown Symbol <"+name+">"),this.parse(p,ps)}
return f.toString=function(){return"<"+name+">"},f}function defineTTLProperty(obj,name,ttl,f){obj.__defineGetter__(name,function(){var accessed,value=void 0
return this.__defineGetter__(name,function(){function scheduleTimer(){setTimeout(function(){accessed?scheduleTimer():value=void 0,accessed=!1},ttl)}return value?accessed=!0:(accessed=!1,value=f(),scheduleTimer()),value}),this[name]})}function lookup(key){if(!key)return void 0
if("string"!=typeof key)return key
var root=this,cache
cache=this.lookupCache_
var ret=cache[key]
if(void 0===ret){for(var path=key.split("."),i=0;root&&i<path.length;i++)root=root[path[i]]
ret=root,cache[key]=ret?ret:null}return ret}function set(key,value){Object.defineProperty(this,key,{value:value,writable:"window"!==key,configurable:!0})}function setValue(key,value){var X=this
Object.defineProperty(this,key,{get:function(){return X.set(key,value.get()),X[key]},configurable:!0})}function sub(opt_args,opt_name){var sub=Object.create(this)
if(opt_args)for(var key in opt_args)opt_args.hasOwnProperty(key)&&sub.set(key,opt_args[key])
return opt_name&&(sub.NAME=opt_name),sub}function subWindow(w,opt_name,isBackground){return w?foam.ui.Window.create({window:w,name:opt_name,isBackground:isBackground},this).Y:this.sub()}function elementFromString(str){return str.element||(str.element=HTMLParser.create().parseString(str).children[0])}function $addWindow(w){w.window.$WID=$WID__++,$documents.push(w.document)}function $removeWindow(w){for(var i=$documents.length-1;i>=0;i--)$documents[i].defaultView&&$documents[i].defaultView!==w||$documents.splice(i,1)}function packagePath(X,path){function packagePath_(Y,path,i){return i===path.length?Y:(Y[path[i]]||(Y[path[i]]={},0==i&&(GLOBAL[path[i]]=Y[path[i]])),packagePath_(Y[path[i]],path,i+1))}return path?packagePath_(X,path.split("."),0):GLOBAL}function registerModel(model,opt_name,fastMode){var root=model["package"]?this:GLOBAL,name=model.name,package=model["package"]
if(opt_name){var a=opt_name.split(".")
name=a.pop(),package=a.join(".")}var modelRegName=(package?package+".":"")+name
if(root===GLOBAL||root===X){var path=packagePath(root,package)
fastMode?path[name]=model:Object.defineProperty(path,name,{value:model,configurable:!0})}Object.hasOwnProperty.call(this,"lookupCache_")||(this.lookupCache_=Object.create(this.lookupCache_||Object.prototype)),this.lookupCache_[modelRegName]=model,this.onRegisterModel(model)}function INTERFACE(imodel){var i=JSONUtil.mapToObj(X,imodel,Interface)
packagePath(X,i["package"])[i.name]=i
var id=i["package"]?i["package"]+"."+i.name:i.name
NONMODEL_INSTANCES[id]=!0}function onRegisterModel(m){}function defineLocalProperty(cls,name,factory){Object.defineProperty(cls,name,{get:function(){console.assert(this!==cls,"Called property getter from prototype: "+name)
var value=factory.call(this)
return Object.defineProperty(this,name,{configurable:!0,value:value}),value},configurable:!0})}function override(cls,methodName,method){var super_=cls[methodName],SUPER=function(){return super_.apply(this,arguments)},slowF=function(OLD_SUPER,args){try{return method.apply(this,args)}finally{this.SUPER=OLD_SUPER}},f=function(){var OLD_SUPER=this.SUPER
if(this.SUPER=SUPER,OLD_SUPER)return slowF.call(this,OLD_SUPER,arguments)
var ret=method.apply(this,arguments)
return this.SUPER=null,ret}
f.toString=function(){return method.toString()},f.super_=super_,cls[methodName]=f}function recopyModelFeatures(m){m.model_=Model,m.methods=m.methods,m.relationships=m.relationships,m.properties=m.properties,m.models=m.models,DEBUG&&(m.tests=m.tests,m.issues=m.issues),m.properties&&m.properties[0]&&"Model"!==m.properties[0].__proto__.model_.name_&&m.properties.forEach(function(p){"Property"===p.__proto__.model_.name&&(p.__proto__=Property.getPrototype())}),DEBUG&&BootstrapModel.saveDefinition(m)}function or$(values,factory,opt_X){return OrValue.create({values:values,valueFactory:factory},opt_X)}function toNum(p){return p.replace?parseInt(p.replace("px","")):p}function E(opt_nodeName){var e=foam.u2.Element.create()
return opt_nodeName&&(e.nodeName=opt_nodeName),e}function atxn(afunc){return function(ret){if(GLOBAL.__TXN__)afunc.apply(this,arguments)
else{GLOBAL.__TXN__={}
var a=argsToArray(arguments)
a[0]=function(){GLOBAL.__TXN__=void 0,ret()},afunc.apply(this,a)}}}function gamma(z){return Math.sqrt(2*Math.PI/z)*Math.pow(1/Math.E*(z+1/(12*z-1/(10*z))),z)}function trigFn(f){return function(a){return f(this.degreesMode?a*Math.PI/180:a)}}function invTrigFn(f){return function(a){return this.degreesMode?f(a)/Math.PI*180:f(a)}}function createTranslatedAction(action,opt_longName){return opt_longName&&(action.translationHint='short form for mathematical function: "'+opt_longName+'"'),Action.create(action)}function binaryOp(name,keys,f,sym,opt_longName,opt_speechLabel){var longName=opt_longName||name,speechLabel=opt_speechLabel||sym
f.binary=!0,f.speechLabel=speechLabel
var action=createTranslatedAction({name:name,label:sym,translationHint:"binary operator: "+longName,speechLabel:speechLabel,keyboardShortcuts:keys,code:function(){""==this.a2?this.replace(f):(this.op!=DEFAULT_OP&&this.equals(),this.push("",f),this.editable=!0)}},opt_longName)
return f.toString=function(){return'<span aria-label="'+action.speechLabel+'">'+action.label+"</span>"},action}function unaryOp(name,keys,f,opt_sym,opt_longName,opt_speechLabel){var sym=opt_sym||name,longName=opt_longName||name,speechLabel=opt_speechLabel||sym
f.unary=!0,f.speechLabel=speechLabel
var action=createTranslatedAction({name:name,label:sym,translationHint:'short form for mathematical function: "'+longName+'"',speechLabel:speechLabel,keyboardShortcuts:keys,code:function(){this.op=f,this.push(f.call(this,this.a2)),this.editable=!1}},opt_longName)
return f.toString=function(){return action.label},action}function num(n){return{name:n.toString(),keyboardShortcuts:[n+""],code:function(){if(this.editable){if("0"==this.a2&&!n)return
if(this.a2.length>=18)return
this.a2="0"==this.a2?n:this.a2.toString()+n}else this.push(n),this.editable=!0}}}var DEBUG=DEBUG||!1,_DOC_=_DOC_||!1,FLAGS=FLAGS||{}
FLAGS.javascript=!0,FLAGS.debug=DEBUG,FLAGS.documentation=_DOC_
var GLOBAL=GLOBAL||this
Object.defineProperty_=Object.defineProperty,Object.defineProperty=function(){this.defineProperty_.apply(this,arguments)}
var MODEL0=MODEL
MODEL({extendsObject:"GLOBAL",methods:[function memoize(f){var cache={},g=function(){var key=argsToArray(arguments).toString()
return cache.hasOwnProperty(key)||(cache[key]=f.apply(this,arguments)),cache[key]}
return g.name=f.name,g},function memoize1(f){var cache={},g=function(arg){var key=arg?arg.toString():""
return cache.hasOwnProperty(key)||(cache[key]=f.call(this,arg)),cache[key]}
return g.name=f.name,g},function constantFn(v){return function(){return v}},function latchFn(f){var tripped=!1,val
return function(){return tripped||(tripped=!0,val=f(),f=void 0),val}},function argsToArray(args){for(var array=new Array(args.length),i=0;i<args.length;i++)array[i]=args[i]
return array},function StringComparator(s1,s2){return s1==s2?0:s2>s1?-1:1},function equals(a,b){return a===b?!0:a&&b?a.equals?a.equals(b):a==b:!1},function compare(a,b){return a===b?0:null==a?-1:null==b?1:a.compareTo?a.compareTo(b):b.compareTo?-b.compareTo(a):a>b?1:-1},function toCompare(c){return Array.isArray(c)?CompoundComparator.apply(null,c):c.compare?c.compare.bind(c):c},function CompoundComparator(){for(var args=argsToArray(arguments),cs=[],i=0;i<args.length;i++)cs[i]=toCompare(args[i])
var f=function(o1,o2){for(var i=0;i<cs.length;i++){var r=cs[i](o1,o2)
if(0!=r)return r}return 0}
return f.toSQL=function(){return args.map(function(s){return s.toSQL()}).join(",")},f.toMQL=function(){return args.map(function(s){return s.toMQL()}).join(" ")},f.toBQL=function(){return args.map(function(s){return s.toBQL()}).join(" ")},f.toString=f.toSQL,f},function randomAct(){for(var totalWeight=0,i=0;i<arguments.length;i+=2)totalWeight+=arguments[i]
for(var r=Math.random(),i=0,weight=0;i<arguments.length;i+=2)if(weight+=arguments[i],weight/totalWeight>=r)return void arguments[i+1]()},function Object_forEach(obj,fn){for(var key in obj)obj.hasOwnProperty(key)&&fn(obj[key],key)},function predicatedSink(predicate,sink){return predicate!==TRUE&&sink?{__proto__:sink,$UID:sink.$UID,put:function(obj,s,fc){!sink.put||obj&&!predicate.f(obj)||sink.put(obj,s,fc)},remove:function(obj,s,fc){!sink.remove||obj&&!predicate.f(obj)||sink.remove(obj,s,fc)},reset:function(){sink.reset()},toString:function(){return"PredicatedSink("+sink.$UID+", "+predicate+", "+sink+")"}}:sink},function limitedSink(count,sink){var i=0
return{__proto__:sink,$UID:sink.$UID,put:function(obj,s,fc){i++>=count&&fc?fc.stop():sink.put(obj,s,fc)}}},function skipSink(skip,sink){var i=0
return{__proto__:sink,$UID:sink.$UID,put:function(obj,s,fc){i++>=skip&&sink.put(obj,s,fc)}}},function orderedSink(comparator,sink){return comparator=toCompare(comparator),{__proto__:sink,$UID:sink.$UID,i:0,arr:[],put:function(obj,s,fc){this.arr.push(obj)},eof:function(){this.arr.sort(comparator),this.arr.select(sink)}}},function defineLazyProperty(target,name,definitionFn){Object.defineProperty(target,name,{get:function(){var definition=definitionFn.call(this)
return Object.defineProperty(this,name,definition),definition.get?definition.get.call(this):definition.value},configurable:!0})},function multiline(f){var s=f.toString(),start=s.indexOf("/*"),end=s.lastIndexOf("*/")
return s.substring(start+2,end)},function findPageXY(node){for(var x=0,y=0,parent;node;)parent=node,x+=node.offsetLeft,y+=node.offsetTop,node=node.offsetParent
return[x,y,parent]},function findViewportXY(node){var rect=node.getBoundingClientRect()
return[rect.left,rect.top]},function nop(){},function stringtoutf8(str){for(var res=[],i=0;i<str.length;i++){var code=str.charCodeAt(i),count=0
128>code&&res.push(code)}return res},function createGUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"===c?r:3&r|8
return v.toString(16)})}]})
var labelize=memoize1(function(str){return""===str?str:capitalize(str.replace(/[a-z][A-Z]/g,function(a){return a.charAt(0)+" "+a.charAt(1)}))}),constantize=memoize1(function(str){return"x"===str?"X_":"y"===str?"Y_":str.replace(/[a-z][^0-9a-z_]/g,function(a){return a.substring(0,1)+"_"+a.substring(1,2)}).toUpperCase()}),capitalize=memoize1(function(str){return str[0].toUpperCase()+str.substring(1)}),camelize=memoize1(function(str){var ret=str.replace(/(?:[-\s_])(\w)/g,function(_,a){return a?a.toUpperCase():""})
return ret[0].toLowerCase()+ret.substring(1)})
MODEL({extendsProto:"Object",properties:[{name:"$UID",getter:function(){var id=1
return function(){return Object.hasOwnProperty.call(this,"$UID__")?this.$UID__:(this.$UID__=id,id++,this.$UID__)}}()}],methods:[function become(other){for(var local=Object.getOwnPropertyNames(this),i=0;i<local.length;i++)delete this[local[i]]
var remote=Object.getOwnPropertyNames(other)
for(i=0;i<remote.length;i++)Object.defineProperty(this,remote[i],Object.getOwnPropertyDescriptor(other,remote[i]))
this.__proto__=other.__proto__}]}),MODEL({extendsProto:"Array",constants:{oldForEach_:Array.prototype.forEach},methods:[function clone(){return this.slice()},function deepClone(){for(var a=this.clone(),i=0;i<a.length;i++){var o=a[i]
o&&o.deepClone&&(a[i]=o.deepClone())}return a},function forEach(f,opt_this){if(!this||!f||opt_this)return this.oldForEach_.call(this,f,opt_this)
for(var l=this.length,i=0;l>i;i++)f(this[i],i,this)},function diff(other){for(var added=other.slice(0),removed=[],i=0;i<this.length;i++){for(var j=0;j<added.length;j++)if(0==this[i].compareTo(added[j])){added.splice(j,1),j--
break}j==added.length&&removed.push(this[i])}return{added:added,removed:removed}},function binaryInsert(item){for(var start=0,end=this.length-1;end>=start;){var m=start+Math.floor((end-start)/2),c=item.compareTo(this[m])
if(0==c)return this
0>c?end=m-1:start=m+1}return this.splice(start,0,item),this},function union(other){return this.concat(other.filter(function(o){return-1==this.indexOf(o)}.bind(this)))},function intersection(other){return this.filter(function(o){return-1!=other.indexOf(o)})},function intern(){for(var i=0;i<this.length;i++)this[i].intern&&(this[i]=this[i].intern())
return this},function compareTo(other){if(this.length!==other.length)return-1
for(var i=0;i<this.length;i++){var result=this[i].compareTo(other[i])
if(0!==result)return result}return 0},function fReduce(comparator,arr){compare=toCompare(comparator)
for(var result=[],i=0,j=0,k=0;i<this.length&&j<arr.length;){var a=compare(this[i],arr[j])
0>a?result[k++]=this[i++]:0!=a?result[k++]=arr[j++]:(result[k++]=this[i++],result[k++]=arr[j++])}return i!=this.length&&(result=result.concat(this.slice(i))),j!=arr.length&&(result=result.concat(arr.slice(j))),result},function pushAll(arr){return this.push.apply(this,arr),this.length},function mapFind(map){for(var i=0;i<this.length;i++){var result=map(this[i],i)
if(result)return result}},function mapProp(prop){return this.map(function(x){return x[prop]})},function mapCall(){var args=Array.prototype.slice.call(arguments,0),func=args.shift()
return this.map(function(x){return x[func]&&x[func].apply(x[func],args)})}],properties:[{name:"memento",getter:function(){throw"Array's can not be memorized properly as a memento."}}]}),MODEL({extendsProto:"String",methods:[function indexOfIC(a){return a.length>this.length?-1:this.toUpperCase().indexOf(a.toUpperCase())},function equals(other){return 0===this.compareTo(other)},function equalsIC(other){return other&&this.toUpperCase()===other.toUpperCase()},function capitalize(){return this.charAt(0).toUpperCase()+this.slice(1)},function labelize(){return this.replace(/[a-z][A-Z]/g,function(a){return a.charAt(0)+" "+a.charAt(1)}).capitalize()},function compareTo(o){return o==this?0:o>this?-1:1},String.prototype.startsWith||function startsWith(a){return 0==this.lastIndexOf(a,0)},String.prototype.endsWith||function endsWith(a){return this.length-a.length==this.lastIndexOf(a)},function startsWithIC(a){if(a.length>this.length)return!1
for(var l=a.length,i=0;l>i;i++)if(this[i].toUpperCase()!==a[i].toUpperCase())return!1
return!0},function put(obj){return this+obj.toJSON()},function(){var map={}
return function intern(){return map[this]||(map[this]=this.toString())}}(),function hashCode(){var hash=0
if(0==this.length)return hash
for(i=0;i<this.length;i++){var code=this.charCodeAt(i)
hash=(hash<<5)-hash+code,hash&=hash}return hash}]}),MODEL({extendsProto:"Function",methods:[function(){var oldBind=Function.prototype.bind,simpleBind=function(f,self){return function(){return f.apply(self,arguments)}}
return function bind(arg){return 1==arguments.length?simpleBind(this,arg):oldBind.apply(this,argsToArray(arguments))}}(),function equals(o){return this===o},function compareTo(o){return this===o?0:this.name.compareTo(o.name)||1},function o(f2){var f1=this
return function(){return f1.call(this,f2.apply(this,argsToArray(arguments)))}}]}),MODEL({extendsObject:"Math",methods:[function sign(n){return n>0?1:-1}]}),MODEL({extendsProto:"Date",methods:[function toRelativeDateString(){var seconds=Math.floor((Date.now()-this.getTime())/1e3)
if(60>seconds)return"moments ago"
var minutes=Math.floor(seconds/60)
if(1==minutes)return"1 minute ago"
if(60>minutes)return minutes+" minutes ago"
var hours=Math.floor(minutes/60)
if(1==hours)return"1 hour ago"
if(24>hours)return hours+" hours ago"
var days=Math.floor(hours/24)
if(1==days)return"1 day ago"
if(7>days)return days+" days ago"
if(365>days){var year=1900+this.getYear(),noyear=this.toDateString().replace(" "+year,"")
return noyear.substring(4)}return this.toDateString().substring(4)},function equals(o){return o&&o.getTime?this.getTime()===o.getTime():!1},function compareTo(o){if(o===this)return 0
if(!o)return 1
var d=this.getTime()-o.getTime()
return 0==d?0:d>0?1:-1},function toMQL(){return this.getFullYear()+"/"+(this.getMonth()+1)+"/"+this.getDate()},function toBQL(){var str=this.toISOString()
return str.substring(0,str.indexOf("."))}]}),MODEL({extendsProto:"Number",methods:[function compareTo(o){return o==this?0:o>this?-1:1}]}),MODEL({extendsProto:"Boolean",methods:[function compareTo(o){return(this.valueOf()?1:0)-(o?1:0)}]}),MODEL({extendsProto:"RegExp",methods:[function quote(str){return(str+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}]}),console.log.json=function(){for(var args=[],i=0;i<arguments.length;i++){var arg=arguments[i]
args.push(arg&&arg.toJSON?arg.toJSON():arg)}console.log.apply(console,args)},console.log.str=function(){for(var args=[],i=0;i<arguments.length;i++){var arg=arguments[i]
args.push(arg&&arg.toString?arg.toString():arg)}console.log.apply(console,args)},console.log.put=console.log.bind(console),console.log.remove=console.log.bind(console,"remove: "),console.log.error=console.log.bind(console,"error: "),console.log.json.put=console.log.json.bind(console),console.log.json.reduceI=console.log.json.bind(console,"reduceI: "),console.log.json.remove=console.log.json.bind(console,"remove: "),console.log.json.error=console.log.json.bind(console,"error: "),console.log.str.put=console.log.str.bind(console),console.log.str.remove=console.log.str.bind(console,"remove: "),console.log.str.error=console.log.str.bind(console,"error: "),document.put=function(obj){obj.write?obj.write(this.X):this.write(obj.toString())},window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.setImmediate,window.Blob&&(Blob.prototype.slice=Blob.prototype.slice||Blob.prototype.webkitSlice),window.XMLHttpRequest&&(XMLHttpRequest.prototype.asend=function(ret,opt_data){var xhr=this
xhr.onerror=function(){console.log("XHR Error: ",arguments)},xhr.onloadend=function(){ret(xhr.response,xhr)},xhr.send(opt_data)}),String.fromCharCode=function(){var oldLookup=String.fromCharCode,lookupTable=[]
return function(a){if(1==arguments.length)return lookupTable[a]||(lookupTable[a]=oldLookup(a))
for(var result="",i=0;i<arguments.length;i++)result+=lookupTable[arguments[i]]||(lookupTable[arguments[i]]=oldLookup(arguments[i]))
return result}}()
var MementoProto={}
Object.defineProperty(MementoProto,"equals",{enumerable:!1,configurable:!0,value:function(o){var keys=Object.keys(this),otherKeys=Object.keys(o)
if(keys.length!=otherKeys.length)return!1
for(var i=0;i<keys.length;i++)if(!equals(this[keys[i]],o[keys[i]]))return!1
return!0}}),MODEL({extendsProto:"Function",methods:[function abind(self){return function(ret){this.apply(self,arguments),ret()}.bind(this)},function ao(f2){var f1=this
return function(ret){var args=argsToArray(arguments)
args[0]=f1.bind(this,ret),f2.apply(this,args)}},function aseq(f2){return f2.ao(this)}]}),MODEL({extendsObject:"GLOBAL",methods:[function anop(ret){ret&&ret(void 0)},function alog(){var args=arguments
return function(ret){console.log.apply(console,args),ret&&ret.apply(this,[].slice.call(arguments,1))}},function aprofile(afunc){return function(ret){var a=argsToArray(arguments)
console.profile("aprofile")
var ret2=function(){console.profileEnd(),ret&&ret(arguments)}
aapply_(afunc,ret2,a)}},function aconstant(v){return function(ret){ret&&ret(v)}},function arepeat(n,afunc){return n?function(ret){var a=argsToArray(arguments)
a.splice(1,0,0,n)
var next=atramp(function(){return a[1]==n-1?(a[0]=ret,void afunc.apply(this,a)):(afunc.apply(this,a),void a[1]++)})
a[0]=next,next.apply(this,a)}:anop},function aforEach(arr,afunc){},function awhile(cond,afunc){return function(ret){var a=argsToArray(arguments),g=function(){return cond()?void afunc.apply(this,a):void ret.apply(void 0,arguments)}
a[0]=g,g.apply(this,a)}},function aif(cond,afunc,aelse){return function(ret){("function"==typeof cond?cond.apply(this,argsToArray(arguments).slice(1)):cond)?afunc.apply(this,arguments):aelse?aelse.apply(this,arguments):ret()}},function aaif(acond,afunc,aelse){return function(ret){var args=argsToArray(arguments)
args[0]=function(c){args[0]=ret,c?afunc.apply(null,args):aelse?aelse.apply(null,args):ret()},acond.apply(null,args)}},function(){var id=1,activeOps={}
return function atime(str,afunc,opt_endCallback,opt_startCallback){var name=str
return aseq(function(ret){activeOps[str]?(name+="-"+id++,activeOps[str]++):activeOps[str]=1
var start=performance.now()
opt_startCallback&&opt_startCallback(name),opt_endCallback||console.time(name),ret.apply(null,[].slice.call(arguments,1))},afunc,function(ret){if(activeOps[str]--,opt_endCallback){var end=performance.now()
opt_endCallback(name,end-start)}else console.timeEnd(name)
ret&&ret.apply(null,[].slice.call(arguments,1))})}}(),function ametric(){return this.atime.apply(this,arguments)},function asleep(ms){return function(ret){window.setTimeout(ret,ms)}},function ayield(){return function(ret){window.setTimeout(ret,0)}},function afuture(){var set=!1,values=void 0,waiters=[]
return{isSet:function(){return set},set:function(){if(set)return void console.log("ERROR: redundant set on future")
values=arguments,set=!0
for(var i=0;i<waiters.length;i++)waiters[i].apply(null,values)
return waiters=void 0,this},get:function(ret){return set?void ret.apply(null,values):void waiters.push(ret)}}},function aapply_(f,ret,args){args.unshift(ret),f.apply(this,args)},function arequestqueue(f,opt_lock,opt_max){var lock=opt_lock||{}
lock.q||(lock.q=[],lock.active=null)
var onExit=function(){var next=lock.active=lock.q.pop()
next&&setTimeout(function(){f(onExit,next)},0)},reduceDown=function(o,q){for(var i=q.length-1;i>=0;i--){var result=o.reduce(q[i])
if(result){q.splice(i,1),reduceDown(result,q)
break}}q.push(o)}
return function(o){if(lock.active){var first=o.reduce(lock.active)
if(first&&first.equals(lock.active))return}reduceDown(o,lock.q,lock.q.length-1),lock.q.length>opt_max&&(lock.q.length=opt_max),lock.active||onExit()}},function asynchronized(f,opt_lock){function onExit(ret){return function(){var next=lock.q.shift()
next?setTimeout(next,0):lock.active=!1,ret()}}var lock=opt_lock||{}
return lock.q||(lock.q=[],lock.active=!1),function(ret){return lock.active?void lock.q.push(function(){f(onExit(ret))}):(lock.active=!0,void f(onExit(ret)))}},function atimeout(delay,f,opt_timeoutF){return function(ret){var timedOut=!1,completed=!1
setTimeout(function(){completed||(timedOut=!0,console.log("timeout"),opt_timeoutF&&opt_timeoutF())},delay),f(aseq(function(ret){timedOut||(completed=!0),completed&&ret()},ret))}},function amemo(f,opt_ttl){var memoized=!1,values,waiters,age=0,pending=!1
return function(ret){if(memoized)return ret.apply(null,values),void(void 0!=opt_ttl&&!pending&&Date.now()>age+opt_ttl&&(pending=!0,f(function(){values=arguments,age=Date.now(),pending=!1})))
var first=!waiters
first&&(waiters=[]),waiters.push(ret),first&&f(function(){values=arguments,age=Date.now()
for(var i=0;i<waiters.length;i++)waiters[i]&&waiters[i].apply(null,values)
void 0==opt_ttl&&(f=void 0),memoized=!0,waiters=void 0})}},function amemo1(afunc){var cache={}
return function(ret,arg){var key=arg?arg.toString():""
cache[key]||(cache[key]=afuture(),afunc(cache[key].set,arg)),cache[key].get(ret)}},function amerged(f){var waiters
return function(ret){var first=!waiters
if(first){waiters=[]
var args=argsToArray(arguments)}waiters.push(ret),first&&(args[0]=function(){var calls=waiters
waiters=void 0
for(var i=0;i<calls.length;i++)calls[i]&&calls[i].apply(null,arguments)},f.apply(null,args))}},function mergeAsync(f){var active=!1,args
return function(){if(active)return void(args=argsToArray(arguments))
active=!0
var ret=function(){args?(args.unshift(ret),f.apply(null,args),args=void 0):active=!1},a=argsToArray(arguments)
a.unshift(ret),f.apply(null,a)}},function ao(){for(var ret=arguments[arguments.length-1],i=0;i<arguments.length-1;i++)ret=arguments[i].ao(ret)
return ret},function aseq(){if(0==arguments.lenth)return anop
for(var f=arguments[arguments.length-1],i=arguments.length-2;i>=0;i--)f=arguments[i].aseq(f)
return f},function apar(){var aargs=[],count=0,fs=arguments
return function(ret){if(0==fs.length)return void(ret&&ret())
for(var opt_args=Array.prototype.splice.call(arguments,1),ajoin=function(i){if(aargs[i]=Array.prototype.splice.call(arguments,1),++count==fs.length){for(var a=[],j=0;j<fs.length;j++)for(var k=0;k<aargs[j].length;k++)a.push(aargs[j][k])
ret&&ret.apply(null,a)}},i=0;i<fs.length;i++)fs[i].apply(null,[ajoin.bind(null,i)].concat(opt_args))}},function(){var active=!1,jobs=[]
return function atramp(afunc){return function(){if(jobs.push([afunc,arguments]),!active){console.assert(jobs.length<=1,"atramp with multiple jobs"),active=!0
for(var job;null!=(job=jobs.pop());)job[0].apply(this,job[1])
active=!1}}}}(),function arepeatpar(n,afunc){return function(ret){if(0===n)return void(ret&&ret())
for(var aargs=[],count=0,opt_args=Array.prototype.splice.call(arguments,1),ajoin=function(i){if(++count==n){var a=[]
ret&&ret.apply(null,a)}},i=0;n>i;i++)afunc.apply(null,[ajoin.bind(null,i)].concat([i,n]).concat(opt_args))}},function axhr(url,opt_op,opt_params){var op=opt_op||"GET",params=opt_params||[]
return function(ret){var xhr=new XMLHttpRequest
xhr.open(op,url),xhr.asend(function(json){ret(JSON.parse(json))},params&&params.join("&"))}},function futurefn(future){return function(){var args=arguments
future.get(function(f){f.apply(void 0,args)})}},function adelay(afunc,delay){function pump(){if(!timeout&&queue.length){var top=queue.shift(),f=top[0],args=top[1],ret=args[0]
args[0]=function(){ret.apply(null,arguments),pump()},timeout=setTimeout(function(){timeout=0,f.apply(null,args)},delay)}}var queue=[],timeout
return function(){var args=arguments
queue.push([afunc,args]),pump()}},function adebugger(fn){return function(ret){fn.apply(null,arguments)}}]})
var __JSONP_CALLBACKS__={},wrapJsonpCallback=function(){var nextID=0
return function(ret,opt_nonce){var id="c"+nextID++
opt_nonce&&(id+=Math.floor(16777215*Math.random()).toString(16))
var cb=__JSONP_CALLBACKS__[id]=function(data){delete __JSONP_CALLBACKS__[id],ret&&ret.call(this,data)}
return cb.id=id,cb}}(),ajsonp=function(url,params){return function(ret){var cb=wrapJsonpCallback(ret),script=document.createElement("script")
script.src=url+"?callback=__JSONP_CALLBACKS__."+cb.id+(params?"&"+params.join("&"):""),script.onload=function(){document.body.removeChild(this)},script.onerror=function(){cb(null),document.body.removeChild(this)},document.body.appendChild(script)}},StringPS={create:function(str){var o=Object.create(this)
return o.pos=0,o.str_=[str],o.tail_=[],o},set str(str){this.str_[0]=str},get head(){return this.pos>=this.str_[0].length?null:this.str_[0].charAt(this.pos)},get value(){return this.hasOwnProperty("value_")?this.value_:this.str_[0].charAt(this.pos-1)},get tail(){if(!this.tail_[0]){var tail=Object.create(this.__proto__)
tail.str_=this.str_,tail.pos=this.pos+1,tail.tail_=[],this.tail_[0]=tail}return this.tail_[0]},setValue:function(value){var ret=Object.create(this.__proto__)
return ret.str_=this.str_,ret.pos=this.pos,ret.tail_=this.tail_,ret.value_=value,ret},toString:function(){return this.str_[0].substring(this.pos)}},parserVersion_=1,TrapPStream={create:function(ps){return{__proto__:this,head:ps.head,value:ps.value,goodChar:!1}},getValue:function(){return this.value},setValue:function(v){return this.value=v,this},get tail(){return this.goodChar=!0,{value:this.value,getValue:function(){return this.value},setValue:function(v){this.value=v}}}},DEBUG_PARSE=!1,grammar={parseString:function(str,opt_start){var ps=this.stringPS
ps.str=str
var res=this.parse(opt_start||this.START,ps)
return res&&res.value},parse:function(parser,pstream){DEBUG_PARSE&&pstream.str_&&(console.log(new Array(pstream.pos).join("."),pstream.head),console.log(pstream.pos+"> "+pstream.str_[0].substring(0,pstream.pos)+"("+pstream.head+")"))
var ret=parser.call(this,pstream)
return DEBUG_PARSE&&console.log(parser+" ==> "+!!ret+"  "+(ret&&ret.value)),ret},"export":function(str){return this[str].bind(this)},addAction:function(sym,action){var p=this[sym]
this[sym]=function(ps){var val=ps.value,ps2=this.parse(p,ps)
return ps2&&ps2.setValue(action.call(this,ps2.value,val))},this[sym].toString=function(){return"<<"+sym+">>"}},addActions:function(map){for(var key in map)this.addAction(key,map[key])
return this}}
defineTTLProperty(grammar,"stringPS",3e4,function(){return StringPS.create("")})
var SkipGrammar={create:function(gramr,skipp){return{__proto__:gramr,skip_:!0,parse:function(parser,pstream){return this.skip_&&(pstream=this.skip.call(grammar,pstream)||pstream),this.__proto__.parse.call(this,parser,pstream)},skip:skipp}}},__ROOT__={}
MODEL({name:"EventService",extendsModel:"__ROOT__",constants:{UNSUBSCRIBE_EXCEPTION:"unsubscribe",WILDCARD:"*"},methods:{oneTime:function(listener){return function(){throw listener.apply(this,argsToArray(arguments)),EventService.UNSUBSCRIBE_EXCEPTION}},consoleLog:function(listener){return function(){var args=argsToArray(arguments)
console.log(args),listener.apply(this,args)}},merged:function(listener,opt_delay,opt_X){var setTimeoutX=opt_X&&opt_X.setTimeout||setTimeout,delay=opt_delay||16
return function(){var triggered=!1,unsubscribed=!1,lastArgs=null,f=function(){if(lastArgs=arguments,unsubscribed)throw EventService.UNSUBSCRIBE_EXCEPTION
if(!triggered){triggered=!0
try{setTimeoutX(function(){triggered=!1
var args=argsToArray(lastArgs)
lastArgs=null
try{listener.apply(this,args)}catch(x){x===EventService.UNSUBSCRIBE_EXCEPTION&&(unsubscribed=!0)}},delay)}catch(e){throw EventService.UNSUBSCRIBE_EXCEPTION}}}
return DEBUG&&(f.toString=function(){return"MERGED("+delay+", "+listener.$UID+", "+listener+")"}),f}()},framed:function(listener,opt_X){opt_X=opt_X||this.X
var requestAnimationFrameX=opt_X&&opt_X.requestAnimationFrame||requestAnimationFrame
return function(){var triggered=!1,unsubscribed=!1,lastArgs=null,f=function(){if(lastArgs=arguments,unsubscribed)throw EventService.UNSUBSCRIBE_EXCEPTION
triggered||(triggered=!0,requestAnimationFrameX(function(){triggered=!1
var args=argsToArray(lastArgs)
lastArgs=null
try{listener.apply(this,args)}catch(x){x===EventService.UNSUBSCRIBE_EXCEPTION&&(unsubscribed=!0)}}))}
return DEBUG&&(f.toString=function(){return"ANIMATE("+listener.$UID+", "+listener+")"}),f}()},async:function(listener,opt_X){return this.delay(0,listener,opt_X)},delay:function(delay,listener,opt_X){return opt_X=opt_X||this.X,function(){var args=argsToArray(arguments);(opt_X&&opt_X.setTimeout?opt_X.setTimeout:setTimeout)(function(){listener.apply(this,args)},delay)}},hasListeners:function(opt_topic){return opt_topic?(console.log("TODO: haslisteners"),!0):!!this.subs_},publish:function(topic){return this.subs_?this.pub_(this.subs_,0,topic,this.appendArguments([this,topic],arguments,1)):0},publishAsync:function(topic){var args=argsToArray(arguments),me=this
setTimeout(function(){me.publish.apply(me,args)},0)},deepPublish:function(topic){return this.publish.apply(this,arguments)},lazyPublish:function(topic,fn){return this.hasListeners(topic)?this.publish.apply(this,fn()):0},subscribe:function(topic,listener){this.subs_||(this.subs_={}),this.sub_(this.subs_,0,topic,listener)},unsubscribe:function(topic,listener){this.subs_&&this.unsub_(this.subs_,0,topic,listener)},unsubscribeAll:function(){this.sub_={}},pub_:function(map,topicIndex,topic,msg){var count=0
if(null==map)return 0
if(topicIndex<topic.length){var t=topic[topicIndex]
if(t==this.WILDCARD)return this.notifyListeners_(topic,map,msg)
t&&(count+=this.pub_(map[t],topicIndex+1,topic,msg))}return count+=this.notifyListeners_(topic,map[null],msg)},sub_:function(map,topicIndex,topic,listener){if(topicIndex==topic.length)map[null]||(map[null]=[]),map[null].push(listener)
else{var key=topic[topicIndex]
map[key]||(map[key]={}),this.sub_(map[key],topicIndex+1,topic,listener)}},unsub_:function(map,topicIndex,topic,listener){if(topicIndex==topic.length){if(!map[null])return!0
map[null].deleteI(listener)||console.warn("phantom unsubscribe, size: ",map[null].length),map[null].length||delete map[null]}else{var key=topic[topicIndex]
if(!map[key])return!1
this.unsub_(map[key],topicIndex+1,topic,listener)&&delete map[key]}return 0==Object.keys(map).length},notifyListener_:function(topic,listener,msg){try{listener.apply(null,msg)}catch(err){return err!==this.UNSUBSCRIBE_EXCEPTION&&(console.error("Error delivering event (removing listener): ",topic.join("."),err),DEBUG&&console.error(err.stack)),!1}return!0},notifyListeners_:function(topic,listeners,msg){if(null==listeners)return 0
if(Array.isArray(listeners)){for(var i=0;i<listeners.length;i++){var listener=listeners[i]
this.notifyListener_(topic,listener,msg)||(listeners.splice(i,1),i--)}return listeners.length}var count=0
for(var key in listeners)count+=this.notifyListeners_(topic,listeners[key],msg)
return count},appendArguments:function(a,args,start){for(var i=start;i<args.length;i++)a.push(args[i])
return a}}}),MODEL({name:"PropertyChangeSupport",extendsModel:"EventService",constants:{PROPERTY_TOPIC:"property"},methods:{propertyTopic:memoize1(function(property){return[this.PROPERTY_TOPIC,property]}),propertyChange:function(property,oldValue,newValue){this.subs_&&(null==property||oldValue!==newValue&&(oldValue===oldValue||newValue===newValue))&&this.publish(this.propertyTopic(property),oldValue,newValue)},propertyChange_:function(propertyTopic,oldValue,newValue){this.subs_&&(oldValue===newValue||oldValue!==oldValue&&newValue!==newValue||this.publish(propertyTopic,oldValue,newValue))},globalChange:function(){this.publish(this.propertyTopic(this.WILDCARD),null,null)},addListener:function(listener){console.assert(listener,"Listener cannot be null."),this.addPropertyListener(null,listener)},removeListener:function(listener){this.removePropertyListener(null,listener)},addPropertyListener:function(property,listener){this.subscribe(this.propertyTopic(property),listener)},removePropertyListener:function(property,listener){this.unsubscribe(this.propertyTopic(property),listener)},propertyValue:function(prop){if(!prop)throw"Property Name required for propertyValue()."
var props=this.props_||(this.props_={})
return Object.hasOwnProperty.call(props,prop)?props[prop]:props[prop]=PropertyValue.create(this,prop)}}})
var FunctionStack={create:function(){var stack=[!1]
return{stack:stack,push:function(f){stack.unshift(f)},pop:function(){stack.shift()}}}},PropertyValue={create:function(obj,prop){var o=Object.create(this)
return o.$UID=obj.$UID+"."+prop,o.obj=obj,o.prop=prop,o},get:function(){return this.obj[this.prop]},set:function(val){this.obj[this.prop]=val},get value(){return this.get()},set value(val){this.set(val)},addListener:function(listener){this.obj.addPropertyListener(this.prop,listener)},removeListener:function(listener){this.obj.removePropertyListener(this.prop,listener)},toString:function(){return"PropertyValue("+this.prop+")"}},Events={listeners_:new WeakMap,recordListener:function(src,dst,listener,opt_dontCallListener){var srcMap=this.listeners_.get(src)
srcMap||(srcMap=new WeakMap,this.listeners_.set(src,srcMap)),console.assert(!srcMap.get(dst),"recordListener: duplicate follow"),srcMap.set(dst,listener),src.addListener(listener),opt_dontCallListener||listener()},identity:function(x){return x},follow:function(srcValue,dstValue){srcValue&&dstValue&&this.recordListener(srcValue,dstValue,function(){var sv=srcValue.get(),dv=dstValue.get()
equals(sv,dv)||dstValue.set(sv)})},unfollow:function(src,dst){if(src&&dst){var srcMap=this.listeners_.get(src)
if(srcMap){var listener=srcMap.get(dst)
listener&&(srcMap["delete"](dst),src.removeListener(listener))}}},map:function(srcValue,dstValue,f){srcValue&&dstValue&&this.recordListener(srcValue,dstValue,function(){var s=f(srcValue.get()),d=dstValue.get()
equals(s,d)||dstValue.set(s)})},link:function(srcValue,dstValue){this.follow(srcValue,dstValue),this.follow(dstValue,srcValue)},relate:function(srcValue,dstValue,f,fprime,removeFeedback){if(srcValue&&dstValue){var feedback=!1,l=function(sv,dv,f){return function(){if(!removeFeedback||!feedback){var s=f(sv.get()),d=dv.get()
equals(s,d)||(feedback=!0,dv.set(s),feedback=!1)}}},l1=l(srcValue,dstValue,f),l2=l(dstValue,srcValue,fprime)
this.recordListener(srcValue,dstValue,l1,!0),this.recordListener(dstValue,srcValue,l2,!0),l1()}},unlink:function(value1,value2){this.unfollow(value1,value2),this.unfollow(value2,value1)},dynamic:function(fn,opt_fn,opt_X){var fn2=opt_fn?function(){opt_fn(fn())}:fn,listener=EventService.framed(fn2,opt_X),propertyValues=[]
fn(),Events.onGet.push(function(obj,name,value){obj.propertyValue(name).addListener(listener),propertyValues.push(obj.propertyValue(name))})
var ret=fn()
return Events.onGet.pop(),opt_fn&&opt_fn(ret),{destroy:function(){propertyValues.forEach(function(p){p.removeListener(listener)})}}},onSet:FunctionStack.create(),onGet:FunctionStack.create()}
MODEL({name:"Movement",methods:{distance:function(x,y){return Math.sqrt(x*x+y*y)},o:function(f1,f2){return function(x){return f1(f2(x))}},avg:function(f1,f2){return function(x){return(f1(x)+f2(x))/2}},spline:function(f1,f2){return function(x){return(1-x)*f1(x)+x*f2(x)}},linear:function(x){return x},back:function(x){return.5>x?2*x:2-2*x},accelerate:function(x){return(Math.sin(x*Math.PI-Math.PI/2)+1)/2},easeIn:function(a){var v=1/(1-a/2)
return function(x){var x1=Math.min(x,a),x2=Math.max(x-a,0)
return(a?.5*x1*(x1/a)*v:0)+x2*v}},reverse:function(f){return function(x){return 1-f(1-x)}},easeOut:function(b){return Movement.reverse(Movement.easeIn(b))},oscillate:function(b,a,opt_c){var c=opt_c||3
return function(x){if(1-b>x)return x/(1-b)
var t=(x-1+b)/b
return 1+2*(1-t)*a*Math.sin(2*c*Math.PI*t)}},bounce:function(b,a,opt_c){var c=opt_c||3
return function(x){if(1-b>x)return x/(1-b)
var t=(x-1+b)/b
return 1-2*(1-t)*a*Math.abs(Math.sin(2*c*Math.PI*t))}},bounce2:function(a){var v=1/(1-a)
return function(x){if(1-a>x)return v*x
var p=(x-1+a)/a
return 1-(x-1+a)*v/2}},stepBack:function(a){return function(x){return a>x?-x:-2*a+(1+2*a)*x}},ease:function(a,b){return Movement.o(Movement.easeIn(a),Movement.easeOut(b))},seq:function(f1,f2){return f1&&f2?function(){f1.apply(this,argsToArray(arguments)),f2()}:f1?f1:f2},liveAnimations_:0,animate:function(duration,fn,opt_interp,opt_onEnd,opt_X){var requestAnimationFrameX=opt_X&&opt_X.requestAnimationFrame||requestAnimationFrame
if(0==duration)return Movement.seq(fn,opt_onEnd)
var interp=opt_interp||Movement.linear
return function(){function stop(){var onEnd=opt_onEnd
if(!stopped&&(Movement.liveAnimations_--,stopped=!0,onEnd&&onEnd(),onEnd=null,0===Movement.liveAnimations_)){var tasks=Movement.idleTasks_
tasks&&tasks.length>0&&(Movement.idleTasks_=[],setTimeout(function(){var i
if(Movement.liveAnimations_>0)for(i=0;i<tasks.length;i++)Movement.idleTasks_.push(tasks[i])
else for(i=0;i<tasks.length;i++)tasks[i]()},20))}}function go(){if(!stopped){for(var now=Date.now(),p=interp((Math.min(now,startTime+duration)-startTime)/duration),last=now>=startTime+duration,i=0;i<ranges.length;i++){var r=ranges[i],obj=r[0],name=r[1],value1=r[2],value2=r[3]
obj[name]=last?value2:value1+(value2-value1)*p}last?stop():requestAnimationFrameX(go)}}var ranges=[],stopped=!1
fn&&(Events.onSet.push(function(obj,name,value2){ranges.push([obj,name,obj[name],value2])}),fn.apply(this,argsToArray(arguments)),Events.onSet.pop())
var startTime=Date.now()
if(ranges.length>0)Movement.liveAnimations_++,requestAnimationFrameX(go)
else{var setTimeoutX=opt_X&&opt_X.setTimeout||setTimeout
setTimeoutX(stop,duration)}return stop}},whenIdle:function(fn){return function(){if(Movement.liveAnimations_>0){Movement.idleTasks_||(Movement.idleTasks_=[])
var args=arguments
Movement.idleTasks_.push(function(){fn.apply(fn,args)})}else fn.apply(fn,arguments)}},compile:function(a,opt_rest){function noop(){}function isPause(op){return Array.isArray(op)&&0==op[0]}function compilePause(op,rest){return function(){document.onclick=function(){document.onclick=null,rest()}}}function isSimple(op){return Array.isArray(op)&&"number"==typeof op[0]}function compileSimple(op,rest){return op[3]=Movement.seq(op[3],rest),function(){Movement.animate.apply(null,op)()}}function isParallel(op){return Array.isArray(op)&&Array.isArray(op[0])}function compileParallel(op,rest){var join=function(num){return function(){--num||rest()}}(op.length)
return function(){for(var i=0;i<op.length;i++)isSimple(op[i])?Movement.animate(op[i][0],op[i][1],op[i][2],Movement.seq(op[i][3],join))():Movement.compile(op[i],join)()}}function compileFn(fn,rest){return Movement.seq(fn,rest)}function compile_(a,i){if(i>=a.length)return opt_rest||noop
var rest=compile_(a,i+1),op=a[i]
return isPause(op)?compilePause(op,rest):isSimple(op)?compileSimple(op,rest):isParallel(op)?compileParallel(op,rest):compileFn(op,rest)}return compile_(a,0)},onIntersect:function(o1,o2,fn){o1.model_.R?Events.dynamic(function(){o1.x,o1.y,o2.x,o2.y},function(){var dx=o1.x-o2.x,dy=o1.y-o2.y,d=dx*dx+dy*dy,r2=o1.r+o2.r
r2*r2>d&&fn.call(null,o1,o2)}):Events.dynamic(function(){o1.x,o1.y,o2.x,o2.y},function(){(o1.x<=o2.x&&o1.x+o1.width>o2.x&&o1.y<=o2.y&&o1.y+o1.height>o2.y||o2.x<=o1.x&&o2.x+o2.width>o1.x&&o2.y<=o1.y&&o2.y+o2.height>o1.y)&&fn.call(null,o1,o2)})},stepTowards:function(src,dst,maxStep){var dx=src.x-dst.x,dy=src.y-dst.y,theta=Math.atan2(dy,dx),r=Math.sqrt(dx*dx+dy*dy)
r=0>r?Math.max(-maxStep,r):Math.min(maxStep,r),dst.x+=r*Math.cos(-theta),dst.y-=r*Math.sin(-theta)},moveTowards:function(t,body,sat,v){var bodyX=body.propertyValue("x"),bodyY=body.propertyValue("y"),satX=sat.propertyValue("x"),satY=sat.propertyValue("y")
t.addListener(function(){var dx=bodyX.get()-satX.get(),dy=bodyY.get()-satY.get(),theta=Math.atan2(dy,dx),r=Math.sqrt(dx*dx+dy*dy)
r=0>r?Math.max(-v,r):Math.min(v,r),satX.set(satX.get()+r*Math.cos(-theta)),satY.set(satY.get()-r*Math.sin(-theta))})},orbit:function(t,body,sat,r,p,opt_start){var bodyX=body.x$,bodyY=body.y$,satX=sat.x$,satY=sat.y$,start=opt_start||0
t.addListener(EventService.framed(function(){var time=t.time
satX.set(bodyX.get()+r*Math.sin(time/p*Math.PI*2+start)),satY.set(bodyY.get()+r*Math.cos(time/p*Math.PI*2+start))}))},strut:function(mouse,c,dx,dy){Events.dynamic(function(){mouse.x,mouse.y},function(){c.x=mouse.x+dx,c.y=mouse.y+dy})},gravity:function(c,opt_a,opt_theta){var a=opt_a||1,theta=opt_theta||1.5*Math.PI
Events.dynamic(function(){c.vx,c.vy},function(){c.vy+=a})},friction:function(c,opt_coef){var coef=opt_coef||.9
Events.dynamic(function(){c.vx,c.vy},function(){c.vx=Math.abs(c.vx)<.001?0:c.vx*coef,c.vy=Math.abs(c.vy)<.001?0:c.vy*coef})},inertia:function(c){var last=Date.now()
Events.dynamic(function(){c.vx,c.vy,c.x,c.y},function(){var now=Date.now(),time=Math.min(Math.max(16,now-last),64)/16
Math.abs(c.vx)>.001&&(c.x+=c.vx*time),Math.abs(c.vy)>.001&&(c.y+=c.vy*time),last=now})},spring:function(mouse,c,dx,dy,opt_strength){var strength=opt_strength||6,d=Movement.distance(dx,dy)
Events.dynamic(function(){mouse.x,mouse.y,c.x,c.y,c.vx,c.vy},function(){if(0===dx&&0===dy)c.x=mouse.x,c.y=mouse.y
else{var dx2=mouse.x+dx-c.x,dy2=mouse.y+dy-c.y,d2=Movement.distance(dx2,dy2),dv=strength*d2/d
if(Math.abs(dv)<.01)return
var a=Math.atan2(dy2,dx2)
c.vx+=dv*Math.cos(a),c.vy+=dv*Math.sin(a)}})},spring2:function(c1,c2,length,opt_strength){var strength=opt_strength||4
Events.dynamic(function(){c1.x,c1.y,c2.x,c2.y},function(){var d=c1.distanceTo(c2),a=Math.atan2(c2.y-c1.y,c2.x-c1.x)
d>length?(c1.applyMomentum(strength*(d/length-1),a),c2.applyMomentum(-strength*(d/length-1),a)):length>d&&(c1.applyMomentum(-strength*(length/d-1),a),c2.applyMomentum(strength*(length/d-1),a))})},createAnimatedPropertyInstallFn:function(duration,interpolation){return function(prop){this.defineProperty({name:prop.name+"$AnimationLatch",defaultValue:0,hidden:!0,documentation:function(){}})
var actualSetter=this.__lookupSetter__(prop.name)
this.defineProperty({name:prop.name+"$AnimationSetValue",defaultValue:0,hidden:!0,documentation:function(){},postSet:function(_,nu){actualSetter.call(this,nu)}}),this.__defineSetter__(prop.name,function(nu){var latch=this[prop.name+"$AnimationLatch"]
latch&&latch()
var anim=Movement.animate(duration,function(){this[prop.name+"$AnimationSetValue"]=nu}.bind(this),interpolation)
this[prop.name+"$AnimationLatch"]=anim()})}}}}),Movement.easy=Movement.spline(Movement.spline(constantFn(0),Movement.linear),Movement.spline(Movement.linear,constantFn(1)))
var AbstractFormatter={keyify:function(str){return'"'+str+'"'},stringify:function(obj){var buf=""
return this.output(function(){for(var i=0;i<arguments.length;i++)buf+=arguments[i]},obj),buf},stringifyObject:function(obj,opt_defaultModel){var buf=""
return this.outputObject_(function(){for(var i=0;i<arguments.length;i++)buf+=arguments[i]},obj,opt_defaultModel),buf},where:function(p){return{__proto__:this,p:p.f&&p.f.bind(p)||p}},p:function(){return!0}},JSONUtil={escape:function(str){return str.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/[\x00-\x1f]/g,function(c){return"\\u00"+(c.charCodeAt(0)<16?"0"+c.charCodeAt(0).toString(16):c.charCodeAt(0).toString(16))})},parseToMap:function(str){return eval("("+str+")")},parse:function(X,str,seq){return this.mapToObj(X,this.parseToMap(str),void 0,seq)},arrayToObjArray:function(X,a,opt_defaultModel,seq){for(var i=0;i<a.length;i++)a[i]=this.mapToObj(X,a[i],opt_defaultModel,seq)
return a},mapToObj:function(X,obj,opt_defaultModel,seq){if(!obj||"object"==typeof obj.model_)return obj
if(Array.isArray(obj))return this.arrayToObjArray(X,obj,void 0,seq)
if(obj instanceof Function)return obj
if(obj instanceof Date)return obj
if(obj instanceof Object){var j=0
for(var key in obj)"model_"!=key&&"prototype_"!=key&&(obj[key]=this.mapToObj(X,obj[key],null,seq)),j++
if(opt_defaultModel&&!obj.model_)return opt_defaultModel.create(obj)
if(obj.model_){var newObj=X.lookup(obj.model_)
if(!newObj||!newObj.finished__){var future=afuture()
return seq&&seq.push(future.get),X.arequire(obj.model_)(function(model){if(!model)return FLAGS.debug&&"Template"!==obj.model_&&"ArrayProperty"!==obj.model_&&"ViewFactoryProperty"!==obj.model_&&"Documentation"!==obj.model_&&"DocumentationProperty"!==obj.model_&&"CSSProperty"!==obj.model_&&"FunctionProperty"!==obj.model_&&console.warn("Failed to dynamically load: ",obj.model_),void future.set(obj)
var tmp=model.create(obj)
obj.become(tmp),future.set(obj)}),obj}var ret=newObj?newObj.create(obj,X):obj
return ret.readResolve?ret.readResolve():ret}return obj}return obj},compact:{__proto__:AbstractFormatter,output:function(out,obj,opt_defaultModel){Array.isArray(obj)?this.outputArray_(out,obj):"string"==typeof obj?(out('"'),out(JSONUtil.escape(obj)),out('"')):obj instanceof Function?this.outputFunction_(out,obj):obj instanceof Date?out(obj.getTime()):obj instanceof RegExp?out(obj.toString()):obj instanceof Object?obj.model_?this.outputObject_(out,obj,opt_defaultModel):this.outputMap_(out,obj):"number"==typeof obj?(isFinite(obj)||(obj=null),out(obj)):out(void 0===obj?null:obj)},outputObject_:function(out,obj,opt_defaultModel){var str="",first=!0
out("{"),obj.model_.id!==opt_defaultModel&&(this.outputModel_(out,obj),first=!1)
var properties=obj.model_.getRuntimeProperties()
for(var key in properties){var prop=properties[key]
if(this.p(prop,obj)&&prop.name in obj.instance_){var val=obj[prop.name]
if(Array.isArray(val)&&!val.length)continue
first||out(","),out(this.keyify(prop.name),": "),Array.isArray(val)&&prop.subType?this.outputArray_(out,val,prop.subType):this.output(out,val),first=!1}}out("}")},outputModel_:function(out,obj){out('model_:"'),obj.model_["package"]&&out(obj.model_["package"],"."),out(obj.model_.name,'"')},outputMap_:function(out,obj){var str="",first=!0
out("{")
for(var key in obj){var val=obj[key]
first||out(","),out(this.keyify(key),": "),this.output(out,val),first=!1}out("}")},outputArray_:function(out,a,opt_defaultModel){if(0==a.length)return out("[]"),out
var str="",first=!0
out("[")
for(var i=0;i<a.length;i++,first=!1){var obj=a[i]
first||out(","),this.output(out,obj,opt_defaultModel)}out("]")},outputFunction_:function(out,obj){out(obj)}},pretty:{__proto__:AbstractFormatter,output:function(out,obj,opt_defaultModel,opt_indent){var indent=opt_indent||""
Array.isArray(obj)?this.outputArray_(out,obj,null,indent):"string"==typeof obj?(out('"'),out(JSONUtil.escape(obj)),out('"')):obj instanceof Function?this.outputFunction_(out,obj,indent):obj instanceof Date?out(obj.getTime()):obj instanceof RegExp?out(obj.toString()):obj instanceof Object?obj.model_?this.outputObject_(out,obj,opt_defaultModel,indent):this.outputMap_(out,obj,indent):"number"==typeof obj?(isFinite(obj)||(obj=null),out(obj)):(void 0===obj&&(obj=null),out(obj))},outputObject_:function(out,obj,opt_defaultModel,opt_indent){var indent=opt_indent||"",nestedIndent=indent+"   ",str="",first=!0
out(indent,"{\n"),obj.model_.id&&obj.model_.id!==opt_defaultModel&&(this.outputModel_(out,obj,nestedIndent),first=!1)
var properties=obj.model_.getRuntimeProperties()
for(var key in properties){var prop=properties[key]
if(this.p(prop,obj)&&"parent"!==prop.name&&prop.name in obj.instance_){var val=obj[prop.name]
if(Array.isArray(val)&&!val.length)continue
first||out(",\n"),out(nestedIndent,this.keyify(prop.name),": "),Array.isArray(val)&&prop.subType?this.outputArray_(out,val,prop.subType,nestedIndent):this.output(out,val,null,nestedIndent),first=!1}}out("\n",indent,"}")},outputModel_:function(out,obj,indent){out(indent,'"model_": "',obj.model_.id,'"')},outputMap_:function(out,obj,opt_indent){var indent=opt_indent||"",nestedIndent=indent+"   ",str="",first=!0
out(indent,"{\n",nestedIndent)
for(var key in obj){var val=obj[key]
first||out(",\n"),out(nestedIndent,this.keyify(key),": "),this.output(out,val,null,nestedIndent),first=!1}out("\n",indent,"}")},outputArray_:function(out,a,opt_defaultModel,opt_indent){if(0==a.length)return out("[]"),out
var indent=opt_indent||"",nestedIndent=indent+"   ",str="",first=!0
out("[\n")
for(var i=0;i<a.length;i++,first=!1){var obj=a[i]
first||out(",\n"),this.output(out,obj,opt_defaultModel,nestedIndent)}out("\n",indent,"]")},outputFunction_:function(out,obj,indent){var str=obj.toString(),lines=str.split("\n")
if(1==lines.length)return void out(str)
for(var minIndent=1e4,i=0;i<lines.length;i++){for(var j=0;j<lines[i].length&&" "===lines[i].charAt(j)&&minIndent>j;j++);j>0&&minIndent>j&&(minIndent=j)}if(1e4===minIndent)return void out(str)
for(var i=0;i<lines.length;i++)lines[i].length&&" "===lines[i].charAt(0)&&(lines[i]=indent+lines[i].substring(minIndent)),out(lines[i]),i<lines.length-1&&out("\n")}},moreCompact:{__proto__:AbstractFormatter},compressed:{__proto__:AbstractFormatter,stringify:function(obj){return Iuppiter.Base64.encode(Iuppiter.compress(JSONUtil.compact.stringify(obj),!0))}}}
JSONUtil.prettyModel={__proto__:JSONUtil.pretty,outputModel_:function(out,obj,indent){out(indent,'model_: "',obj.model_.id,'"')},keys_:{},keyify:function(str){return this.keys_.hasOwnProperty(str)||(this.keys_[str]=/^[a-zA-Z\$_][0-9a-zA-Z$_]*$/.test(str)?str:'"'+str+'"'),this.keys_[str]}},JSONUtil.stringify=JSONUtil.pretty.stringify.bind(JSONUtil.pretty),JSONUtil.stringifyObject=JSONUtil.pretty.stringifyObject.bind(JSONUtil.pretty),JSONUtil.output=JSONUtil.pretty.output.bind(JSONUtil.pretty),JSONUtil.where=JSONUtil.pretty.where.bind(JSONUtil.pretty)
var NOT_TRANSIENT=function(prop){return!prop["transient"]},XMLParser={__proto__:grammar,START:seq1(1,sym("whitespace"),sym("tag"),sym("whitespace")),tag:seq("<",sym("tagName"),sym("whitespace"),repeat(sym("attribute"),sym("whitespace")),sym("whitespace"),">",repeat(alt(sym("tag"),sym("text"))),"</",sym("tagName"),">"),label:str(plus(notChars(" =/	\r\n<>'\""))),tagName:sym("label"),text:str(plus(notChar("<"))),attribute:seq(sym("label"),"=",sym("value")),value:str(alt(seq1(1,'"',repeat(notChar('"')),'"'),seq1(1,"'",repeat(notChar("'")),"'"))),whitespace:repeat(alt(" ","	","\r","\n"))}
XMLParser.addActions({tag:function(xs){if(xs[1]!=xs[8])return void 0
var obj={tag:xs[1],attrs:{},children:xs[6]}
return xs[3].forEach(function(attr){obj.attrs[attr[0]]=attr[2]}),obj}})
var XMLUtil={escape:function(str){return str&&str.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescape:function(str){return str&&str.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},escapeAttr:function(str){return str&&str.replace(/"/g,"&quot;")},unescapeAttr:function(str){return str&&str.replace(/&quot;/g,'"')},parse:function(str){var result=XMLParser.parseString(str)
return result?this.parseArray(result.children):result},parseObject:function(tag){var obj={},self=this
if(tag.children.forEach(function(c){if("object"==typeof c&&c.attrs&&c.attrs.name){var result
if(c.attrs.type&&"function"==c.attrs.type){var code=XMLUtil.unescape(c.children.join(""))
result=code.startsWith("function")?eval("("+code+")"):new Function(code)}else result=self.parseArray(c.children)
obj[self.unescapeAttr(c.attrs.name)]=result}}),!tag.attrs.model)return obj
var model=this.unescapeAttr(tag.attrs.model)
return GLOBAL[model]?GLOBAL[model].create(obj):obj},parseArray:function(a){var self=this,ret=[]
return a.forEach(function(x){"object"==typeof x&&("i"==x.tag?ret.push(XMLUtil.unescape(x.children[0])):ret.push(self.parseObject(x)))}),ret.length?ret:XMLUtil.unescape(a.join(""))},compact:{stringify:function(obj){var buf=[]
return this.output(buf.push.bind(buf),obj),"<foam>"+buf.join("")+"</foam>"},output:function(out,obj){Array.isArray(obj)?this.outputArray_(out,obj):"string"==typeof obj?out(XMLUtil.escape(obj)):obj instanceof Function?this.outputFunction_(out,obj):obj instanceof Object?obj.model_?this.outputObject_(out,obj):this.outputMap_(out,obj):out(obj)},outputObject_:function(out,obj){out('<object model="',XMLUtil.escapeAttr(obj.model_.name),'">')
var properties=obj.model_.getRuntimeProperties()
for(var key in properties){var prop=properties[key]
if("parent"!==prop.name&&obj.instance_&&prop.name in obj.instance_){var val=obj[prop.name]
if(Array.isArray(val)&&0==val.length)continue
if(val==prop.defaultValue)continue
out('<property name="',XMLUtil.escapeAttr(prop.name),'" '+("function"==typeof val?'type="function"':"")+">"),this.output(out,val),out("</property>")}}out("</object>")},outputMap_:function(out,obj){out("<object>")
for(var key in obj){var val=obj[key]
out('<property name="',XMLUtil.escapeAttr(key),'">'),this.output(out,val),out("</property>")}out("</object>")},outputArray_:function(out,a){if(0==a.length)return out
for(var i=0;i<a.length;i++,first=!1){var obj=a[i]
"string"==typeof obj||"number"==typeof obj?out("<i>",XMLUtil.escape(obj),"</i>"):this.output(out,obj)}},outputFunction_:function(out,f){out(XMLUtil.escape(f.toString()))}},pretty:{stringify:function(obj){var buf=[]
return this.output(buf.push.bind(buf),obj),"<foam>\n"+buf.join("")+"</foam>\n"},output:function(out,obj,opt_indent){var indent=opt_indent||""
if(Array.isArray(obj))this.outputArray_(out,obj,indent)
else if("string"==typeof obj)out(XMLUtil.escape(obj))
else if(obj instanceof Function)this.outputFunction_(out,obj,indent)
else if(obj instanceof Object)try{obj.model_&&"string"!=typeof obj.model_?this.outputObject_(out,obj,indent):this.outputMap_(out,obj,indent)}catch(x){console.log("toXMLError: ",x)}else out(obj)},outputObject_:function(out,obj,opt_indent){var indent=opt_indent||"",nestedIndent=indent+"  "
out(indent,'<object model="',XMLUtil.escapeAttr(obj.model_.name),'">')
var properties=obj.model_.getRuntimeProperties()
for(var key in properties){var prop=properties[key]
if("parent"!==prop.name&&obj.instance_&&prop.name in obj.instance_){var val=obj[prop.name]
if(Array.isArray(val)&&0==val.length)continue
if(val==prop.defaultValue)continue
var type="function"==typeof obj[prop.name]?' type="function"':""
out("\n",nestedIndent,'<property name="',XMLUtil.escapeAttr(prop.name),'"',type,">"),this.output(out,val,nestedIndent),out("</property>")}}out("\n",indent,"</object>"),out("\n")},outputMap_:function(out,obj,opt_indent){var indent=opt_indent||"",nestedIndent=indent+"  "
out(indent,"<object>")
for(var key in obj){var val=obj[key]
out("\n",nestedIndent,'<property name="',XMLUtil.escapeAttr(key),'">'),this.output(out,val,nestedIndent),out("</property>")}out("\n",indent,"</object>\n")},outputArray_:function(out,a,opt_indent){if(0==a.length)return out
for(var indent=opt_indent||"",nestedIndent=indent+"  ",i=0;i<a.length;i++,first=!1){var obj=a[i]
out("\n"),"string"==typeof obj||"number"==typeof obj?out(nestedIndent,"<i>",XMLUtil.escape(obj),"</i>"):this.output(out,obj,nestedIndent)}out("\n",indent)},outputFunction_:function(out,f,opt_indent){out(XMLUtil.escape(f.toString())+"\n"+(opt_indent||""))}}}
XMLUtil.stringify=XMLUtil.pretty.stringify.bind(XMLUtil.pretty),XMLUtil.output=XMLUtil.pretty.output.bind(XMLUtil.pretty),GLOBAL.lookupCache_={}
var X=sub({}),foam=X.foam={},registerFactory=function(model,factory){},registerModelForModel=function(modelType,targetModel,model){},registerFactoryForModel=function(factory,targetModel,model){},JSONParser=SkipGrammar.create({__proto__:grammar,START:copyInput(sym("objAsString")),objAsString:copyInput(sym("obj")),obj:seq1(1,"{",repeat(sym("pair"),","),"}"),pair:seq(sym("key"),":",sym("value")),key:alt(sym("symbol"),sym("string")),symbol:noskip(str(seq(sym("char"),str(repeat(sym("alpha")))))),"char":alt(range("a","z"),range("A","Z"),"_","$"),alpha:alt(range("a","z"),range("A","Z"),"_","$",range("0","9")),value:simpleAlt(sym("function literal"),sym("expr"),sym("number"),sym("string"),sym("obj"),sym("bool"),sym("array")),expr:str(seq(sym("symbol"),optional(str(alt(seq(".",sym("expr")),seq("(",str(repeat(sym("value"),",")),")")))))),number:noskip(seq(optional("-"),repeat(range("0","9"),null,1),optional(seq(".",repeat(range("0","9")))))),string:noskip(alt(sym("single quoted string"),sym("double quoted string"))),"double quoted string":seq1(1,'"',str(repeat(sym("double quoted char"))),'"'),"double quoted char":alt(sym("escape char"),literal('\\"','"'),notChar('"')),"single quoted string":seq1(1,"'",str(repeat(sym("single quoted char"))),"'"),"single quoted char":alt(sym("escape char"),literal("\\'","'"),notChar("'")),"escape char":alt(literal("\\\\","\\"),literal("\\n","\n")),bool:alt(literal("true",!0),literal("false",!1)),array:seq1(1,"[",repeat(sym("value"),","),"]"),"function literal":seq("function",optional(sym("symbol")),"(",repeat(sym("symbol"),","),")","{",repeat(notChar("}")),"}")}.addActions({obj:function(v){for(var m={},i=0;i<v.length;i++)m[v[i][0]]=v[i][2]
return m}}),repeat0(alt(" ","	","\n","\r")))
MODEL({name:"TemplateParser",extendsModel:"grammar",methods:{START:sym("markup"),markup:repeat0(alt(sym("comment"),sym("foamTag"),sym("create child"),sym("simple value"),sym("live value tag"),sym("raw values tag"),sym("values tag"),sym("code tag"),sym("ignored newline"),sym("newline"),sym("single quote"),sym("text"))),comment:seq1(1,"<!--",repeat0(not("-->",anyChar)),"-->"),foamTag:sym("foamTag_"),foamTag_:function(){},"create child":seq("$$",repeat(notChars(" $\r\n<{,.")),optional(JSONParser["export"]("objAsString"))),"simple value":seq("%%",repeat(notChars(' ()-"\r\n><:;,')),optional("()")),"live value tag":seq("<%#",repeat(not("%>",anyChar)),"%>"),"raw values tag":alt(seq("<%=",repeat(not("%>",anyChar)),"%>"),seq("{{{",repeat(not("}}}",anyChar)),"}}}")),"values tag":seq("{{",repeat(not("}}",anyChar)),"}}"),"code tag":seq("<%",repeat(not("%>",anyChar)),"%>"),"ignored newline":alt(literal("\\\r\\\n"),literal("\\\n")),newline:alt(literal("\r\n"),literal("\n")),"single quote":literal("'"),text:anyChar}})
var TemplateOutput={create:function(obj){console.assert(obj,"Owner required when creating TemplateOutput.")
var buf=[],f=function templateOut(){for(var i=0;i<arguments.length;i++){var o=arguments[i]
"string"==typeof o?buf.push(o):o&&"Element"===o.name_?(buf.push(o.toString()),obj.addChild({initHTML:o.load.bind(o)})):(o&&o.toView_&&(o=o.toView_()),null!==o&&void 0!==o&&(o.appendHTML?o.appendHTML(this):o.toHTML?buf.push(o.toHTML()):buf.push(o),o.initHTML&&obj&&obj.addChild&&obj.addChild(o)))}}
return f.toString=function(){return 0===buf.length?"":(buf.length>1&&(buf=[buf.join("")]),buf[0])},f}},ConstantTemplate=function(str){var TemplateOutputCreate=TemplateOutput.create.bind(TemplateOutput),f=function(opt_out){var out=opt_out?opt_out:TemplateOutputCreate(this)
return out(str),out.toString()}
return f.toString=function(){return'ConstantTemplate("'+str.replace(/\n/g,"\\n").replace(/"/g,'\\"').replace(/\r/g,"")+'")'},f},TemplateCompiler={__proto__:TemplateParser,out:[],simple:!0,push:function(){this.simple=!1,this.pushSimple.apply(this,arguments)},pushSimple:function(){this.out.push.apply(this.out,arguments)}}.addActions({markup:function(v){var wasSimple=this.simple,ret=wasSimple?null:this.out.join("")
return this.out=[],this.simple=!0,[wasSimple,ret]},"create child":function(v){var name=v[1].join("")
this.push("', self.createTemplateView('",name,"'",v[2]?", "+v[2]:"","),\n'")},foamTag:function(e){var fName=e.getAttribute("f")
fName?(this.push("', self.createTemplateView('",fName,"',{}).fromElement(FOAM("),this.push(JSONUtil.where(NOT_TRANSIENT).stringify(e)),this.push("))")):(this.push("', (function() { var tagView = X.foam.ui.FoamTagView.create({element: FOAM("),this.push(JSONUtil.where(NOT_TRANSIENT).stringify(e)),this.push(")}, Y); self.addDataChild(tagView); return tagView; })() ")),this.push(",\n'")},"simple value":function(v){this.push("',\n self.",v[1].join(""),v[2],",\n'")},"raw values tag":function(v){this.push("',\n",v[1].join(""),",\n'")},"values tag":function(v){this.push("',\nescapeHTML(",v[1].join(""),"),\n'")},"live value tag":function(v){this.push("',\nself.dynamicTag('span', function() { return ",v[1].join(""),"; }.bind(this)),\n'")},"code tag":function(v){this.push("');\n",v[1].join(""),";out('")},"single quote":function(){this.pushSimple("\\'")},newline:function(){this.pushSimple("\\n")},text:function(v){this.pushSimple(v)}})
MODEL({name:"TemplateUtil",constants:{HEADER:"var self = this, X = this.X, Y = this.Y;var out = opt_out ? opt_out : TOC(this);out('",FOOTERS:{html:"');return out.toString();",css:"');return X.foam.grammars.CSS3.create().parser.parseString(out.toString()).toString();"}},methods:{lazyCompile:function(t){var delegate,f=function(){if(!delegate){if(!t.template)throw"Must arequire() template model before use for "+this.name_+"."+t.name
delegate=TemplateUtil.compile(Template.isInstance(t)?t:Template.create(t),this.model_)}return delegate.apply(this,arguments)}
return f.toString=function(){return delegate?delegate.toString():t.toString()},f},compile_:function(t,code,model){for(var args=["opt_out"],i=0;i<t.args.length;i++)args.push(t.args[i].name)
return eval("(function() { var escapeHTML = XMLUtil.escape, TOC = TemplateOutput.create.bind(TemplateOutput); return function("+args.join(",")+"){"+code+"};})()"+(model?"\n\n//# sourceURL="+model.id.split(".").join("/")+"."+t.name+"\n":""))},compile:function(t,model){var parseResult=TemplateCompiler.parseString(t.template)
if(parseResult[0])return ConstantTemplate("css"===t.language?X.foam.grammars.CSS3.create().parser.parseString(t.template).toString():t.template)
var code=this.HEADER+parseResult[1]+this.FOOTERS[t.language]
try{return this.compile_(t,code,model)}catch(err){return console.log("Template Error: ",err),console.log(parseResult),function(){}}},stringifyTemplate:function(template){return function(){var buf=[]
return this.output(buf.push.bind(buf),obj),buf.join("")}},expandTemplate:function(self,t,opt_X){var X=opt_X||self.X
if("function"==typeof t)t=X.Template.create({name:t.name,args:t.toString().match(/\((.*?)\)/)[1].split(",").slice(1).map(function(a){return X.Arg.create({name:a.trim()})}),template:multiline(t)})
else if("string"==typeof t)t=docTemplate=X.Template.create({name:"body",template:t})
else if(t.template||t.code)"function"==typeof t.template&&(t.template=multiline(t.template))
else{t=X.Template.create(t)
var future=afuture(),path=self.sourcePath
if(t.futureTemplate=future.get,path=path.substring(0,path.lastIndexOf("/")+1),path+=t.path?t.path:self.name+"_"+t.name+".ft",window.XMLHttpRequest){var xhr=new XMLHttpRequest
xhr.open("GET",path),xhr.asend(function(data){t.template=data,future.set(Template.create(t))})}else{var fs=require("fs")
fs.readFile(path,function(err,data){t.template=data.toString(),future.set(Template.create(t))})}}return t.futureTemplate||(t.futureTemplate=aconstant(t)),t.template$||(t="undefined"!=typeof X.Template?JSONUtil.mapToObj(X,t,X.Template):t),t},expandModelTemplates:function(self){for(var templates=self.templates,i=0;i<templates.length;i++)templates[i]=TemplateUtil.expandTemplate(self,templates[i])}}})
var aeval=function(src){return aconstant(eval("("+src+")"))},aevalTemplate=function(t,model){return aseq(t.futureTemplate,function(ret,t){ret(TemplateUtil.lazyCompile(t))})},escapeHTML=XMLUtil.escape,TOC=TemplateOutput.create.bind(TemplateOutput),$documents=[]
window&&$documents.push(window.document)
var $WID__=0,$=function(id){console.log("Deprecated use of GLOBAL.$.")
for(var i=0;i<$documents.length;i++){if(document.FOAM_OBJECTS&&document.FOAM_OBJECTS[id])return document.FOAM_OBJECTS[id]
var ret=$documents[i].getElementById(id)
if(ret)return ret}return void 0},$$=function(cls){console.log("Deprecated use of GLOBAL.$$.")
for(var i=0;i<$documents.length;i++){var ret=$documents[i].getElementsByClassName(cls)
if(ret.length>0)return ret}return[]},FOAM=function(map,opt_X,seq){var obj=JSONUtil.mapToObj(opt_X||X,map,void 0,seq)
return obj}
FOAM.putFactory=function(ctx,name,factory){ctx.__defineGetter__(name,function(){return console.log("Bouncing Factory: ",name),delete ctx[name],ctx[name]=factory()})}
var USED_MODELS={},UNUSED_MODELS={},NONMODEL_INSTANCES={}
FOAM.browse=function(model,opt_dao,opt_X){var Y=opt_X||X.sub(void 0,"FOAM BROWSER")
"string"==typeof model&&(model=Y[model])
var dao=opt_dao||Y[model.name+"DAO"]||Y[model.plural]
dao||(Y[model.name+"DAO"]=[].dao)
var ctrl=Y.foam.ui.DAOController.create({model:model,dao:dao,useSearchView:!1})
if(Y.stack)Y.stack.pushView(ctrl)
else{var w=opt_X?opt_X.window:window
Y.stack=Y.foam.ui.StackView.create()
var win=Y.foam.ui.layout.Window.create({window:w,data:Y.stack},Y)
document.body.insertAdjacentHTML("beforeend",win.toHTML()),win.initHTML(),Y.stack.setTopView(ctrl)}}
var arequire=function(modelName){var THIS=this===GLOBAL?X:this,model=THIS.lookup(modelName)
if(!model){if(!THIS.ModelDAO)return aconstant()
if(THIS.arequire$ModelLoadsInProgress){if(THIS.arequire$ModelLoadsInProgress[modelName])return THIS.arequire$ModelLoadsInProgress[modelName]}else THIS.set("arequire$ModelLoadsInProgress",{})
var future=afuture()
return THIS.arequire$ModelLoadsInProgress[modelName]=future.get,THIS.ModelDAO.find(modelName,{put:function(m){m.X=THIS,m.arequire()(function(m){THIS.arequire$ModelLoadsInProgress[modelName]=!1,THIS.GLOBAL.X.registerModel(m),THIS.lookupCache_[m.id]||(THIS.lookupCache_[m.id]=m),future.set(m)})},error:function(){var args=argsToArray(arguments)
console.warn.apply(console,["Could not load model: ",modelName].concat(args)),THIS.arequire$ModelLoadsInProgress[modelName]=!1,future.set(void 0)}}),future.get}return model.arequire()},FOAM_POWERED='<a style="text-decoration:none;" href="https://github.com/foam-framework/foam/" target="_blank"><font size=+1 face="catull" style="text-shadow:rgba(64,64,64,0.3) 3px 3px 4px;"><font color="#3333FF">F</font><font color="#FF0000">O</font><font color="#FFCC00">A</font><font color="#33CC00">M</font><font color="#555555" > POWERED</font></font></a>',CLASS=function(m){function registerModelLatch(path,m){var id=m["package"]?m["package"]+"."+m.name:m.name
if(EAGER[id]){USED_MODELS[id]=!0
var work=[],model=JSONUtil.mapToObj(X,m,Model,work)
return work.length>0&&(model.extra__=aseq.apply(null,work)),X.registerModel(model,void 0,!0),model}GLOBAL.lookupCache_[id]=void 0,UNUSED_MODELS[id]=!0
var triggered=!1
Object.defineProperty(m["package"]?path:GLOBAL,m.name,{get:function triggerModelLatch(){if(triggered)return null
triggered=!0,USED_MODELS[id]=!0,UNUSED_MODELS[id]=void 0
var work=[],model=JSONUtil.mapToObj(X,m,Model,work)
return work.length>0&&(model.extra__=aseq.apply(null,work)),X.registerModel(model),model},configurable:!0})}var EAGER={Method:!0,BooleanProperty:!0,Action:!0,FunctionProperty:!0,Constant:!0,Message:!0,ArrayProperty:!0,StringArrayProperty:!0,Template:!0,Arg:!0,Relationship:!0,ViewFactoryProperty:!0,FactoryProperty:!0,"foam.ui.Window":!0,StringProperty:!0,"foam.html.Element":!0,Expr:!0,AbstractDAO:!0}
document&&document.currentScript&&(m.sourcePath=document.currentScript.src),registerModelLatch(packagePath(X,m["package"]),m)},MODEL=CLASS,FObject={__proto__:PropertyChangeSupport,name_:"FObject",get Y(){return Object.prototype.hasOwnProperty.call(this,"Y_")?this.Y_:this.Y_=DEBUG?this.X.sub({},(this.X.NAME?this.X.NAME:"")+"Y"):this.X.sub()},replaceModel_:function(model,otherModel,X){for(;otherModel;){var replacementName=(model["package"]?model["package"]+".":"")+(otherModel.name?otherModel.name:otherModel)+model.name,replacementModel=X.lookup(replacementName)
if(replacementModel)return replacementModel
otherModel=X.lookup(otherModel.extendsModel)}return void 0},create_:function(){return Object.create(this)},create:function(args,opt_X){if(args&&args.model&&(opt_X||X).Model.isInstance(args.model)){var ret=this.replaceModel_(this.model_,args.model,opt_X||X)
if(ret)return ret.create(args,opt_X)}var o=this.create_(this)
for(o.instance_={};!o.instance_;)o.instance_={}
if(o.X=opt_X||X,this.model_.instance_.imports_&&this.model_.instance_.imports_.length){Object.prototype.hasOwnProperty.call(this,"imports__")||(this.imports__=this.model_.instance_.imports_.map(function(e){var s=e.split(" as ")
return[s[0],s[1]||s[0]]}))
for(var i=0;i<this.imports__.length;i++){var im=this.imports__[i]
args&&args.hasOwnProperty(im[1])||"undefined"==typeof o.X[im[0]]||(o[im[1]]=o.X[im[0]])}}if(o.model_)for(var agents=this.initAgents(),i=0;i<agents.length;i++)agents[i][1](o,o.X,args)
return o.init(args),o},init:nop,xbind:function(map){var newModel={__proto__:this,create:function(args,X){var createArgs={},key
args=args?args.instance_||args:{}
for(key in args)args.hasOwnProperty(key)&&(createArgs[key]=args[key])
for(key in map)createArgs.hasOwnProperty(key)||(createArgs[key]=map[key])
return this.__proto__.create(createArgs,X)},xbind:function(m2){for(var key in map)m2.hasOwnProperty(key)||(m2[key]=map[key])
return this.__proto__.xbind(m2)}}
return this.required__&&(newModel.required__=aseq(this.required__,aconstant(newModel))),newModel},X:X,addInitAgent:function(priority,desc,agent){agent.toString=function(){return desc},this.initAgents_.push([priority,agent])},initAgents:function(){if(this.model_){if(!Object.hasOwnProperty.call(this,"initAgents_")){var agents=this.initAgents_=[],self=this
Object_forEach(this.model_.instance_.exports_,function(e){var exp=e.split("as ")
if(0!=exp.length){var key=exp[0].trim(),alias=exp[1]||exp[0]
if(key){var asValue="$"!==key&&"$$"!=key&&"$"==key.charAt(key.length-1)
asValue&&(key=key.slice(0,key.length-1))
var prop=self.model_.getProperty(key)
prop?asValue?self.addInitAgent(1,"export property value "+key,function(o,X){o.Y.set(alias,o[prop.name$_])}):self.addInitAgent(1,"export property "+key,function(o,X){o.Y.setValue(alias,o[prop.name$_])}):self.addInitAgent(0,"export other "+key,function(o,X){var out="function"==typeof o[key]?o[key].bind(o):o[key]
o.Y.set(alias,out)})}else self.addInitAgent(0,"export this",function(o,X){o.Y.set(alias,o)})}})
var fastInit={Property:!0,Method:!0}[this.name_]
if(fastInit){for(var keys={},ps=this.model_.getRuntimeProperties(),i=0;i<ps.length;i++){var prop=ps[i]
keys[prop.name]=keys[prop.name$_]=!0}this.addInitAgent(0,"fast copy args",function fastCopyArgs(o,X,m){if(m)if(m.instance_){m=m.instance_
for(var key in m)o[key]=m[key]}else for(var key in m)keys[key]&&(o[key]=m[key])})}for(var ps=this.model_.getRuntimeProperties(),i=0;i<ps.length;i++){var prop=ps[i]
prop.initPropertyAgents?prop.initPropertyAgents(self,fastInit):!function(name){self.addInitAgent(0,"set proto-property "+name,function setProtoProperty(o,X,m){m&&m.hasOwnProperty(name)&&(o[name]=m[name])})}(prop.name)}self.addInitAgent(0,"Add create() to Model",function(o,X){Model.isInstance(o)&&"Model"!=o.name&&(o.create=BootstrapModel.create)})
for(var i=0;i<agents.length;i++)agents[i][2]=i
agents.sort(CompoundComparator(function(o1,o2){return o1[0]-o2[0]},function(o1,o2){return o1[2]-o2[2]}))}return this.initAgents_}},fromElement:function(e){var RESERVED_ATTRS={id:!0,model:!0,view:!0,showactions:!0,oninit:!0},elements=this.elementMap_
if(!elements){elements={}
for(var properties=this.model_.getRuntimeProperties(),i=0;i<properties.length;i++){var p=properties[i]
RESERVED_ATTRS[p.name]||(elements[p.name]=p,elements[p.name.toUpperCase()]=p),elements["p:"+p.name]=p,elements["P:"+p.name.toUpperCase()]=p}this.elementMap_=elements}for(var i=0;i<e.attributes.length;i++){var attr=e.attributes[i],p=elements[attr.name],val=attr.value
if(p)if(val.startsWith("#")){val=val.substring(1)
var $val=this.X.$(val)
$val?this[attr.name]=this.X.$(val):p.fromString.call(this,val,p)}else p.fromString.call(this,val,p)
else RESERVED_ATTRS[attr.name]||console.warn('Unknown attribute name: "'+attr.name+'"')}for(var i=0;i<e.children.length;i++){var c=e.children[i],p=elements[c.nodeName]
p?p.fromElement.call(this,c,p):console.warn('Unknown element name: "'+c.nodeName+'"')}return this},createFOAMGetter:function(name,getter){var stack=Events.onGet.stack
return function FOAMGetter(){var value=getter.call(this,name),f=stack[0]
return f&&f(this,name,value),value}},createFOAMSetter:function(name,setter){var stack=Events.onSet.stack
return function FOAMSetter(newValue){var f=stack[0];(!f||f(this,name,newValue))&&setter.call(this,newValue,name)}},toString:function(){return this.model_.name+"Prototype"},hasOwnProperty:function(name){return"undefined"!=typeof this.instance_[name]},writeActions:function(other,out){for(var properties=this.model_.getRuntimeProperties(),i=0,property;property=properties[i];i++)if(property.actionFactory)for(var actions=property.actionFactory(this,property.f(this),property.f(other)),j=0;j<actions.length;j++)out(actions[j])},validate:function(){for(var ret=null,ps=this.model_.getRuntimeProperties(),i=0;i<ps.length;i++){var p=ps[i]
if(p.validate){var e=p.validate.call(this)
e&&(ret||(ret=[])).push([p,e])}}return ret},isValid:function(){return!this.validate()},equals:function(other){return 0==this.compareTo(other)},compareTo:function(other){if(other===this)return 0
if(this.model_!==other.model_)return this.model_.id.compareTo(other.model_&&other.model_.id)||1
for(var ps=this.model_.getRuntimeProperties(),i=0;i<ps.length;i++){var r=ps[i].compare(this,other)
if(r)return r}return 0},diff:function(other){for(var diff={},properties=this.model_.getRuntimeProperties(),i=0,property;property=properties[i];i++)if(Array.isArray(property.f(this))){var subdiff=property.f(this).diff(property.f(other));(0!==subdiff.added.length||0!==subdiff.removed.length)&&(diff[property.name]=subdiff)}else 0!==property.f(this).compareTo(property.f(other))&&(diff[property.name]=property.f(other))
return diff},clearProperty:function(name){delete this.instance_[name]},defineProperty:function(prop){var name=prop.name
prop.name$_=name+"$"
var obj=DEBUG?this:__ROOT__
obj.__lookupGetter__(prop.name$_)||Object.defineProperty(obj,prop.name$_,{get:function getValue(){return this.propertyValue(name)},set:function setValue(value){Events.link(value,this.propertyValue(name))},configurable:!0})
var pgetter,psetter
if(prop.getter)pgetter=this.createFOAMGetter(name,prop.getter)
else{if(prop.lazyFactory||prop.factory){var f=prop.lazyFactory||prop.factory
getter=function factory(){if("undefined"==typeof this.instance_[name]){this.instance_[name]=null
var val=f.call(this,prop)
"undefined"==typeof val&&(val=null),this[name]=val}return this.instance_[name]}}else if(prop.defaultValueFn){var f=prop.defaultValueFn
getter=function defaultValueFn(){return"undefined"!=typeof this.instance_[name]?this.instance_[name]:f.call(this,prop)}}else{var defaultValue=prop.defaultValue
getter=function getInstanceVar(){return"undefined"!=typeof this.instance_[name]?this.instance_[name]:defaultValue}}pgetter=this.createFOAMGetter(name,getter)}if(prop.setter)psetter=this.createFOAMSetter(name,prop.setter)
else{var setter=function setInstanceValue(oldValue,newValue){this.instance_[name]=newValue};("int"===prop.type||"float"===prop.type)&&(setter=function(setter){return function numberSetter(oldValue,newValue){setter.call(this,oldValue,"number"!=typeof newValue?Number(newValue):newValue)}}(setter)),prop.onDAOUpdate&&(setter="string"==typeof prop.onDAOUpdate?function(setter,onDAOUpdate,listenerName){return function onDAOUpdateSetter(oldValue,newValue){setter.call(this,oldValue,newValue)
var listener=this[listenerName]||(this[listenerName]=this[onDAOUpdate].bind(this))
oldValue&&oldValue.unlisten(listener),newValue&&(newValue.listen(listener),listener())}}(setter,prop.onDAOUpdate,prop.name+"_onDAOUpdate"):function(setter,onDAOUpdate,listenerName){return function onDAOUpdateSetter2(oldValue,newValue){setter.call(this,oldValue,newValue)
var listener=this[listenerName]||(this[listenerName]=onDAOUpdate.bind(this))
oldValue&&oldValue.unlisten(listener),newValue&&(newValue.listen(listener),listener())}}(setter,prop.onDAOUpdate,prop.name+"_onDAOUpdate")),prop.postSet&&(setter=function(setter,postSet){return function postSetSetter(oldValue,newValue){setter.call(this,oldValue,newValue),postSet.call(this,oldValue,newValue,prop)}}(setter,prop.postSet))
var propertyTopic=PropertyChangeSupport.propertyTopic(name)
setter=function(setter){return function propertyChangeSetter(oldValue,newValue){setter.call(this,oldValue,newValue),this.propertyChange_(propertyTopic,oldValue,newValue)}}(setter),prop.preSet&&(setter=function(setter,preSet){return function preSetSetter(oldValue,newValue){setter.call(this,oldValue,preSet.call(this,oldValue,newValue,prop))}}(setter,prop.preSet)),prop.adapt&&(setter=function(setter,adapt){return function adaptSetter(oldValue,newValue){setter.call(this,oldValue,adapt.call(this,oldValue,newValue,prop))}}(setter,prop.adapt)),setter=function(setter,defaultValue){return function setInstanceVar(newValue){setter.call(this,"undefined"==typeof this.instance_[name]?defaultValue:this.instance_[name],newValue)}}(setter,prop.defaultValue),psetter=this.createFOAMSetter(name,setter)}Object.defineProperty(this,name,{get:pgetter,set:psetter,configurable:!0}),prop.install&&prop.install.call(this,prop)},addMethod:function(name,method){this.__proto__[name]?override(this,name,method):this[name]=method},hashCode:function(){for(var hash=17,properties=this.model_.getRuntimeProperties(),i=0;i<properties.length;i++){var prop=this[properties[i].name],code=prop?prop.hashCode?prop.hashCode():prop.toString().hashCode():0
hash=(hash<<5)-hash+code,hash&=hash}return hash},toProtobuf:function(){var out=ProtoWriter.create()
return this.outProtobuf(out),out.value},outProtobuf:function(out){for(var proprties=this.model_getRuntimeProperties(),i=0;i<properties.length;i++){var prop=properties[i]
Number.isFinite(prop.prototag)&&prop.outProtobuf(this,out)}},clone:function(){var c=Object.create(this.__proto__)
c.instance_={},c.X=this.X
for(var key in this.instance_){var value=this[key]
if(void 0!==value){var prop=this.model_.getProperty(key)
prop&&prop.cloneProperty&&(c.instance_[key]=prop.cloneProperty.call(prop,value))}}return c},deepClone:function(){var c=Object.create(this.__proto__)
c.instance_={},c.X=this.X
for(var key in this.instance_){var value=this[key]
if(void 0!==value){var prop=this.model_.getProperty(key)
prop&&prop.deepCloneProperty&&(c.instance_[key]=prop.deepCloneProperty.call(prop,value))}}return c},copyFrom:function(src){if(src&&this.model_)for(var ps=this.model_.getRuntimeProperties(),i=0;i<ps.length;i++){var prop=ps[i]
src.hasOwnProperty(prop.name)&&(this[prop.name]=src[prop.name]),src.hasOwnProperty(prop.name$_)&&(this[prop.name$_]=src[prop.name$_])}return this},output:function(out){return JSONUtil.output(out,this)},toJSON:function(){return JSONUtil.stringify(this)},toXML:function(){return XMLUtil.stringify(this)},write:function(opt_X,opt_view){(opt_X||this.X).writeView(this.defaultView(opt_view))},defaultView:function(opt_view){return(opt_view||X.foam.ui.DetailView).create({model:this.model_,data:this,showActions:!0})},decorate:function(name,func,that){var delegate=this[name]
return this[name]=function(){return func.call(this,that,delegate.bind(this),arguments)},this},addDecorator:function(decorator){decorator.decorateObject&&decorator.decorateObject(this)
for(var i=0;i<decorator.model_.methods.length;i++){var method=decorator.model_.methods[i]
"decorateObject"!==method.name&&this.decorate(method.name,method.code,decorator)}return this}}
this.Constant=null,this.Method=null,this.Action=null,this.Relationship=null
var BootstrapModel={__proto__:PropertyChangeSupport,name_:"BootstrapModel <startup only, error if you see this>",addTraitToModel_:function(traitModel,parentModel){var parentName=parentModel&&parentModel.id?parentModel.id.replace(/\./g,"__"):"",traitName=traitModel.id?traitModel.id.replace(/\./g,"__"):"",name=parentName+"_ExtendedWith_"+traitName
if(!lookup(name)){var model=traitModel.clone()
model["package"]="",model.name=name,model.extendsModel=parentModel&&parentModel.id,model.models=traitModel.models,GLOBAL.X.registerModel(model)}var ret=GLOBAL.X.lookup(name)
return console.assert(ret,"Error adding Trait to Model, unknown name: ",name),ret},buildProtoImports_:function(props){Object_forEach(this.instance_.imports_,function(i){var imp=i.split(" as "),key=imp[0],alias=imp[1]||imp[0]
if(alias.length&&"$"==alias.charAt(alias.length-1)&&(alias=alias.slice(0,alias.length-1)),!this.getProperty(alias)){var prop=Property.create({name:alias,"transient":!0,hidden:!0})
prop.cloneProperty=prop.deepCloneProperty=null,props.push(prop)}}.bind(this))},buildProtoProperties_:function(cls,extendsModel,props){for(var i=0;i<props.length;i++){var p=props[i]
if(extendsModel){var superProp=extendsModel.getProperty(p.name)
if(superProp){var p0=p
p=superProp.clone().copyFrom(p),p0.adapt&&superProp.adapt&&(p.adapt=function(a1,a2){return function(oldValue,newValue,prop){return a2.call(this,oldValue,a1.call(this,oldValue,newValue,prop),prop)}}(p0.adapt,superProp.adapt)),p0.preSet&&superProp.preSet&&(p.preSet=function(a1,a2){return function(oldValue,newValue,prop){return a2.call(this,oldValue,a1.call(this,oldValue,newValue,prop),prop)}}(p0.preSet,superProp.preSet)),p0.postSet&&superProp.postSet&&(p.postSet=function(a1,a2){return function(oldValue,newValue,prop){a2.call(this,oldValue,newValue,prop),a1.call(this,oldValue,newValue,prop)}}(p0.postSet,superProp.postSet)),props[i]=p,this[constantize(p.name)]=p}}cls.defineProperty(p)}this.propertyMap_=null},buildProtoMethods_:function(cls){if(Array.isArray(this.methods))for(var i=0;i<this.methods.length;i++){var m=this.methods[i]
"function"==typeof m?cls.addMethod(m.name,m):cls.addMethod(m.name,m.code)}else for(key in this.methods){var m=this.methods[key]
Method&&Method.isInstance(m)?cls.addMethod(m.name,m.generateFunction()):cls.addMethod(key,m)}},buildPrototype:function(){if(_DOC_&&BootstrapModel.saveDefinition(this),this.extendsModel&&!this.X.lookup(this.extendsModel))throw"Unknown Model in extendsModel: "+this.extendsModel
var extendsModel=this.extendsModel&&this.X.lookup(this.extendsModel)
if(this.traits)for(var i=0;i<this.traits.length;i++){var trait=this.traits[i],traitModel=this.X.lookup(trait)
console.assert(traitModel,"Unknown trait: "+trait),traitModel?extendsModel=this.addTraitToModel_(traitModel,extendsModel):console.warn("Missing trait: ",trait,", in Model: ",this.name)}var proto=extendsModel?extendsModel.getPrototype():FObject,cls=Object.create(proto)
cls.model_=this,cls.name_=this.name,this.models&&Object_forEach(this.models,function(m){this[m.name]&&(cls[m.name]=this[m.name])}.bind(this)),Object_forEach(this.requires,function(i){var imp=i.split(" as "),m=imp[0],path=m.split("."),key=imp[1]||path[path.length-1]
defineLocalProperty(cls,key,function(){var Y=this.Y,model=this.X.lookup(m)
return console.assert(model,"Unknown Model: "+m+" in "+this.name_),{__proto__:model,create:function(args,X){return model.create(args,X||Y)}}})})
var props=this.instance_.properties_=this.properties?this.properties.clone():[]
if(this.instance_.imports_=this.imports,extendsModel&&(this.instance_.imports_=this.instance_.imports_.concat(extendsModel.instance_.imports_)),this.buildProtoImports_(props),this.buildProtoProperties_(cls,extendsModel,props),extendsModel){for(var i=0;i<extendsModel.instance_.properties_.length;i++){var p=extendsModel.instance_.properties_[i],name=constantize(p.name)
this[name]||(this[name]=p)}for(i=0;i<extendsModel.relationships.length;i++){var r=extendsModel.relationships[i],name=constantize(r.name)
this[name]||(this[name]=r)}}if(this.instance_.exports_=this.exports?this.exports.clone():[],extendsModel&&(this.instance_.exports_=this.instance_.exports_.concat(extendsModel.instance_.exports_)),this.templates&&Object_forEach(this.templates,function(t){cls.addMethod(t.name,t.code?t.code:TemplateUtil.lazyCompile(t))}),this.instance_.actions_=this.actions?this.actions.clone():[],this.actions)for(var i=0;i<this.actions.length;i++)(function(a){if(extendsModel){var superAction=extendsModel.getAction(a.name)
superAction&&(a=superAction.clone().copyFrom(a))}this.instance_.actions_[i]=a,Object.prototype.hasOwnProperty.call(cls,constantize(a.name))||(cls[constantize(a.name)]=a),this[constantize(a.name)]=a,cls.addMethod(a.name,function(opt_x){a.maybeCall(opt_x||this.X,this)})}).bind(this)(this.actions[i])
var key
if(this.constants)for(var i=0;i<this.constants.length;i++){var c=this.constants[i]
cls[c.name]=this[c.name]=c.value}this.messages&&this.messages.length>0&&Message&&Object_forEach(this.messages,function(m,key){Message.isInstance(m)||(m=this.messages[key]=Message.create(m))
var clsProps={},mdlProps={},constName=constantize(m.name)
clsProps[m.name]={get:function(){return m.value}},clsProps[constName]={value:m},mdlProps[constName]={value:m},Object.defineProperties(cls,clsProps),Object.defineProperties(this,mdlProps)}.bind(this)),this.buildProtoMethods_(cls)
var self=this
this.relationships&&this.relationships.forEach(function(r){var name=constantize(r.name)
self[name]||(self[name]=r),defineLazyProperty(cls,r.name,function(){var m=this.X.lookup(r.relatedModel),lcName=m.name[0].toLowerCase()+m.name.substring(1),dao=this.X[lcName+"DAO"]||this.X[m.name+"DAO"]||this.X[m.plural]
return dao||console.error("Relationship "+r.name+" needs "+(m.name+"DAO")+" or "+m.plural+" in the context, and neither was found."),dao=RelationshipDAO.create({delegate:dao,relatedProperty:m.getProperty(r.relatedProperty),relativeID:this.id}),{get:function(){return dao},configurable:!0}})})
var createListenerTrampoline=function(cls,name,fn,isMerged,isFramed,whenIdle){console.assert(fn,"createListenerTrampoline: fn not defined"),fn.name=name,Object.defineProperty(cls,name,{get:function(){var l=fn.bind(this)
return whenIdle&&(l=Movement.whenIdle(l)),isFramed?l=EventService.framed(l,this.X):isMerged&&(l=EventService.merged(l,isMerged===!0?void 0:isMerged,this.X)),Object.defineProperty(this,name,{configurable:!0,value:l}),l},configurable:!0})}
if(Array.isArray(this.listeners))for(var i=0;i<this.listeners.length;i++){var l=this.listeners[i]
createListenerTrampoline(cls,l.name,l.code,l.isMerged,l.isFramed,l.whenIdle)}else this.listeners&&Object_forEach(this.listeners,function(l,key){createListenerTrampoline(cls,key,l)})
if(this.topics&&Object_forEach(this.topics,function(t){}),extendsModel){this.getProperty("")
for(var ips=[],ps=extendsModel.instance_.properties_,i=0;i<ps.length;i++){var p=ps[i]
this.getProperty(p.name)||(ips.push(p),this.propertyMap_[p.name]=p)}ips.length&&(this.instance_.properties_=ips.concat(this.instance_.properties_))
for(var ias=[],as=extendsModel.instance_.actions_,i=0;i<as.length;i++){var a=as[i]
this.getAction&&this.getAction(a.name)||ias.push(a)}ias.length&&(this.instance_.actions_=ias.concat(this.instance_.actions_))}if(this.instance_.properties_.length>0&&!cls.__lookupGetter__("id")){var primaryKey=this.ids
1==primaryKey.length?(cls.__defineGetter__("id",function(){return this[primaryKey[0]]}),cls.__defineSetter__("id",function(val){this[primaryKey[0]]=val})):primaryKey.length>1&&(cls.__defineGetter__("id",function(){return primaryKey.map(function(key){return this[key]}.bind(this))}),cls.__defineSetter__("id",function(val){primaryKey.map(function(key,i){this[key]=val[i]}.bind(this))}))}return cls},getAllRequires:function(){function setModel(o){o&&o.model_&&(requires[o.model_.id]=!0)}var requires={}
return this.requires.forEach(function(r){requires[r.split(" ")[0]]=!0}),this.traits.forEach(function(t){requires[t]=!0}),this.extendsModel&&(requires[this.extendsModel]=!0),this.properties.forEach(setModel),this.actions.forEach(setModel),this.templates.forEach(setModel),this.listeners.forEach(setModel),Object.keys(requires)},getPrototype:function(){return this.instance_.prototype_?this.instance_.prototype_:this.instance_.prototype_=this.buildPrototype()},saveDefinition:function(self){self.definition_={},Array.isArray(self.methods)&&(self.definition_.methods=[].concat(self.methods)),Array.isArray(self.templates)&&(self.definition_.templates=[].concat(self.templates)),Array.isArray(self.relationships)&&(self.definition_.relationships=[].concat(self.relationships)),Array.isArray(self.properties)&&(self.definition_.properties=[].concat(self.properties)),Array.isArray(self.actions)&&(self.definition_.actions=[].concat(self.actions)),Array.isArray(self.listeners)&&(self.definition_.listeners=[].concat(self.listeners)),Array.isArray(self.models)&&(self.definition_.models=[].concat(self.models)),Array.isArray(self.tests)&&(self.definition_.tests=[].concat(self.tests)),Array.isArray(self.issues)&&(self.definition_.issues=[].concat(self.issues)),self.definition_.__proto__=FObject},create:function(args,opt_X){return"Model"===this.name?FObject.create.call(this.getPrototype(),args,opt_X):this.getPrototype().create(args,opt_X)},isSubModel:function(model){if(!model||!model.getPrototype)return!1
var subModels_=this.subModels_||(this.subModels_={})
return subModels_.hasOwnProperty(model.id)||(subModels_[model.id]=model.getPrototype()===this.getPrototype()||this.isSubModel(model.getPrototype().__proto__.model_)),subModels_[model.id]},getRuntimeProperties:function(){return this.instance_.properties_||this.getPrototype(),this.instance_.properties_},getRuntimeActions:function(){return this.instance_.actions_||this.getPrototype(),this.instance_.actions_},getProperty:function(name){if(!this.propertyMap_){for(var m=this.propertyMap_={},properties=this.getRuntimeProperties(),i=0;i<properties.length;i++){var prop=properties[i]
m[prop.name]=prop}this.propertyMap_=m}return this.propertyMap_[name]},getAction:function(name){for(var i=0;i<this.instance_.actions_.length;i++)if(this.instance_.actions_[i].name===name)return this.instance_.actions_[i]},hashCode:function(){var string="",properties=this.getRuntimeProperties()
for(var key in properties)string+=properties[key].toString()
return string.hashCode()},isInstance:function(obj){return obj&&obj.model_&&this.isSubModel(obj.model_)},toString:function(){return"BootstrapModel("+this.name+")"},arequire:function(){if(this.required__)return this.required__
var future=afuture()
this.required__=future.get
var go=function(){var args=[],model=this,i
if(this.extendsModel&&args.push(this.X.arequire(this.extendsModel)),this.models)for(i=0;i<this.models.length;i++)args.push(this.models[i].arequire())
if(this.traits)for(i=0;i<this.traits.length;i++)args.push(this.X.arequire(this.traits[i]))
if(this.templates)for(i=0;i<this.templates.length;i++){var t=this.templates[i]
args.push(aif(!t.code,aseq(aevalTemplate(this.templates[i],this),function(t){return function(ret,m){t.code=m,ret()}}(t))))}if(args.length&&(args=[aseq.apply(null,args)]),this.requires)for(var i=0;i<this.requires.length;i++){var r=this.requires[i],m=r.split(" as ")
m[0]==this.id?console.warn("Model requires itself: "+this.id):args.push(this.X.arequire(m[0]))}args.push(function(ret){this.X.i18nModel?this.X.i18nModel(ret,this,this.X):ret()}.bind(this)),aseq.apply(null,args)(function(){this.finished__=!0,future.set(this)}.bind(this))}.bind(this)
return this.extra__?this.extra__(go):go(),this.required__},getMyFeature:function(featureName){function add(a){if(a)for(var i=0;i<a.length;i++){var f=a[i]
map[f.name.toUpperCase()]=f}}if(!Object.prototype.hasOwnProperty.call(this,"featureMap_")){var map=this.featureMap_={}
add(this.getRuntimeProperties()),add(this.instance_.actions_),add(this.methods),add(this.listeners),add(this.templates),add(this.models),add(this.tests),add(this.relationships),add(this.issues)}return this.featureMap_[featureName.toUpperCase()]},getRawFeature:function(featureName){function add(a){if(a)for(var i=0;i<a.length;i++){var f=a[i]
map[f.name.toUpperCase()]=f}}if(!Object.prototype.hasOwnProperty.call(this,"rawFeatureMap_")){var map=this.featureMap_={}
add(this.properties),add(this.actions),add(this.methods),add(this.listeners),add(this.templates),add(this.models),add(this.tests),add(this.relationships),add(this.issues)}return this.featureMap_[featureName.toUpperCase()]},getAllMyRawFeatures:function(){var featureList=[],arrayOrEmpty=function(arr){return arr&&Array.isArray(arr)?arr:[]}
return[arrayOrEmpty(this.properties),arrayOrEmpty(this.actions),arrayOrEmpty(this.methods),arrayOrEmpty(this.listeners),arrayOrEmpty(this.templates),arrayOrEmpty(this.models),arrayOrEmpty(this.tests),arrayOrEmpty(this.relationships),arrayOrEmpty(this.issues)].map(function(list){featureList=featureList.concat(list)}),featureList},getFeature:function(featureName){var feature=this.getMyFeature(featureName)
if(feature||!this.extendsModel)return feature
var ext=this.X.lookup(this.extendsModel)
return ext?ext.getFeature(featureName):void 0},getAllRawFeatures:function(){var featureList=this.getAllMyRawFeatures()
if(this.extendsModel){var ext=this.X.lookup(this.extendsModel)
ext&&ext.getAllFeatures().map(function(subFeat){var subName=subFeat.name.toUpperCase()
featureList.mapFind(function(myFeat){return myFeat&&myFeat.name&&myFeat.name.toUpperCase()===subName})||featureList.push(subFeat)})}return featureList},atest:function(){for(var seq=[],allPassed=!0,i=0;i<this.tests.length;i++)seq.push(function(test,model){return function(ret){test.atest(model)(function(passed){passed||(allPassed=!1),ret()})}}(this.tests[i],this))
return seq.push(function(ret){ret(allPassed)}),aseq.apply(null,seq)}},BinaryProtoGrammar,DocumentationBootstrap={name:"documentation",type:"Documentation",help:"Documentation associated with this entity.",documentation:"The developer documentation for this $$DOC{ref:'.'}. Use a $$DOC{ref:'DocModelView'} to view documentation.",setter:function(nu){_DOC_&&(this.instance_.documentation=nu)},getter:function(){if(!_DOC_)return""
var doc=this.instance_.documentation
return!doc||"undefined"==typeof Documentation||!Documentation||doc.model_&&doc.model_.getPrototype&&Documentation.isInstance(doc)||(doc.body?this.instance_.documentation=Documentation.create(doc):this.instance_.documentation=Documentation.create({body:doc})),this.instance_.documentation}},Model={__proto__:BootstrapModel,instance_:{},name:"Model",plural:"Models",help:"Describes the attributes and properties of an entity.",documentation:{body:function(){}},tableProperties:["package","name","label","plural"],properties:[{name:"id",hidden:!0,"transient":!0},{name:"sourcePath",help:"Source location of this Model.",defaultValue:"",mode:"read-only","transient":!0},{name:"abstract",type:"boolean",defaultValue:!1,help:"If the java class is abstract.",documentation:function(){}},{name:"package",help:"Package that this Model belongs to.",defaultValue:"",postSet:function(_,p){return this.id=p?p+"."+this.name:this.name},documentation:function(){}},{name:"name",type:"String",postSet:function(_,n){return this.id=this["package"]?this["package"]+"."+n:n},required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The coding identifier for the entity.",documentation:function(){}},{name:"label",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return labelize(this.name)},help:"The display label for the entity.",documentation:function(){}},{name:"javaClassName",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return(this["abstract"]?"Abstract":"")+this.name},help:"The Java classname of this Model.",documentation:function(){}},{name:"swiftClassName",type:"String",labels:["swift"],defaultValueFn:function(){return(this["abstract"]?"Abstract":"")+this.name},help:"The Swift classname of this model."},{name:"extendsModel",label:"Extends",type:"String",displayWidth:70,displayHeight:1,defaultValue:"",help:"The parent model of this model.",documentation:function(){}},{name:"traits",type:"Array[String]",view:"foam.ui.StringArrayView",defaultValueFn:function(){return[]},help:"Traits to mix-into this Model.",documentation:function(){}},{name:"plural",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return this.name+"s"},help:"The plural form of this model's name.",documentation:function(){}},{name:"version",type:"int",defaultValue:1,help:"Version number of model.",documentation:function(){}},{name:"ids",label:"Key Properties",type:"Array[String]",view:"foam.ui.StringArrayView",defaultValueFn:function(){var id=this.getProperty("id")
if(id)return["id"]
var props=this.getRuntimeProperties()
return props.length?[props[0].name]:[]},help:"Properties which make up unique id.",documentation:function(){}},{name:"requires",type:"Array[String]",view:"foam.ui.StringArrayView",defaultValueFn:function(){return[]},help:"Model imports.",documentation:function(){}},{name:"imports",type:"Array[String]",view:"foam.ui.StringArrayView",defaultValueFn:function(){return[]},help:"Context imports.",documentation:function(){}},{name:"exports",type:"Array[String]",view:"foam.ui.StringArrayView",defaultValueFn:function(){return[]},help:"Context exports.",documentation:function(){}},{name:"implements",type:"Array[String]",view:"foam.ui.StringArrayView",defaultValueFn:function(){return[]},help:"Interfaces implemented by this Model.",documentation:function(){}},{name:"tableProperties",type:"Array[String]",view:"foam.ui.StringArrayView",displayWidth:70,lazyFactory:function(){return(this.properties||this.properties_).filter(function(o){return!o.hidden}).map(function(o){return o.name})},help:"Properties to be displayed in table view. Defaults to all properties.",documentation:function(){}},{name:"searchProperties",type:"Array[String]",view:"foam.ui.StringArrayView",displayWidth:70,defaultValueFn:function(){return this.tableProperties},help:"Properties display in a search view. Defaults to table properties.",documentation:function(){}},{name:"properties",type:"Array[Property]",subType:"Property",view:"foam.ui.ArrayView",factory:function(){return[]},help:"Properties associated with the entity.",preSet:function(oldValue,newValue){for(var i=0;i<newValue.length;i++){var p=newValue[i]
"string"==typeof p?newValue[i]=p={name:p}:Array.isArray(p)&&(newValue[i]=p={name:p[0],defaultValue:p[1]}),!p.labels||FEATURE_ENABLED(p.labels)?(p.model_?"string"==typeof p.model_&&(p=newValue[i]=JSONUtil.mapToObj(this.X,p)):p=newValue[i]=Property.create(p),this[constantize(p.name)]=newValue[i]):(newValue.splice(i,1),i--)}return this.propertyMap_=null,newValue},postSet:function(_,newValue){for(var i=0;i<newValue.length;i++)newValue[i].modelId=this.id},documentation:function(){}},{name:"actions",type:"Array[Action]",subType:"Action",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&(output[this.name]=o[this.name])},help:"Actions associated with the entity.",preSet:function(_,newValue){if(!Action)return newValue
for(var i=0;i<newValue.length;i++){var p=newValue[i]
p.model_?"string"==typeof p.model_&&(newValue[i]=FOAM(p)):newValue[i]=Action.create(p),p.name&&!this[constantize(p.name)]&&(this[constantize(p.name)]=newValue[i])}return newValue},documentation:function(){}},{name:"constants",type:"Array[Constant]",subType:"Constant",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&(output[this.name]=o[this.name])},help:"Constants associated with the entity.",preSet:function(_,newValue){if(!Constant)return newValue
if(Array.isArray(newValue))return JSONUtil.arrayToObjArray(this.X,newValue,Constant)
var constants=[]
for(var key in newValue){var oldValue=newValue[key],constant=Constant.create({name:key,value:oldValue})
constants.push(constant)}return constants}},{name:"messages",type:"Array[Message]",subType:"Constant",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&(output[this.name]=o[this.name])},help:"Messages associated with the entity.",preSet:function(_,newValue){if(!GLOBAL.Message)return newValue
if(Array.isArray(newValue))return JSONUtil.arrayToObjArray(this.X,newValue,Message)
var messages=[]
for(var key in newValue){var oldValue=newValue[key],message=Message.create({name:key,value:oldValue})
messages.push(message)}return messages}},{name:"methods",subType:"Method",factory:function(){return[]},help:"Methods associated with the entity.",adapt:function(_,a){function createMethod(X,name,fn){var method=Method.create({name:name,code:fn})
if(FEATURE_ENABLED(["debug"])&&Arg){var str=fn.toString(),match=str.match(/^function[ _$\w]*\(([ ,\w]+)/)
match&&(method.args=match[1].split(",").map(function(name){return Arg.create({name:name.trim()})}))}return method}if(!Method)return a
if(Array.isArray(a)){for(var i=0;i<a.length;i++)a[i]="function"==typeof a[i]?createMethod(this.X,a[i].name,a[i]):JSONUtil.mapToObj(this.X,a[i],Method,seq)
return a}var methods=[]
for(var key in a)methods.push(createMethod(this.X,key,a[key]))
return methods},documentation:function(){}},{name:"listeners",type:"Array[Method]",subType:"Method",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&(output[this.name]=o[this.name])},preSet:function(_,newValue){return Array.isArray(newValue)?JSONUtil.arrayToObjArray(this.X,newValue,Method):newValue},help:"Event listeners associated with the entity.",documentation:function(){}},{name:"templates",type:"Array[Template]",subType:"Template",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&(output[this.name]=o[this.name])},preSet:function(_,templates){for(var i=0;i<templates.length;i++)!templates[i].labels||FEATURE_ENABLED(templates[i].labels)||(templates.splice(i,1),i--)
return templates},postSet:function(_,templates){TemplateUtil.expandModelTemplates(this)},help:"Templates associated with this entity.",documentation:function(){}},{name:"models",type:"Array[Model]",subType:"Model",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&(output[this.name]=o[this.name])},adapt:function(_,newValue){return Model&&Array.isArray(newValue)?JSONUtil.arrayToObjArray(this.X,newValue,Model):newValue},postSet:function(_,models){for(var i=0;i<models.length;i++)this[models[i].name]=models[i]},help:"Sub-models embedded within this model.",documentation:function(){}},{name:"tests",label:"Unit Tests",type:"Array[Unit Test]",subType:"UnitTest",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&(output[this.name]=o[this.name])},adapt:function(_,a){if(!a)return a
for(var i=0;i<a.length;i++)"function"==typeof a[i]&&(a[i]=UnitTest.create({name:a[i].name,code:a[i]}))
return a},help:"Unit tests associated with this model.",documentation:function(){}},{name:"relationships",subType:"Relationship",view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&(output[this.name]=o[this.name])},help:"Relationships of this model to other models.",preSet:function(_,newValue){if(!Relationship)return newValue
for(var i=0;i<newValue.length;i++){var p=newValue[i]
p.model_?"string"==typeof p.model_&&(p=newValue[i]=FOAM(p)):p=newValue[i]=Relationship.create(p),this[constantize(p.name)]=newValue[i]}return newValue},documentation:function(){}},{name:"issues",type:"Array[Issue]",subType:"Issue",labels:["debug"],view:"foam.ui.ArrayView",factory:function(){return[]},propertyToJSON:function(visitor,output,o){o[this.name].length&&(output[this.name]=o[this.name])},help:"Issues associated with this model.",documentation:function(){}},{name:"help",label:"Help Text",type:"String",displayWidth:70,displayHeight:6,view:"foam.ui.TextAreaView",defaultValue:"",help:"Help text associated with the entity.",documentation:function(){}},{name:"i18nComplete_",defaultValue:!1,hidden:!0,"transient":!0},{name:"translationHint",label:"Description for Translation",type:"String",defaultValueFn:function(){return this.name}},DocumentationBootstrap,{name:"notes",type:"String",displayWidth:70,displayHeight:6,view:"foam.ui.TextAreaView",defaultValue:"",help:"Internal documentation associated with this entity.",documentation:function(){}}],templates:[],toString:function(){return"Model"}}
GLOBAL.Property={__proto__:BootstrapModel,instance_:{},name:"Property",plural:"Properties",help:"Describes a properties of a modelled entity.",ids:["name"],tableProperties:["name","label","type","required","defaultValue"],documentation:function(){},properties:[{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",mode:"read-only",help:"The coding identifier for the property.",documentation:function(){}},{name:"labels",type:"Array",subType:"String",labels:["debug"]},{name:"label",type:"String",required:!1,displayWidth:70,displayHeight:1,defaultValueFn:function(){return labelize(this.name)},help:"The display label for the property.",documentation:function(){}},{name:"speechLabel",type:"String",required:!1,displayWidth:70,displayHeight:1,defaultValueFn:function(){return this.label},help:"The speech label for the property.",documentation:function(){}},{name:"tableLabel",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return this.label},help:"The table display label for the entity.",documentation:function(){}},{name:"type",type:"String",required:!0,view:{factory_:"foam.ui.ChoiceView",choices:["Array","Boolean","Color","Date","DateTime","Email","Enum","Float","Function","Image","Int","Object","Password","String","String[]","URL"]},defaultValue:"String",help:"The type of the property.",documentation:function(){}},{name:"swiftDefaultValue",labels:["swift"],defaultValueFn:function(){switch(typeof this.defaultValue){case"string":return'"'+this.defaultValue+'"'
default:return this.defaultValue}}},{name:"protobufType",type:"String",required:!1,help:"The protobuf type that represents the type of this property.",defaultValueFn:function(){return this.type.toLowerCase()},documentation:function(){}},{name:"javaType",type:"String",required:!1,defaultValueFn:function(){return this.type},help:"The java type that represents the type of this property.",documentation:function(){}},{name:"javascriptType",type:"String",required:!1,defaultValueFn:function(){return this.type},help:"The javascript type that represents the type of this property.",documentation:function(){}},{name:"swiftType",type:"String",required:!1,labels:["swift"],defaultValueFn:function(){return this.type},help:"The Swift type that represents this type of property."},{name:"shortName",type:"String",required:!0,displayWidth:10,displayHeight:1,defaultValue:"",help:"A short alternate name to be used for compact encoding.",documentation:"A short alternate $$DOC{ref:'.name'} to be used for compact encoding."},{name:"singular",type:"String",required:!1,displayWidth:70},{name:"aliases",type:"Array[String]",view:"foam.ui.StringArrayView",factory:function(){return[]},help:"Alternate names for this property.",documentation:function(){}},{name:"mode",type:"String",defaultValue:"read-write",view:{factory_:"foam.ui.ChoiceView",choices:["read-only","read-write","final"]},documentation:function(){}},{name:"subType",label:"Sub-Type",type:"String",displayWidth:30,help:"The type of the property.",documentation:function(){}},{name:"subKey",type:"EXPR",displayWidth:20,defaultValue:"ID",help:"The foreign key that this property references.",documentation:function(){}},{name:"units",type:"String",required:!0,displayWidth:70,displayHeight:1,defaultValue:"",help:"The units of the property.",documentation:function(){}},{name:"required",type:"Boolean",view:"foam.ui.BooleanView",defaultValue:!0,help:"Indicates if the property is a required field.",documentation:function(){}},{name:"hidden",type:"Boolean",view:"foam.ui.BooleanView",defaultValue:!1,help:"Indicates if the property is hidden.",documentation:function(){}},{name:"transient",type:"Boolean",view:"foam.ui.BooleanView",defaultValue:!1,help:"Indicates if the property is transient.",documentation:function(){}},{name:"modelId",type:"String",view:"foam.ui.TextFieldView",help:"Id of the model that this is a property of","transient":!0},{name:"displayWidth",type:"int",displayWidth:8,displayHeight:1,defaultValue:"30",help:"The display width of the property.",documentation:function(){}},{name:"displayHeight",type:"int",displayWidth:8,displayHeight:1,defaultValue:1,help:"The display height of the property.",documentation:function(){}},{name:"view",type:"view",defaultValue:"foam.ui.TextFieldView",help:"View component for the property.",documentation:function(){}},{name:"detailView",type:"view",defaultValueFn:function(){return this.view},help:"View component for the property when rendering within a DetailView.",documentation:function(){}},{name:"citationView",type:"view",defaultValueFn:function(){return this.view},help:"View component for the property when rendering within a CitationView.",documentation:function(){}},{name:"swiftView",type:"String",labels:["swift"],defaultValueFn:function(){return this.view.substring(this.view.lastIndexOf(".")+1)},help:"The default view name for this property in swift."},{name:"detailViewPreRow",defaultValue:function(){return""},help:"Inject HTML before row in DetailView.",documentation:function(){}},{name:"detailViewPostRow",defaultValue:function(){return""},help:"Inject HTML before row in DetailView.",documentation:function(){}},{name:"defaultValue",type:"String",required:!1,displayWidth:70,displayHeight:1,defaultValue:"",postSet:function(old,nu){nu&&this.defaultValueFn&&(this.defaultValueFn=void 0)},help:"The property's default value.",documentation:function(){}},{name:"defaultValueFn",label:"Default Value Function",type:"Function",required:!1,displayWidth:70,displayHeight:3,rows:3,view:"foam.ui.FunctionView",defaultValue:"",postSet:function(old,nu){nu&&this.defaultValue&&(this.defaultValue=void 0)},help:"The property's default value function.",documentation:function(){}},{name:"dynamicValue",label:"Value's Dynamic Function",type:"Function",required:!1,displayWidth:70,displayHeight:3,rows:3,view:"foam.ui.FunctionView",defaultValue:"",help:"A dynamic function which computes the property's value.",documentation:function(){}},{name:"factory",type:"Function",required:!1,displayWidth:70,displayHeight:3,rows:3,view:"foam.ui.FunctionView",defaultValue:"",help:"Factory for creating initial value when new object instantiated.",documentation:function(){}},{name:"lazyFactory",type:"Function",required:!1,view:"foam.ui.FunctionView",help:"Factory for creating the initial value. Only called when the property is accessed for the first time.",documentation:function(){}},{name:"validate",type:"Function",required:!1,view:"foam.ui.FunctionView",help:"Function for validating property value.",preSet:function(_,f){var str=f.toString(),deps=str.match(/^function[ _$\w]*\(([ ,\w]*)/)[1].split(",").map(function(name){return name.trim()}),f2=function(){for(var args=[],i=0;i<deps.length;i++)args.push(this[deps[i]])
return f.apply(this,args)}
return f2.dependencies=deps,f2.toString=function(){return f.toString()},f2},documentation:function(){}},{name:"getter",type:"Function",required:!1,displayWidth:70,displayHeight:3,view:"foam.ui.FunctionView",defaultValue:"",help:"The property's default value function.",documentation:function(){}},{name:"adapt",type:"Function",required:!1,displayWidth:70,displayHeight:3,view:"foam.ui.FunctionView",defaultValue:"",help:"An adapter function called before preSet.",documentation:function(){}},{name:"preSet",type:"Function",required:!1,displayWidth:70,displayHeight:3,view:"foam.ui.FunctionView",defaultValue:"",help:"An adapter function called before normal setter logic.",documentation:function(){}},{name:"postSet",type:"Function",required:!1,displayWidth:70,displayHeight:3,view:"foam.ui.FunctionView",defaultValue:"",help:"A function called after normal setter logic, but before property change event fired.",documentation:function(){}},{name:"setter",type:"Function",required:!1,displayWidth:70,displayHeight:3,view:"foam.ui.FunctionView",defaultValue:"",help:"The property's default value function.",documentation:function(){}},{name:"tableFormatter",label:"Table Cell Formatter",type:"Function",required:!1,displayWidth:70,displayHeight:3,rows:3,view:"foam.ui.FunctionView",defaultValue:"",help:"Function to format value for display in TableView.",documentation:"A function to format the value for display in a $$DOC{ref:'foam.ui.TableView'}."},{name:"summaryFormatter",label:"Summary Formatter",type:"Function",required:!1,displayWidth:70,displayHeight:3,rows:3,view:"foam.ui.FunctionView",defaultValue:"",help:"Function to format value for display in SummaryView.",documentation:"A function to format the value for display in a $$DOC{ref:'SummaryView'}."},{name:"tableWidth",type:"String",required:!1,defaultValue:"",help:"Table View Column Width.",documentation:"A Suggestion for $$DOC{ref:'foam.ui.TableView'} column width."},{name:"help",label:"Help Text",type:"String",required:!1,displayWidth:70,displayHeight:6,view:"foam.ui.TextAreaView",defaultValue:"",help:"Help text associated with the property.",documentation:function(){}},DocumentationBootstrap,{name:"prototag",label:"Protobuf tag",type:"Int",required:!1,help:"The protobuf tag number for this field.",documentation:"The protobuf tag number for this field."},{name:"actionFactory",type:"Function",required:!1,displayWidth:70,displayHeight:3,rows:3,view:"foam.ui.FunctionView",defaultValue:"",help:"Factory to create the action objects for taking this property from value A to value B",documentation:"Factory to create the $$DOC{ref:'Action'} objects for taking this $$DOC{ref:'Property'} from value A to value B"},{name:"compareProperty",type:"Function",view:"foam.ui.FunctionView",displayWidth:70,displayHeight:5,defaultValue:function(o1,o2){return o1===o2?0:o1||o2?o1?o2?o1.localeCompare?o1.localeCompare(o2):o1.compareTo?o1.compareTo(o2):o1.$UID.compareTo(o2.$UID):1:-1:0},help:"Comparator function.",documentation:"A comparator function two compare two instances of this $$DOC{ref:'Property'}."},{name:"fromString",defaultValue:function(s,p){this[p.name]=s},help:"Function to extract value from a String."},{name:"fromElement",defaultValue:function propertyFromElement(e,p){if(!p.type||!this.X.lookup||"String"===p.type)return void p.fromString.call(this,e.innerHTML,p)
var model=this.X.lookup(p.type)
if(!model)return void p.fromString.call(this,e.innerHTML,p)
var o=model.create()
return o.fromElement?void(this[p.name]=o.fromElement(e)):void p.fromString.call(this,e.innerHTML,p)},help:"Function to extract from a DOM Element.",documentation:"Function to extract a value from a DOM Element."},{name:"propertyToJSON",defaultValue:function(visitor,output,o){this["transient"]||(output[this.name]=visitor.visit(o[this.name]))},help:"Function to extract from a DOM Element.",documentation:"Function to extract a value from a DOM Element."},{name:"autocompleter",subType:"Autocompleter",help:"Name or model for the autocompleter for this property.",documentation:function(){}},{name:"install",type:"Function",required:!1,displayWidth:70,displayHeight:3,rows:3,view:"foam.ui.FunctionView",defaultValue:"",help:"A function which installs additional features into the Model's prototype.",documentation:function(){}},{name:"exclusive",type:"Boolean",view:"foam.ui.BooleanView",defaultValue:!0,help:"Indicates if the property can only have a single value.",documentation:function(){}},{name:"memorable",type:"Boolean",help:"True if this value should be included in a memento for this object.",defaultValue:!1}],methods:[function partialEval(){return this},function f(obj){return obj[this.name]},function compare(o1,o2){return this.compareProperty(this.f(o1),this.f(o2))},function readResolve(){return this.modelId?this.X.lookup(this.modelId)[constantize(this.name)]:this},function toSQL(){return this.name},function toMQL(){return this.name},function toBQL(){return this.name},function cloneProperty(value){return value&&value.clone?value.clone():value},function deepCloneProperty(value){return value&&value.deepClone?value.deepClone():value},function initPropertyAgents(proto,fastInit){var prop=this,name=prop.name,name$_=prop.name$_
if(fastInit||proto.addInitAgent(this.postSet||this.setter?9:0,name+": "+(this.postSet||this.setter?"copy arg (postSet)":"copy arg"),function(o,X,m){m&&(m.hasOwnProperty(name)&&(o[name]=m[name]),m.hasOwnProperty(name$_)&&(o[name$_]=m[name$_]))}),this.dynamicValue){var dynamicValue=prop.dynamicValue
Array.isArray(dynamicValue)?proto.addInitAgent(10,name+": dynamicValue",function(o,X){Events.dynamic(dynamicValue[0].bind(o),function(){o[name]=dynamicValue[1].call(o)},X||this.X)}):proto.addInitAgent(10,name+": dynamicValue",function(o,X){Events.dynamic(dynamicValue.bind(o),function(value){o[name]=value},X||this.X)})}this.factory&&proto.addInitAgent(11,name+": factory",function(o,X){o.hasOwnProperty(name)||o[name]})}],toString:function(){return"Property"}},Model.methods={getProperty:BootstrapModel.getProperty,getAction:BootstrapModel.getAction,hashCode:BootstrapModel.hashCode,buildPrototype:BootstrapModel.buildPrototype,addTraitToModel_:BootstrapModel.addTraitToModel_,buildProtoImports_:BootstrapModel.buildProtoImports_,buildProtoProperties_:BootstrapModel.buildProtoProperties_,buildProtoMethods_:BootstrapModel.buildProtoMethods_,getPrototype:BootstrapModel.getPrototype,isSubModel:BootstrapModel.isSubModel,isInstance:BootstrapModel.isInstance,getAllRequires:BootstrapModel.getAllRequires,arequire:BootstrapModel.arequire,getMyFeature:BootstrapModel.getMyFeature,getRawFeature:BootstrapModel.getRawFeature,getAllMyRawFeatures:BootstrapModel.getAllMyRawFeatures,getFeature:BootstrapModel.getFeature,getAllRawFeatures:BootstrapModel.getAllRawFeatures,atest:BootstrapModel.atest,getRuntimeProperties:BootstrapModel.getRuntimeProperties,getRuntimeActions:BootstrapModel.getRuntimeActions,create:BootstrapModel.create},Model=Model.create(Model),Model.model_=Model,Model.create=BootstrapModel.create,Property=Model.create(Property)
for(var ps=Property.getRuntimeProperties(),i=0;i<ps.length;i++)Property[constantize(ps[i].name)]=ps[i]=Property.create(ps[i])
if(USED_MODELS.Property=!0,USED_MODELS.Model=!0,CLASS({name:"StringProperty",extendsModel:"Property",help:"Describes a properties of type String.",label:"Text, including letters, numbers, or symbols",properties:[{name:"displayHeight",type:"int",displayWidth:8,defaultValue:1,help:"The display height of the property."},{name:"type",type:"String",displayWidth:20,defaultValue:"String",help:"The FOAM type of this property."},{name:"adapt",defaultValue:function(_,v){return void 0===v||null===v?"":"function"==typeof v?multiline(v):v.toString()}},{name:"javaType",type:"String",displayWidth:70,defaultValue:"String",help:"The Java type of this property."},["view","foam.ui.TextFieldView"],{name:"pattern",help:"Regex pattern for property."},{name:"prototag",label:"Protobuf tag",type:"Int",required:!1,help:"The protobuf tag number for this field."}]}),CLASS({name:"BooleanProperty",extendsModel:"Property",help:"Describes a properties of type Boolean.",label:"True/false, yes/no, or on/off",properties:[{name:"type",type:"String",displayWidth:20,defaultValue:"Boolean",help:"The FOAM type of this property."},{name:"swiftType",type:"String",displayWidth:70,defaultValue:"Bool"},{name:"javaType",type:"String",displayWidth:70,defaultValue:"boolean",help:"The Java type of this property."},["view","foam.ui.BooleanView"],["defaultValue",!1],["adapt",function(_,v){return!!v}],{name:"prototag",label:"Protobuf tag",type:"Int",required:!1,help:"The protobuf tag number for this field."},{name:"fromString",defaultValue:function(s,p){var txt=s.trim()
this[p.name]=txt.equalsIC("y")||txt.equalsIC("yes")||txt.equalsIC("true")||txt.equalsIC("t")},help:"Function to extract value from a String."}]}),CLASS({name:"DateProperty",extendsModel:"Property",help:"Describes a properties of type Date.",label:"Date, including year, month, and day",properties:[{name:"type",type:"String",displayWidth:20,defaultValue:"Date",help:"The FOAM type of this property."},["displayWidth",50],{name:"javaType",type:"String",defaultValue:"java.util.Date",help:"The Java type of this property."},["view","foam.ui.DateFieldView"],{name:"prototag",label:"Protobuf tag",type:"Int",required:!1,help:"The protobuf tag number for this field."},{name:"adapt",defaultValue:function(_,d){return"string"==typeof d||"number"==typeof d?new Date(d):d}},["tableFormatter",function(d){return d?d.toRelativeDateString():""}],["compareProperty",function(o1,o2){return o1?o2?o1.compareTo(o2):1:o2?-1:0}]]}),CLASS({name:"DateTimeProperty",extendsModel:"DateProperty",help:"Describes a properties of type DateTime.",label:"Date and time, including year, month, day, hour, minute and second",properties:[{name:"type",type:"String",displayWidth:25,defaultValue:"datetime",help:"The FOAM type of this property."},{name:"adapt",defaultValue:function(_,d){return"number"==typeof d?new Date(d):"string"==typeof d?new Date(d):d}},["view","foam.ui.DateTimeFieldView"]]}),CLASS({name:"IntProperty",extendsModel:"Property",help:"Describes a properties of type Int.",label:"Round numbers such as 1, 0, or -245",properties:[{name:"type",type:"String",displayWidth:20,defaultValue:"Int",help:"The FOAM type of this property."},["displayWidth",10],{name:"javaType",type:"String",displayWidth:10,defaultValue:"int",help:"The Java type of this property."},["view","foam.ui.IntFieldView"],["adapt",function(_,v){return"number"==typeof v?Math.round(v):v?parseInt(v):0}],["defaultValue",0],{name:"prototag",label:"Protobuf tag",type:"Int",required:!1,help:"The protobuf tag number for this field."},{name:"minValue",label:"Minimum Value",type:"Int",required:!1,help:"The minimum value this property accepts."},{name:"maxValue",label:"Maximum Value",type:"Int",required:!1,help:"The maximum value this property accepts."},["compareProperty",function(o1,o2){return o1===o2?0:o1>o2?1:-1}]]}),CLASS({name:"LongProperty",extendsModel:"IntProperty",help:"Describes a properties of type Long.",label:"Round long numbers such as 1, 0, or -245",properties:[{name:"type",defaultValue:"Long"},{name:"displayWidth",defaultValue:12},{name:"javaType",defaultValue:"long"}]}),CLASS({name:"FloatProperty",extendsModel:"Property",help:"Describes a properties of type Float.",label:"Decimal numbers such as 1.34 or -0.00345",properties:[{name:"type",type:"String",displayWidth:20,defaultValue:"Float",help:"The FOAM type of this property."},{name:"defaultValue",defaultValue:0},{name:"javaType",type:"String",displayWidth:10,defaultValue:"double",help:"The Java type of this property."},{name:"displayWidth",defaultValue:15},{name:"view",defaultValue:"foam.ui.FloatFieldView"},{name:"adapt",defaultValue:function(_,v){return"number"==typeof v?v:v?parseFloat(v):0}},{name:"minValue",label:"Minimum Value",type:"Float",required:!1,help:"The minimum value this property accepts."},{name:"maxValue",label:"Maximum Value",type:"Float",required:!1,help:"The maximum value this property accepts."},{name:"prototag",label:"Protobuf tag",type:"Int",required:!1,help:"The protobuf tag number for this field."}]}),CLASS({name:"FunctionProperty",extendsModel:"Property",help:"Describes a properties of type Function.",label:"Code that can be run",properties:[{name:"type",type:"String",displayWidth:20,defaultValue:"Function",help:"The FOAM type of this property."},{name:"javaType",type:"String",displayWidth:10,defaultValue:"Function",help:"The Java type of this property."},{name:"displayWidth",defaultValue:15},{name:"view",defaultValue:"foam.ui.FunctionView"},{name:"defaultValue",defaultValue:function(){}},{name:"fromElement",defaultValue:function(e,p){var txt=e.innerHTML.trim()
this[p.name]=txt.startsWith("function")?eval("("+txt+")"):new Function(txt)}},{name:"adapt",defaultValue:function(_,value){return"string"==typeof value?value.startsWith("function")?eval("("+value+")"):new Function(value):value}}]}),CLASS({name:"TemplateProperty",extendsModel:"FunctionProperty",properties:[{name:"adapt",defaultValue:function(_,value){return TemplateUtil.expandTemplate(this,value)}},{name:"defaultValue",adapt:function(_,value){return TemplateProperty.ADAPT.defaultValue.call(this,_,value)}},{name:"install",defaultValue:function(prop){defineLazyProperty(this,prop.name+"$f",function(){var f=TemplateUtil.lazyCompile(this[prop.name])
return{get:function(){return f},configurable:!0}})}}]}),CLASS({name:"ArrayProperty",extendsModel:"Property",help:"Describes a property of type Array.",label:"List of items",properties:[{name:"type",type:"String",displayWidth:20,defaultValue:"Array",help:"The FOAM type of this property."},{name:"swiftType",defaultValue:"[AnyObject]"},{name:"swiftDefaultValue",defaultValue:"[]"},{name:"singular",type:"String",displayWidth:70,defaultValueFn:function(){return this.name.replace(/s$/,"")},help:"The plural form of this model's name.",documentation:function(){}},{name:"subType",type:"String",displayWidth:20,defaultValue:"",help:"The FOAM sub-type of this property."},{name:"protobufType",defaultValueFn:function(){return this.subType}},{name:"adapt",defaultValue:function(_,a,prop){var m=prop.subType_||(prop.subType_=this.X.lookup(prop.subType)||GLOBAL.lookup(prop.subType))
if(m)for(var i=0;i<a.length;i++)m.isInstance(a[i])||(a[i]=a[i].model_?FOAM(a[i]):m.create(a[i]))
return a}},{name:"postSet",defaultValue:function(oldA,a,prop){var name=prop.nameArrayRelay_||(prop.nameArrayRelay_=prop.name+"ArrayRelay_"),l=this[name]||(this[name]=function(){this.propertyChange(prop.name,null,this[prop.name])}.bind(this))
oldA&&oldA.unlisten&&oldA.unlisten(l),a&&a.listen&&a.listen(l)}},{name:"javaType",type:"String",displayWidth:10,defaultValueFn:function(p){return this.subType+"[]"},help:"The Java type of this property."},{name:"view",defaultValue:"foam.ui.ArrayView"},{name:"factory",defaultValue:function(){return[]}},{name:"propertyToJSON",defaultValue:function(visitor,output,o){!this["transient"]&&o[this.name].length&&(output[this.name]=visitor.visitArray(o[this.name]))}},{name:"install",defaultValue:function(prop){defineLazyProperty(this,prop.name+"$Proxy",function(){var proxy=this.X.lookup("foam.dao.ProxyDAO").create({delegate:this[prop.name].dao})
return this.addPropertyListener(prop.name,function(_,_,_,a){proxy.delegate=a.dao}),{get:function(){return proxy},configurable:!0}}),this.addMethod("get"+capitalize(prop.singular),function(id){for(var i=0;i<this[prop.name].length;i++)if(this[prop.name][i].id===id)return this[prop.name][i]})}},{name:"fromElement",defaultValue:function(e,p){for(var model=this.X.lookup(e.getAttribute("model")||p.subType),children=e.children,a=[],i=0;i<children.length;i++){var o=model.create(null,this.Y)
o.fromElement(children[i],p),a.push(o)}this[p.name]=a}},{name:"prototag",label:"Protobuf tag",type:"Int",required:!1,help:"The protobuf tag number for this field."}]}),CLASS({name:"ReferenceProperty",extendsModel:"Property",help:"A foreign key reference to another Entity.",label:"Reference to another object",properties:[{name:"type",type:"String",displayWidth:20,defaultValue:"Reference",help:"The FOAM type of this property."},{name:"subType",type:"String",displayWidth:20,defaultValue:"",help:"The FOAM sub-type of this property."},{name:"subKey",type:"EXPR",displayWidth:20,defaultValue:"ID",help:"The foreign key that this property references."},{name:"javaType",type:"String",displayWidth:10,defaultValueFn:function(){return this.X.lookup(this.subType)[this.subKey].javaType},help:"The Java type of this property."},{name:"view",defaultValue:"foam.ui.TextFieldView"},{name:"prototag",label:"Protobuf tag",type:"Int",required:!1,help:"The protobuf tag number for this field."}]}),CLASS({name:"StringArrayProperty",extendsModel:"Property",help:"An array of String values.",label:"List of text strings",properties:[{name:"type",type:"String",displayWidth:20,defaultValue:"Array",help:"The FOAM type of this property."},{name:"swiftType",defaultValue:"[String]"},{name:"swiftDefaultValue",defaultValue:"[]"},{name:"singular",type:"String",displayWidth:70,defaultValueFn:function(){return this.name.replace(/s$/,"")},help:"The plural form of this model's name.",documentation:function(){}},{name:"subType",type:"String",displayWidth:20,defaultValue:"String",help:"The FOAM sub-type of this property."},{name:"displayWidth",defaultValue:50},{name:"adapt",defaultValue:function(_,v){return Array.isArray(v)?v:v||0===v?[v]:[]}},{name:"factory",defaultValue:function(){return[]}},{name:"javaType",type:"String",displayWidth:10,defaultValue:"String[]",help:"The Java type of this property."},{name:"view",defaultValue:"foam.ui.StringArrayView"},{name:"prototag",label:"Protobuf tag",type:"Int",required:!1,help:"The protobuf tag number for this field."},{name:"exclusive",defaultValue:!1},{name:"fromString",defaultValue:function(s,p){this[p.name]=s.split(",")}},{name:"fromElement",defaultValue:function(e,p){for(var val=[],name=p.singular||"item",i=0;i<e.children.length;i++)e.children[i].nodeName===name&&val.push(e.children[i].innerHTML)
this[p.name]=val}},{name:"toMemento",defaultValue:function(o,p){return o.join(",")}},{name:"fromMemento",defaultValue:function(s,p){return s?s.split(","):void 0}}]}),CLASS({name:"ModelProperty",extendsModel:"Property",help:"Describes a Model property.",label:"Data Model definition",properties:[["type","Model"],{name:"getter",defaultValue:function(name){var value=this.instance_[name]
if("undefined"==typeof value){var prop=this.model_.getProperty(name)
value=prop?prop.lazyFactory?this.instance_[prop.name]=prop.lazyFactory.call(this,prop):prop.factory?this.instance_[prop.name]=prop.factory.call(this,prop):prop.defaultValueFn?prop.defaultValueFn.call(this,prop):void 0!==typeof prop.defaultValue?prop.defaultValue:"":""}if("string"==typeof value){if(!value)return""
var ret=this.X.lookup(value)
return ret}return Model.isInstance(value)?value:""}},{name:"propertyToJSON",defaultValue:function(visitor,output,o){this["transient"]||(output[this.name]=o[this.name].id)}}]}),CLASS({name:"ViewProperty",extendsModel:"Property",help:"Describes a View-Factory property.",properties:[{name:"adapt",doc:"Can be specified as either a function, a Model, a Model path, or a JSON object.",defaultValue:function(_,f){return"function"==typeof f?f:"string"==typeof f?function(d,opt_X){return(opt_X||this.X).lookup(f).create(d,opt_X||this.Y)}.bind(this):"function"==typeof f.create?f.create.bind(f):"string"==typeof f.model_?function(d,opt_X){return FOAM(f,opt_X||this.Y).copyFrom(d)}:(console.error("******* Unknown view factory: ",f),f)}},{name:"defaultValue",adapt:function(_,f){return ViewProperty.ADAPT.defaultValue.call(this,null,f)}}]}),CLASS({name:"FactoryProperty",extendsModel:"Property",help:"Describes a Factory property.",properties:[{name:"preSet",doc:"Can be specified as either a function, a Model, a Model path, or a JSON object.",defaultValue:function(_,f){return f?"function"==typeof f?f:"string"==typeof f?function(map,opt_X){return(opt_X||this.X).lookup(f).create(map,opt_X||this.Y)}.bind(this):Model.isInstance(f)?f.create.bind(f):f.factory_?function(map,opt_X){var X=opt_X||this.X,m=X.lookup(f.factory_)
return console.assert(m,"Unknown Factory Model: "+f.factory_),m.create(f,opt_X||this.Y)}.bind(this):(console.error("******* Invalid Factory: ",f),f):f}}]}),CLASS({name:"ViewFactoryProperty",extendsModel:"FactoryProperty",help:"Describes a View Factory property.",properties:[{name:"defaultValue",preSet:function(_,f){return ViewFactoryProperty.ADAPT.defaultValue.call(this,null,f)}},{name:"defaultValueFn",preSet:function(_,f){return function(prop){return ViewFactoryProperty.ADAPT.defaultValue.call(this,null,f.call(this,prop))}}},{name:"fromElement",defaultValue:function(e,p){this[p.name]=e.innerHTML_||(e.innerHTML_=e.innerHTML)}},{name:"adapt",doc:"Can be specified as either a function, String markup, a Model, a Model path, or a JSON object.",defaultValue:function(_,f){if(!f)return f
if("function"==typeof f)return f
var ret
if("string"==typeof f){if(/[^0-9a-zA-Z$_.]/.exec(f)){var VIEW_CACHE=ViewFactoryProperty.VIEW_CACHE||(ViewFactoryProperty.VIEW_CACHE={}),viewModel=VIEW_CACHE[f]
viewModel||(viewModel=VIEW_CACHE[f]=Model.create({name:"InnerDetailView"+this.$UID,extendsModel:"foam.ui.DetailView",templates:[{name:"toHTML",template:f}]}),viewModel.arequire()),ret=function(args,X){return viewModel.create(args,X||this.Y)}}else ret=function(map,opt_X){var model=(opt_X||this.X).lookup(f)
return console.assert(!!model,"Unknown model: "+f+" in "+this.name+" property"),model.create(map,opt_X||this.Y)}.bind(this)
return ret.toString=function(){return'"'+f+'"'},ret}return Model.isInstance(f)?function(args,opt_X){return f.create(args,opt_X||this.Y)}.bind(this):f.factory_?(ret=function(map,opt_X){var m=(opt_X||this.X).lookup(f.factory_)
return console.assert(m,"Unknown ViewFactory Model: "+f.factory_),m.create(f,opt_X||this.Y).copyFrom(map)},ret.toString=function(){return JSONUtil.compact.stringify(f)},ret):this.X.lookup("foam.ui.BaseView").isInstance(f)?constantFn(f):(console.error("******* Invalid Factory: ",f),f)}}]}),CLASS({name:"ReferenceArrayProperty",extendsModel:"ReferenceProperty",properties:[{name:"type",defaultValue:"Array",displayWidth:20,help:"The FOAM type of this property."},{name:"factory",defaultValue:function(){return[]}},{name:"javaType",defaultValueFn:function(){return this.X.lookup(this.subType).ID.javaType+"[]"}},{name:"view",defaultValue:"foam.ui.StringArrayView"}]}),CLASS({name:"EMailProperty",extendsModel:"StringProperty",label:"Email address"}),CLASS({name:"ImageProperty",extendsModel:"StringProperty",label:"Image data or link"}),CLASS({name:"URLProperty",extendsModel:"StringProperty",label:"Web link (URL or internet address)"}),CLASS({name:"ColorProperty",extendsModel:"StringProperty",label:"Color"}),CLASS({name:"PasswordProperty",extendsModel:"StringProperty",label:"Password that displays protected or hidden text"}),CLASS({name:"PhoneNumberProperty",extendsModel:"StringProperty",label:"Phone number"}),DEBUG&&CLASS({name:"DocumentationProperty",extendsModel:"Property",help:"Describes the documentation properties found on Models, Properties, Actions, Methods, etc.",documentation:"The developer documentation for this $$DOC{ref:'.'}. Use a $$DOC{ref:'DocModelView'} to view documentation.",properties:[{name:"type",type:"String",defaultvalue:"Documentation"},{name:"getter",type:"Function",labels:["debug"],defaultValue:function(name){var doc=this.instance_[name]
return!doc||"undefined"==typeof Documentation||!Documentation||doc.model_&&doc.model_.getPrototype&&Documentation.isInstance(doc)||(doc.body?this.instance_[name]=Documentation.create(doc):this.instance_[name]=Documentation.create({body:doc})),this.instance_[name]}},{name:"view",defaultValue:"foam.ui.DetailView",labels:["debug"]},{name:"help",defaultValue:"Documentation for this entity.",labels:["debug"]},{name:"documentation",factory:function(){return"The developer documentation for this $$DOC{ref:'.'}. Use a $$DOC{ref:'DocModelView'} to view documentation."},labels:["debug"]}]}),CLASS({name:"Action",plural:"Actions",tableProperties:["name","label"],documentation:function(){},properties:[{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The coding identifier for the action.",documentation:function(){}},{name:"label",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return labelize(this.name)},help:"The display label for the action.",documentation:function(){}},{name:"speechLabel",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return this.label},help:"The speech label for the action.",documentation:"A speakable label for the $$DOC{ref:'.'}. Used for accessibility."},{name:"help",label:"Help Text",type:"String",displayWidth:70,displayHeight:6,defaultValue:"",help:"Help text associated with the action.",documentation:function(){}},{model_:"DocumentationProperty",name:"documentation",documentation:"The developer documentation.",labels:["documentation"]},{name:"default",type:"Boolean",view:"foam.ui.BooleanView",defaultValue:!1,help:"Indicates if this is the default action.",documentation:function(){}},{model_:"FunctionProperty",name:"isAvailable",label:"Available",displayWidth:70,displayHeight:3,defaultValue:function(){return!0},help:"Function to determine if action is available.",documentation:function(){}},{model_:"FunctionProperty",name:"isEnabled",label:"Enabled",displayWidth:70,displayHeight:3,defaultValue:function(){return!0},help:"Function to determine if action is enabled.",documentation:function(){}},{model_:"FunctionProperty",name:"labelFn",label:"Label Function",defaultValue:function(action){return action.label},help:"Function to determine label. Defaults to 'this.label'.",documentation:function(){}},{name:"iconUrl",type:"String",defaultValue:void 0,help:"Provides a url for an icon to render for this action",documentation:function(){}},{name:"ligature",type:"String",defaultValue:void 0,help:"Provides a ligature for font-based icons for this action",documentation:function(){}},{name:"showLabel",type:"String",defaultValue:!0,help:"Property indicating whether the label should be rendered alongside the icon",documentation:function(){}},{name:"children",type:"Array",factory:function(){return[]},subType:"Action",view:"foam.ui.ArrayView",help:"Child actions of this action.",persistent:!1,documentation:function(){}},{name:"parent",type:"String",help:"The parent action of this action",documentation:function(){}},{model_:"FunctionProperty",name:"code",displayWidth:80,displayHeight:20,defaultValue:"",help:"Function to implement action.",documentation:function(){}},{model_:"FunctionProperty",name:"action",displayWidth:80,displayHeight:20,defaultValue:"",getter:function(){return console.log("deprecated use of Action.action"),this.code},setter:function(code){return console.log("deprecated use of Action.action"),this.code=code}},{model_:"StringArrayProperty",name:"keyboardShortcuts",documentation:function(){}},{name:"translationHint",label:"Description for Translation",type:"String",defaultValue:""},{name:"priority",type:"Int",defaultValue:5,help:"Measure of importance of showing this action to the user when it is rendered in a list.",documentation:function(){}},{name:"order",type:"Float",defaultValue:5,help:"Indication of where this action should appear in an ordered list of actions.",documentation:function(){}}],methods:{maybeCall:function(X,that){return this.isAvailable.call(that,this)&&this.isEnabled.call(that,this)?(this.code.call(that,X,this),that.publish(["action",this.name],this),!0):!1}}}),CLASS({name:"Arg",tableProperties:["type","name","description"],documentation:function(){},properties:[{name:"type",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"Object",labels:["debug"],help:"The type of this argument.",documentation:function(){}},{name:"javaType",type:"String",required:!1,defaultValueFn:function(){return this.type},help:"The java type that represents the type of this property.",labels:["debug"],documentation:function(){}},{name:"javascriptType",type:"String",required:!1,defaultValueFn:function(){return this.type},help:"The javascript type that represents the type of this property.",labels:["debug"],documentation:function(){}},{name:"swiftType",type:"String",labels:["swift"],defaultValueFn:function(){return this.type}},{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The coding identifier for the entity.",documentation:function(){}},{model_:"BooleanProperty",name:"required",defaultValue:!0,labels:["debug"],documentation:function(){}},{name:"defaultValue",help:"Default Value if not required and not provided.",labels:["debug"],documentation:function(){}},{name:"description",type:"String",displayWidth:70,displayHeight:1,defaultValue:"",help:"A brief description of this argument.",labels:["debug"],documentation:function(){}},{name:"help",label:"Help Text",type:"String",displayWidth:70,displayHeight:6,defaultValue:"",help:"Help text associated with the entity.",labels:["debug"],documentation:function(){}},{model_:"DocumentationProperty",name:"documentation",documentation:"The developer documentation.",labels:["debug"]}],methods:{decorateFunction:function(f,i){if("Object"===this.type)return f
var type=this.type
return this.required?function(){return console.assert(void 0!==arguments[i],"Missing required argument# "+i),console.assert(typeof arguments[i]===type,"argument# "+i+" type expected to be "+type+", but was "+typeof arguments[i]+": "+arguments[i]),f.apply(this,arguments)}:function(){return console.assert(void 0===arguments[i]||typeof arguments[i]===type,"argument# "+i+" type expected to be "+type+", but was "+typeof arguments[i]+": "+arguments[i]),f.apply(this,arguments)}}},templates:[{model_:"Template",name:"javaSource",description:"Java Source",template:"<%= this.type %> <%= this.name %>",labels:["debug"]},{model_:"Template",name:"closureSource",description:"Closure JavaScript Source",template:"@param {<%= this.javascriptType %>} <%= this.name %> .",labels:["debug"]},{model_:"Template",name:"webIdl",description:"Web IDL Source",template:"<%= this.type %> <%= this.name %>",labels:["debug"]}]}),CLASS({name:"Template",tableProperties:["name","description"],documentation:function(){},properties:[{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The template's unique name.",documentation:function(){}},{name:"description",type:"String",required:!0,displayWidth:70,displayHeight:1,defaultValue:"",help:"The template's description.",documentation:"A human readable description of the $$DOC{ref:'.'}."},{model_:"ArrayProperty",name:"args",type:"Array[Arg]",subType:"Arg",view:"foam.ui.ArrayView",factory:function(){return[]},help:"Method arguments.",documentation:function(){}},{name:"template",type:"String",displayWidth:180,displayHeight:30,rows:30,cols:80,defaultValue:"",view:"foam.ui.TextAreaView",help:"Template text. <%= expr %> or <% out(...); %>",documentation:"The string content of the uncompiled $$DOC{ref:'Template'} body."},{name:"path"},{name:"futureTemplate","transient":!0},{name:"code","transient":!0},{model_:"DocumentationProperty",name:"documentation",labels:["debug"]},{name:"language",type:"String",lazyFactory:function(){return"CSS"===this.name?"css":"html"}},{name:"labels"}]}),CLASS({name:"Constant",plural:"constants",tableProperties:["name","value","description"],documentation:function(){},properties:[{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The coding identifier for the entity.",documentation:function(){}},{name:"description",type:"String",displayWidth:70,displayHeight:1,defaultValue:"",help:"A brief description of this method.",documentation:function(){}},{model_:"DocumentationProperty",name:"documentation",documentation:"The developer documentation.",labels:["debug"]},{name:"value",help:"The value of the constant.."},{name:"type",defaultValue:"",help:"Type of the constant."},{name:"translationHint",label:"Description for Translation",type:"String",defaultValue:""}]}),CLASS({name:"Message",plural:"messages",tableProperties:["name","value","translationHint"],documentation:function(){},properties:[{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The coding identifier for the message.",documentation:function(){}},{name:"value",type:"String",help:"The message itself."},{name:"meaning",type:"String",help:"Linguistic clarification to resolve ambiguity.",documentation:function(){}},{model_:"ArrayProperty",name:"placeholders",help:"Placeholders to inject into the message.",documentation:function(){}},{model_:"FunctionProperty",name:"replaceValues",documentation:function(){},defaultValue:function(){return this.value}},{name:"translationHint",type:"String",displayWidth:70,displayHeight:1,defaultValue:"",help:"A brief description of this message and the context in which it used.",documentation:function(){}}]}),CLASS({name:"Method",plural:"Methods",tableProperties:["name","description"],documentation:function(){},properties:[{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The coding identifier for the entity.",documentation:function(){}},{name:"description",type:"String",displayWidth:70,displayHeight:1,defaultValue:"",help:"A brief description of this method.",documentation:function(){}},{name:"help",label:"Help Text",type:"String",displayWidth:70,displayHeight:6,defaultValue:"",labels:["debug"],help:"Help text associated with the entity.",documentation:function(){}},{model_:"DocumentationProperty",name:"documentation",documentation:"The developer documentation.",labels:["debug"]},{name:"code",type:"Function",displayWidth:80,displayHeight:30,view:"foam.ui.FunctionView",help:"Javascript code to implement this method.",postSet:function(){if(_DOC_){var multilineComment=/^\s*function\s*\([\$\s\w\,]*?\)\s*{\s*\/\*([\s\S]*?)\*\/[\s\S]*$|^\s*\/\*([\s\S]*?)\*\/([\s\S]*)/.exec(this.code.toString())
if(multilineComment){var bodyFn=multilineComment[1]
this.documentation=this.Y.Documentation.create({name:this.name,body:bodyFn})}}},documentation:function(){}},{name:"returnType",defaultValue:"",help:"Return type.",documentation:function(){},labels:["debug"]},{name:"swiftReturnType",labels:["swift"],defaultValueFn:function(){return this.returnType}},{model_:"BooleanProperty",name:"returnTypeRequired",defaultValue:!0,documentation:function(){},labels:["debug"]},{model_:"ArrayProperty",name:"args",type:"Array[Arg]",subType:"Arg",view:"foam.ui.ArrayView",factory:function(){return[]},help:"Method arguments.",documentation:function(){},labels:["debug"]},{name:"whenIdle",help:"Should this listener be deferred until the system is idle (ie. not running any animations).",documentation:function(){}},{name:"isMerged",help:"As a listener, should this be merged?",documentation:function(){}},{model_:"BooleanProperty",name:"isFramed",help:"As a listener, should this be animated?",defaultValue:!1,documentation:function(){}},{name:"labels"},{model_:"TemplateProperty",name:"swiftSource",labels:["swift"],defaultValue:"<% var method = arguments[1]; %>    func <%= method.name %> (<%for ( var i = 0; i < method.args.length; i++ ) {%>var <%= method.args[i].name %>: <%= method.args[i].swiftType %><%if ( i != method.args.length - 1 ) { %>, <% }} %>)<% if ( method.swiftReturnType ) { %> -> <%= method.swiftReturnType %><% } %> {}\n"},{model_:"TemplateProperty",name:"javaSource",labels:["java"],defaultValue:function(){}}],templates:[{model_:"Template",name:"closureSource",description:"Closure JavaScript Source",template:"/**\n<% for ( var i = 0; i < this.args.length ; i++ ) { var arg = this.args[i]; %> * <%= arg.closureSource() %>\n<% } %><% if (this.returnType) { %> * @return {<%= this.returnType %>} .\n<% } %> */\n<%= arguments[1] %>.prototype.<%= this.name %> = goog.abstractMethod;"},{model_:"Template",name:"webIdl",description:"Web IDL Source",template:"<%= this.returnType || 'void' %> <%= this.name %>(<% for ( var i = 0 ; i < this.args.length ; i++ ) { var arg = this.args[i]; %><%= arg.webIdl() %><% if ( i < this.args.length-1 ) out(\", \"); %><% } %>)"}]}),Method.getPrototype().decorateFunction=function(f){for(var i=0;i<this.args.length;i++){var arg=this.args[i]
f=arg.decorateFunction(f,i)}var returnType=this.returnType
return returnType?function(){var ret=f.apply(this,arguments)
return console.assert(typeof ret===returnType,"return type expected to be "+returnType+", but was "+typeof ret+": "+ret),ret}:f},Method.getPrototype().generateFunction=function(){var f=this.code
return DEBUG?this.decorateFunction(f):f},Method.methods={decorateFunction:Method.getPrototype().decorateFunction,generateFunction:Method.getPrototype().generateFunction},CLASS({name:"Documentation",tableProperties:["name"],documentation:function(){},properties:[{name:"name",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"documentation",help:"The Document's unique name.",documentation:"An optional name for the document. Documentation is normally referenced by the name of the containing Model."},{name:"label",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",help:"The Document's title or descriptive label.",documentation:"A human readable title to display. Used for books of documentation and chapters."},{name:"body",type:"Template",defaultValue:"",help:"The main content of the document.",documentation:"The main body text of the document. Any valid template can be used, including the $$DOC{ref:'foam.documentation.DocView'} specific $$DOC{ref:'foam.documentation.DocView',text:'$$DOC{\"ref\"}'} tag.",preSet:function(_,template){return TemplateUtil.expandTemplate(this,template)}},{model_:"ArrayProperty",name:"chapters",type:"Array[Document]",subtype:"Documentation",view:"foam.ui.ArrayView",factory:function(){return[]},help:"Sub-documents comprising the full body of this document.",documentation:"Optional sub-documents to be included in this document. A viewer may choose to provide an index or a table of contents.",labels:["debug"],preSet:function(old,nu){if(!_DOC_)return[]
var self=this,foamalized=[]
return nu.forEach(function(chapter){!chapter||"undefined"==typeof self.Y.Documentation||!self.Y.Documentation||chapter.model_&&chapter.model_.getPrototype&&self.Y.Documentation.isInstance(chapter)?foamalized.push(chapter):chapter.body?foamalized.push(self.Y.Documentation.create(chapter)):foamalized.push(self.Y.Documentation.create({body:chapter}))}),foamalized}}]}),CLASS({name:"Relationship",tableProperties:["name","label","relatedModel","relatedProperty"],documentation:function(){},properties:[{name:"name",type:"String",displayWidth:30,displayHeight:1,defaultValueFn:function(){return GLOBAL[this.relatedModel]?GLOBAL[this.relatedModel].plural:""},documentation:function(){},help:"The coding identifier for the relationship."},{name:"label",type:"String",displayWidth:70,displayHeight:1,defaultValueFn:function(){return this.name.labelize()},documentation:function(){},help:"The display label for the relationship."},{name:"help",label:"Help Text",type:"String",displayWidth:70,displayHeight:6,defaultValue:"",documentation:function(){},help:"Help text associated with the relationship."},{model_:"DocumentationProperty",name:"documentation",documentation:function(){}},{name:"relatedModel",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",documentation:function(){},help:"The name of the related Model."},{name:"relatedProperty",type:"String",required:!0,displayWidth:30,displayHeight:1,defaultValue:"",documentation:function(){},help:"The join property of the related Model."}]}),function(){for(var i=0;i<Model.templates.length;i++)Model.templates[i]=JSONUtil.mapToObj(X,Model.templates[i])
Model.properties=Model.properties,delete Model.instance_.prototype_,Model=Model.create(Model)}(),recopyModelFeatures(Property),recopyModelFeatures(Model),recopyModelFeatures(Method),recopyModelFeatures(Action),recopyModelFeatures(Template),DEBUG)for(var id in UNUSED_MODELS)USED_MODELS[id]&&recopyModelFeatures(GLOBAL.lookup(id))
USED_MODELS.Model=!0,CLASS({name:"SimpleValue",properties:[{name:"value"}],methods:{init:function(value){this.value=value||""},get:function(){return this.value},set:function(val){this.value=val},toString:function(){return"SimpleValue("+this.value+")"}}}),CLASS({name:"OrValue",extendsModel:"SimpleValue",properties:[{name:"values"},{name:"valueFactory",defaultValue:function(){return arguments}}],methods:{init:function(){this.SUPER()
for(var i=0;i<this.values.length;i++)this.values[i].addListener(this.onSubValueChange)
this.value=this.valueFactory()},get:function(){return this.value},set:function(val){},toString:function(){return"OrValue("+this.value+")"}},listeners:[{name:"onSubValueChange",isFramed:!0,code:function(){for(var args=new Array(this.values.length),i=0;i<this.values.length;i++)args[i]=this.values[i].get()
this.value=this.valueFactory.apply(this,args)}}]}),CLASS({name:"SimpleReadOnlyValue",extendsModel:"SimpleValue",documentation:"A simple value that can only be set during initialization.",properties:[{name:"value",preSet:function(old,nu){return"undefined"==typeof this.instance_.value?nu:old}}],methods:{set:function(val){"undefined"==typeof this.instance_.value&&this.SUPER(val)},toString:function(){return"SimpleReadOnlyValue("+this.value+")"}}})
var DOM={init:function(X){X.document.FOAM_OBJECTS||(X.document.FOAM_OBJECTS={})
for(var fs=X.document.querySelectorAll("foam"),models=[],i=0;i<fs.length;i++){var e=fs[i]
X.lookup(e.getAttribute("view")),X.lookup(e.getAttribute("model")),e.getAttribute("view")&&models.push(X.arequire(e.getAttribute("view"))),e.getAttribute("model")&&models.push(X.arequire(e.getAttribute("model")))}for(var key in USED_MODELS)models.push(X.arequire(key))
atime("DOMInit",aseq(apar.apply(null,models),function(ret){for(var i=0;i<fs.length;i++){for(var e=fs[i],node=e,body=X.document.body;node&&node!==body;)node=node.parentNode
node&&(this.initElement(e,X,X.document),e.innerHTML=""),ret()}}.bind(this)))()},initElementChildren:function(e,X){for(var a=[],i=0;i<e.children.length;i++){var c=e.children[i]
"FOAM"===c.tagName&&a.push(DOM.initElement(c,X))}return a},initElement:function(e,X,opt_document){X.arequire("foam.ui.FoamTagView")(function(t){foam.ui.FoamTagView.create({element:e},X)})},setClass:function(e,className,opt_enabled){var oldClassName=e.className||"",enabled=void 0===opt_enabled?!0:opt_enabled
e.className=oldClassName.replace(" "+className,"").replace(className,""),enabled&&(e.className=e.className+" "+className)}}
window&&window.addEventListener&&window.addEventListener("load",function(){DOM.init(X)},!1)
var DomValue={DEFAULT_EVENT:"change",DEFAULT_PROPERTY:"value",create:function(element,opt_event,opt_property){if(!element)throw"Missing Element in DomValue"
return{__proto__:this,element:element,event:opt_event||this.DEFAULT_EVENT,property:opt_property||this.DEFAULT_PROPERTY}},setElement:function(element){this.element=element},get:function(){return this.element[this.property]},set:function(value){this.element[this.property]!==value&&(this.element[this.property]=value)},addListener:function(listener){if(this.event)try{this.element.addEventListener(this.event,listener,!1)}catch(x){}},removeListener:function(listener){if(this.event)try{this.element.removeEventListener(this.event,listener,!1)}catch(x){}},toString:function(){return"DomValue("+this.event+", "+this.property+")"}}
CLASS({name:"DOMValue",properties:[{name:"element",required:!0},{name:"property",defaultValue:"value"},{name:"event",defaultValue:"change"},{name:"value",postSet:function(_,value){this.element[this.property]=value}},{name:"firstListener_",defaultValue:!0}],methods:{init:function(){this.SUPER(),this.value=this.element[this.property]},get:function(){return this.value},set:function(value){this.value=value},addListener:function(listener){this.firstListener_&&(this.event&&this.element.addEventListener(this.event,function(){},!1),this.firstListener_=!1),this.value$.addListener(listener)},removeListener:function(listener){this.value$.removeListener(listener)},toString:function(){return"DOMValue("+this.event+", "+this.property+")"}}}),CLASS({"package":"foam.ui",name:"AbstractDAOView",extendsModel:"foam.ui.SimpleView",documentation:function(){},exports:["dao$ as daoViewCurrentDAO$"],properties:[{name:"data",postSet:function(oldDAO,dao){this.dao!==dao&&(this.dao=dao)},documentation:function(){}},{model_:"foam.core.types.DAOProperty",name:"dao",label:"DAO",help:"An alias for the data property.",onDAOUpdate:"onDAOUpdate",postSet:function(oldDAO,dao){dao?this.data!==dao&&(this.data=dao):this.data=""},documentation:function(){}}],methods:{onDAOUpdate:function(){}}}),CLASS({"package":"foam.ui",name:"DAOListView",requires:["SimpleValue"],extendsModel:"foam.ui.SimpleView",traits:["foam.ui.DAODataViewTrait"],constants:{ROW_CLICK:["row-click"]},properties:[{model_:"BooleanProperty",name:"isHidden",defaultValue:!1,postSet:function(_,isHidden){this.dao&&!isHidden&&this.onDAOUpdate()}},{model_:"ViewFactoryProperty",name:"rowView",defaultValue:"foam.ui.DetailView"},{name:"mode",defaultValue:"read-write",view:{factory_:"foam.ui.ChoiceView",choices:["read-only","read-write","final"]}},{name:"useSelection",help:"Backward compatibility for selection mode. Create a X.selection$ value in your context instead.",postSet:function(old,nu){this.useSelection&&!this.X.selection$&&(this.X.selection$=this.SimpleValue.create()),this.selection$=this.X.selection$}},{name:"selection",help:"Backward compatibility for selection mode. Create a X.selection$ value in your context instead.",factory:function(){return this.SimpleValue.create()}},{name:"scrollContainer",help:"Containing element that is responsible for scrolling."},{name:"chunkSize",defaultValue:0,help:"Number of entries to load in each infinite scroll chunk."},{name:"chunksLoaded",isHidden:!0,defaultValue:1,help:"The number of chunks currently loaded."},{model_:"BooleanProperty",name:"painting",defaultValue:!1,"transient":!0},{model_:"BooleanProperty",name:"repaintRequired",defaultValue:!1,"transient":!0},{model_:"ArrayProperty",name:"propertyListeners_",lazyFactory:function(){return[]}}],methods:{init:function(){this.SUPER()
var self=this
this.subscribe(this.ON_HIDE,function(){self.isHidden=!0}),this.subscribe(this.ON_SHOW,function(){self.isHidden=!1}),this.X.selection$&&(this.selection$=this.X.selection$)},initHTML:function(){if(this.SUPER(),this.chunkSize>0){for(var e=this.$;e&&"scroll"!==window.getComputedStyle(e).overflow;)e=e.parentElement
this.scrollContainer=e||window,this.scrollContainer.addEventListener("scroll",this.onScroll,!1)}this.isHidden||this.updateHTML()},construct:function(){if(this.dao&&this.$){if(this.painting)return void(this.repaintRequired=!0)
this.painting=!0
var out=[]
this.children=[],this.initializers_=[]
var doneFirstItem=!1,d=this.dao
this.chunkSize&&(d=d.limit(this.chunkSize*this.chunksLoaded)),d.select({put:function(o){"read-write"===this.mode&&(o=o.model_.create(o,this.Y))
var view=this.rowView({data:o,model:o.model_},this.Y)
if(view.DAO=this.dao,"read-write"===this.mode&&this.addRowPropertyListener(o,view),this.addChild(view),doneFirstItem?this.separatorToHTML(out):doneFirstItem=!0,this.X.selection$){var itemId=this.on("click",function(){this.selection=o,this.publish(this.ROW_CLICK)}.bind(this))
this.setClass("dao-selected",function(){return equals(this.selection,o)}.bind(this),itemId),this.setClass(this.className+"-row",function(){return!0},itemId),out.push('<div id="'+itemId+'">')}out.push(view.toHTML()),this.X.selection$&&out.push("</div>")}.bind(this)})(function(){if(this.repaintRequired)return this.repaintRequired=!1,this.painting=!1,void this.realDAOUpdate()
var e=this.$
e&&(e.innerHTML=out.join(""),this.initInnerHTML(),this.painting=!1)}.bind(this))}},destroy:function(isParentDestroyed){for(var listeners=this.propertyListeners_,i=0;i<listeners.length;++i)listeners[i].data.removePropertyListener(null,listeners[i].listener)
return this.propertyListeners_=[],this.SUPER(isParentDestroyed)},fromElement:function(e){var children=e.children
1==children.length&&"rowView"===children[0].nodeName?this.SUPER(e):this.rowView=e.innerHTML},separatorToHTML:function(out){},addRowPropertyListener:function(data,view){var listener=function(o,topic){var prop=o.model_.getProperty(topic[1])
prop["transient"]||view.DAO.put(o.deepClone())}
data.addPropertyListener(null,listener),this.propertyListeners_.push({data:data,listener:listener})}},listeners:[{name:"onDAOUpdate",code:function(){this.realDAOUpdate()}},{name:"realDAOUpdate",isFramed:!0,code:function(){this.isHidden||this.updateHTML()}},{name:"onScroll",code:function(){var e=this.scrollContainer
this.chunkSize>0&&e.scrollTop+e.offsetHeight>=e.scrollHeight&&(this.chunksLoaded++,this.updateHTML())}}]}),CLASS({"package":"foam.ui",name:"DetailView",extendsModel:"foam.ui.View",requires:["Property","foam.ui.TextFieldView","foam.ui.IntFieldView","foam.ui.FloatFieldView","foam.ui.DAOController"],exports:["propertyViewProperty"],documentation:function(){},properties:[{name:"className",defaultValue:"detailView",documentation:function(){}},{name:"data",preSet:function(old,nu){return nu.model_&&(this.model=nu.model_),nu}},{name:"model",postSet:function(_,model){console.assert(Model.isInstance(model),"Invalid model specified for "+this.name_)}},{name:"title",defaultValueFn:function(){return this.model.label},documentation:function(){}},{model_:"StringProperty",name:"mode",defaultValue:"read-write",documentation:function(){}},{model_:"BooleanProperty",name:"showRelationships",defaultValue:!1,documentation:function(){}},{name:"propertyViewProperty",type:"Property",defaultValueFn:function(){return this.Property.DETAIL_VIEW}}],methods:{shouldDestroy:function(old,nu){return old&&old.model_&&nu&&nu.model_?old.model_!==nu.model_:!0},generateContent:function(){this.$&&(this.$.outerHTML=this.toHTML(),this.initHTML())},titleHTML:function(){var title=this.title
return title?'<tr><td colspan="2" class="heading">'+title+"</td></tr>":""},startForm:function(){return"<table>"},endForm:function(){return"</table>"},startColumns:function(){return"<tr><td colspan=2><table valign=top><tr><td valign=top><table>"},nextColumn:function(){return"</table></td><td valign=top><table valign=top>"},endColumns:function(){return"</table></td></tr></table></td></tr>"},rowToHTML:function(prop,view){var str=""
return prop.detailViewPreRow&&(str+=prop.detailViewPreRow(this)),str+='<tr class="detail-'+prop.name+'">',this.DAOController.isInstance(view)?(str+="<td colspan=2><div class=detailArrayLabel>"+prop.label+"</div>",str+=view.toHTML(),str+="</td>"):(str+="<td class='label'>"+prop.label+"</td>",str+="<td>",str+=view.toHTML(),str+="</td>"),str+="</tr>",prop.detailViewPostRow&&(str+=prop.detailViewPostRow(this)),str},toHTML:function(){if(!this.data)return'<span id="'+this.id+'"></span>'
if(!this.model)throw"DetailView: either 'data' or 'model' must be specified."
return(this.model.getPrototype().toDetailHTML||this.defaultToHTML).call(this)},getDefaultProperties:function(){return this.model.getRuntimeProperties()},defaultToHTML:function(){this.children=[]
var model=this.model,str=""
str+='<div id="'+this.id+'" '+this.cssClassAttr()+'" name="form">',str+=this.startForm(),str+=this.titleHTML()
for(var properties=this.getDefaultProperties(),i=0;i<properties.length;i++){var prop=properties[i]
if(!prop.hidden){var view=this.createView(prop)
this.addDataChild(view),str+=this.rowToHTML(prop,view)}}if(str+=this.endForm(),this.showRelationships){var view=this.X.lookup("foam.ui.RelationshipsView").create({data:this.data})
this.addDataChild(view),str+=view.toHTML()}return str+="</div>"}},templates:[{name:"CSS",template:function CSS(){}}]}),CLASS({"package":"foam.grammars",name:"CSS3",imports:["assert"],constants:{PREFIXES:["-webkit-"],PREFIXED_KEYS:{"box-shadow":!0,flex:!0,"flex-direction":!0,"flex-grow":!0,"flex-shrink":!0,"flex-basis":!0,"flex-wrap":!0,"flex-flow":!0,order:!0,"align-self":!0,"justify-content":!0,"align-items":!0,"align-content":!0,"user-select":!0,display:"flex"}},properties:[{name:"parser",lazyFactory:function(){var css=this
return SkipGrammar.create({__proto__:grammar,START:sym("stylesheet"),nl:alt("\n",literal("\r\n"),"\r","\f"),ws:alt(" ","	",sym("nl")),digit:range("0","9"),hd:alt(range("0","9"),range("a","f"),range("A","F")),hdQM:alt(sym("hd"),"?"),hd16:str(seq(sym("hd"),optional(sym("hd")),optional(sym("hd")),optional(sym("hd")),optional(sym("hd")),optional(sym("hd")))),hd16QM:str(seq(sym("hd"),optional(sym("hdQM")),optional(sym("hdQM")),optional(sym("hdQM")),optional(sym("hdQM")),optional(sym("hdQM")))),esc:str(seq("\\",alt(not(alt(sym("nl"),sym("hd")),anyChar),str(seq(sym("hd16"),optional(sym("ws"))))))),wsTok:str(plus(sym("ws"))),wsStar:str(repeat(sym("ws"))),azAZ_nonASCII:alt(range("a","z"),range("A","Z"),"_",range(String.fromCharCode(128),String.fromCharCode(-1))),azAZ09__nonASCII:alt(range("a","z"),range("A","Z"),range("0","9"),"_","-",range(String.fromCharCode(128),String.fromCharCode(-1))),identTok:str(seq(optional("-"),alt(sym("azAZ_nonASCII"),sym("esc")),str(repeat(alt(sym("azAZ09__nonASCII"),sym("esc")))))),funcTok:seq1(0,sym("identTok"),"("),atkwTok:seq1(1,"@",sym("identTok")),hashTok:seq1(1,"#",str(plus(alt(sym("azAZ09__nonASCII"),sym("esc"))))),innerDblStr:str(repeat(alt(not(alt('"',"\\",sym("nl")),anyChar),sym("esc"),str(seq("\\",sym("nl")))))),innerSglStr:str(repeat(alt(not(alt("'","\\",sym("nl")),anyChar),sym("esc"),str(seq("\\",sym("nl")))))),dblStr:seq1(1,'"',sym("innerDblStr"),'"'),sglStr:seq1(1,"'",sym("innerSglStr"),"'"),strTok:alt(sym("dblStr"),sym("sglStr")),urlTok:seq1(2,"url(",sym("wsStar"),optional(seq1(0,alt(sym("urlUnquoted"),sym("strTok")),sym("wsStar"))),")"),urlUnquoted:str(plus(alt(not(alt('"',"'","(",")","\\",sym("ws"),sym("nonPrintable")),anyChar),sym("esc")))),nonPrintable:alt(range(String.fromCharCode(0),String.fromCharCode(8)),String.fromCharCode(11),range(String.fromCharCode(14),String.fromCharCode(31)),String.fromCharCode(127)),numTok:str(seq(optional(alt("+","-")),alt(str(seq(str(plus(sym("digit"))),".",str(plus(sym("digit"))))),str(plus(sym("digit"))),str(seq(".",str(plus(sym("digit")))))),optional(str(seq(alt("e","E"),optional(alt("+","-")),str(plus(sym("digit")))))))),dimTok:str(seq(sym("numTok"),sym("identTok"))),perTok:str(seq(sym("numTok"),"%")),uniRangeTok:str(seq(alt("U","u"),"+",alt(str(seq(sym("hd16"),"-",sym("hd16"))),sym("hd16QM"),sym("hd16")))),incMatchTok:literal("~="),dashMatchTok:literal("|="),prefMatchTok:literal("^="),sufMatchTok:literal("$="),subStrMatchTok:literal("*="),colTok:literal("||"),cdoTok:literal("<!--"),cdcTok:literal("-->"),colonTok:literal(":"),semicolonTok:literal(";"),commaTok:literal(","),preserved1:alt(sym("cdoTok"),sym("cdcTok"),sym("urlTok"),sym("strTok"),sym("perTok"),sym("dimTok"),sym("numTok"),sym("uniRangeTok"),sym("atkwTok"),sym("hashTok"),sym("identTok"),sym("incMatchTok"),sym("dashMatchTok"),sym("prefMatchTok"),sym("sufMatchTok"),sym("subStrMatchTok"),sym("colTok"),sym("wsTok"),sym("colonTok"),sym("commaTok")),preservedTokNoSemicolon:alt(sym("preserved1"),sym("delimTok")),preservedTok:alt(sym("preserved1"),sym("semicolonTok"),sym("delimTok")),delimTok:alt("#","$","*","+","-",".","/","<",">","@","^","|","~","="),stylesheet:repeat(alt(sym("cdoTok"),sym("cdcTok"),sym("wsTok"),sym("atRule"),sym("qualifiedRule"))),atRule:seq(sym("atkwTok"),sym("atRuleContents")),atRuleContents:alt(sym("atRuleBody"),sym("atRuleContentsContinued")),atRuleBody:alt(sym("braceBlock"),";"),atRuleContentsContinued:seq(sym("componentValueNoSemicolon"),sym("atRuleContents")),qualifiedRule:alt(sym("qualifiedRuleBlock"),sym("qualifiedRuleContinued")),qualifiedRuleBlock:sym("braceBlock"),qualifiedRuleContinued:seq(sym("componentValue"),sym("qualifiedRule")),rule:alt(sym("atRule"),sym("qualifiedRule")),ruleList:seq1(1,sym("wsStar"),alt(seq(sym("rule"),sym("ruleList")),sym("rule"))),declList:seq1(1,sym("wsStar"),alt(sym("declListOptDeclList"),sym("declListAtList"))),declListOptDeclList:seq(sym("declListOptDecl"),sym("declListOptList")),declListOptDecl:optional(sym("decl")),declListOptList:optional(seq(";",sym("declList"))),declListAtList:seq(sym("atRule"),sym("declList")),decl:seq(sym("identTok"),sym("wsStar"),":",str(repeat(sym("componentValueNoSemicolon"))),optional(sym("important"))),important:str(seq("!",sym("wsStar"),"important",sym("wsStar"))),componentValue:alt(sym("braceBlock"),sym("parenBlock"),sym("brackBlock"),sym("funcBlock"),sym("preservedTok")),componentValueNoSemicolon:alt(sym("braceBlock"),sym("parenBlock"),sym("brackBlock"),sym("funcBlock"),sym("preservedTokNoSemicolon")),braceBlock:seq1(1,"{",sym("braceBlockContents"),"}"),braceBlockContents:seq(sym("wsStar"),optional(alt(sym("ruleList"),sym("declList"))),str(repeat(sym("componentValue")))),parenBlock:seq1(1,"(",str(repeat(sym("componentValue"))),")"),brackBlock:seq1(1,"[",str(repeat(sym("componentValue"))),"]"),funcBlock:seq(sym("funcTok"),str(repeat(sym("componentValue"))),")")}.addActions({atkwTok:function(tok){return{model_:"AtKeyword",value:tok,toString:function(){return"@"+this.value.toString()}}},hashTok:function(tok){return{model_:"HashIdent",value:tok,toString:function(){return"#"+this.value.toString()}}},qualifiedRuleBlock:function(block){return{model_:"QualifiedRule",prelude:[],body:block,toString:function(){return this.prelude.map(function(p){return p.toString()}).join("")+this.body.toString()}}},qualifiedRuleContinued:function(parts){return css.isWhitespace(parts[0])?parts[1].prelude.unshift(" "):parts[1].prelude.unshift(parts[0]),parts[1]},atRule:function(parts){return{model_:"AtRule",atName:parts[0],contents:parts[1],toString:function(){return this.atName.toString()+" "+this.contents.toString()}}},atRuleBody:function(body){return{model_:"AtRuleContents",prelude:[],body:body,toString:function(){return this.prelude.join("")+this.body.toString()}}},atRuleContentsContinued:function(parts){return css.isWhitespace(parts[0])?parts[1].prelude.unshift(" "):parts[1].prelude.unshift(parts[0]),parts[1]},braceBlockContents:function(parts){var block={model_:"BraceBlock",contents:parts[1]?parts[1]:"",tail:parts[2]?css.stripWhitespace(parts[2]):"",toString:function(){return"{"+this.contents.toString()+this.tail.toString()+"}"}}
return block},brackBlock:function(body){var block={model_:"BracketBlock",body:body,toString:function(){return"["+css.stripWhitespace(this.body.toString())+"]"}}
return block},parenBlock:function(body){var block={model_:"ParenBlock",body:body,toString:function(){return"("+css.stripWhitespace(this.body.toString())+")"}}
return block},dblStr:function(contents){var block={model_:"DoubleStr",contents:contents,toString:function(){return'"'+this.contents.toString()+'"'}}
return block},sglStr:function(contents){var block={model_:"SingleStr",contents:contents,toString:function(){return"'"+this.contents.toString()+"'"}}
return block},urlTok:function(optUrl){return{model_:"Url",url:optUrl?optUrl:"",toString:function(){return"url("+this.url.toString()+")"}}},funcBlock:function(parts){var block={model_:"FuncBlock",name:parts[0],contents:parts[1].trim(),toString:function(){return this.name.toString()+"("+this.contents.toString()+")"}}
return block},decl:function(parts){var decl={model_:"Decl",key:parts[0],value:parts[3].trim(),important:!!parts[4],toString:function(){var key=this.key.toString(),important=this.important?"!important":"",prefixData=css.PREFIXED_KEYS[key],value=this.value.toString(),values=css.PREFIXES.length>0&&prefixData===value?css.PREFIXES.map(function(p){return p+value}).concat(value):[value],rtn=values.map(function(v){return key+":"+v+important})
if(prefixData===!0)for(var i=0;i<css.PREFIXES.length;++i)rtn=rtn.concat(values.map(function(v){return css.PREFIXES[i]+key+":"+v+important}))
return rtn.join(";")}}
return decl},ruleList:function(parts){return 2===parts.length?(parts[1].list.unshift(parts[0]),parts[1]):{model_:"RuleList",list:[parts],toString:function(){return this.list.join("")}}},declListOptDecl:function(decl){return{model_:"DeclList",list:decl?[decl]:[],toString:function(){return this.list.map(function(decl){return decl.toString()}).join(";")}}},declListOptList:function(parts){return parts&&parts[1]?parts[1]:""},declListAtList:function(atList){return atList[1].list=[atList[0]].concat(atList[1].list),atList[1]},declListOptDeclList:function(declAndList){return declAndList[1]&&(declAndList[0].list=declAndList[0].list.concat(declAndList[1].list)),declAndList[0]},stylesheet:function(parts){var stylesheet={model_:"Stylesheet",contents:parts.filter(function(p){return!css.isWhitespace(p)}),toString:function(){return this.contents.map(function(c){return c.toString()}).join("")}}
return stylesheet}}),seq("/*",str(repeat(not("*/",anyChar))),"*/"))}}],methods:[function isWhitespace(str){return str.model_?!1:!!str.match(/^[ \t\r\n\f]*$/g)},function stripWhitespace(str){return str.model_?str:str.replace(/[ \t\r\n\f]/g,"")}]}),CLASS({"package":"foam.html",name:"Element",constants:{OPTIONAL_CLOSE_TAGS:{HTML:!0,HEAD:!0,BODY:!0,P:!0,DT:!0,DD:!0,LI:!0,OPTION:!0,THEAD:!0,TH:!0,TBODY:!0,TR:!0,TD:!0,TFOOT:!0,COLGROUP:!0},ILLEGAL_CLOSE_TAGS:{IMG:!0,INPUT:!0,BR:!0,HR:!0,FRAME:!0,AREA:!0,BASE:!0,BASEFONT:!0,COL:!0,ISINDEX:!0,LINK:!0,META:!0,PARAM:!0}},properties:[{name:"id"},{name:"nodeName"},{name:"attributeMap_","transient":!0,factory:function(){return{}}},{name:"attributes",factory:function(){return[]},postSet:function(_,attrs){for(var i=0;i<attrs.length;i++)this.attributeMap_[attrs[i].name]=attrs[i]}},{name:"childNodes",factory:function(){return[]}},{name:"children","transient":!0,getter:function(){return this.childNodes.filter(function(c){return"string"!=typeof c})}},{name:"outerHTML","transient":!0,getter:function(){var out="<"+this.nodeName
this.id&&(out+=' id="'+this.id+'"')
for(key in this.attributeMap_){var value=this.attributeMap_[key].value
out+=void 0==value?" "+key:" "+key+'="'+this.attributeMap_[key].value+'"'}return this.ILLEGAL_CLOSE_TAGS[this.nodeName]||this.OPTIONAL_CLOSE_TAGS[this.nodeName]&&!this.childNodes.length||(out+=">",out+=this.innerHTML,out+="</"+this.nodeName),out+=">"}},{name:"innerHTML","transient":!0,getter:function(){for(var out="",i=0;i<this.childNodes.length;i++)out+=this.childNodes[i].toString()
return out}}],methods:{setAttribute:function(name,value){var attr=this.getAttributeNode(name)
attr?attr.value=value:(attr={name:name,value:value},this.attributes.push(attr),this.attributeMap_[name]=attr)},getAttributeNode:function(name){return this.attributeMap_[name]},getAttribute:function(name){var attr=this.getAttributeNode(name)
return attr&&attr.value},appendChild:function(c){this.childNodes.push(c)},removeChild:function(c){for(var i=0;i<this.childNodes.length;++i)if(this.childNodes[i]===c){this.childNodes.splice(i,1)
break}},toString:function(){return this.outerHTML}}})
var HTMLParser={__proto__:grammar,create:function(){return{__proto__:this,stack:[X.foam.html.Element.create({nodeName:"html"})]}},peek:function(){return this.stack[this.stack.length-1]},START:sym("html"),html:repeat0(sym("htmlPart")),htmlPart:simpleAlt(sym("cdata"),sym("comment"),sym("text"),sym("endTag"),sym("startTag")),tag:seq(sym("startTag"),repeat(seq1(1,sym("matchingHTML"),sym("htmlPart")))),matchingHTML:function(ps){return this.stack.length>1?ps:null},startTag:seq("<",sym("tagName"),sym("whitespace"),sym("attributes"),sym("whitespace"),optional("/"),">"),endTag:function(){var endTag_=sym("endTag_")
return function(ps){return this.stack.length>1?this.parse(endTag_,ps):void 0}}(),endTag_:seq1(1,"</",sym("tagName"),">"),cdata:seq1(1,"<![CDATA[",str(repeat(not("]]>",anyChar))),"]]>"),comment:seq("<!--",repeat0(not("-->",anyChar)),"-->"),attributes:repeat(sym("attribute"),sym("whitespace")),label:str(plus(notChars(" %=/	\r\n<>'\""))),tagName:sym("label"),text:str(plus(alt("<%",notChar("<")))),attribute:seq(sym("label"),optional(seq1(1,"=",sym("value")))),value:str(alt(plus(alt(range("a","z"),range("A","Z"),range("0","9"))),seq1(1,'"',repeat(notChar('"')),'"'))),whitespace:repeat0(alt(" ","	","\r","\n"))}.addActions({START:function(xs){var ret=this.stack[0]
return this.stack=[X.foam.html.Element.create({nodeName:"html"})],ret},tag:function(xs){var ret=this.stack[0]
return this.stack=[X.foam.html.Element.create({nodeName:"html"})],ret.childNodes[0]},attribute:function(xs){return{name:xs[0],value:xs[1]}},cdata:function(xs){this.peek()&&this.peek().appendChild(xs)},text:function(xs){this.peek()&&this.peek().appendChild(xs)},startTag:function(xs){var tag=xs[1],obj=X.foam.html.Element.create({nodeName:tag,attributes:xs[3]})
return this.peek()&&this.peek().appendChild(obj),"/"!=xs[5]&&this.stack.push(obj),obj},endTag:function(tag){for(var stack=this.stack;stack.length>1;){if(this.peek().nodeName===tag)return void stack.pop()
var top=stack.pop()
this.peek().childNodes=this.peek().childNodes.concat(top.childNodes),top.childNodes=[]}}})
!function(){var registry={}
X.registerElement=function(name,model){registry[name]=model,TemplateParser.foamTag_=function(){var start=seq("<",simpleAlt.apply(null,Object.keys(registry).sort(function(o1,o2){return o2.compareTo(o1)}).map(function(k){return literal_ic(k)})),alt("/"," ",">")),html=HTMLParser.create()["export"]("tag")
return function(ps){var res=this.parse(start,ps)&&this.parse(html,ps)
if(!res)return null
var elem=res.value,model=registry[elem.nodeName]
return model&&elem.setAttribute("model",model),res.setValue(elem)}}(),invalidateParsers()},X.elementModel=function(name){return registry[name]}}(),X.registerElement("foam",null)
var Visitor={create:function(){return{__proto__:this,stack:[]}},push:function(o){this.stack.push(o)},pop:function(){return this.stack.pop()},top:function(){return this.stack.length&&this.stack[this.stack.length-1]},visit:function(o){return Array.isArray(o)?this.visitArray(o):"string"==typeof o?this.visitString(o):"number"==typeof o?this.visitNumber(o):o instanceof Function?this.visitFunction(o):o instanceof Date?this.visitDate(o):o===!0?this.visitTrue():o===!1?this.visitFalse():null===o?this.visitNull():o instanceof Object?o.model_?this.visitObject(o):this.visitMap(o):this.visitUndefined()},visitArray:function(o){for(var len=o.length,i=0;len>i;i++)this.visitArrayElement(o,i)
return o},visitArrayElement:function(arr,i){this.visit(arr[i])},visitString:function(o){return o},visitFunction:function(o){return o},visitNumber:function(o){return o},visitDate:function(o){return o},visitObject:function(o){var properties=o.model_.getRuntimeProperties()
for(var key in properties){var prop=properties[key]
prop.name in o.instance_&&this.visitProperty(o,prop)}return o},visitProperty:function(o,prop){this.visit(o[prop.name])},visitMap:function(o){for(var key in o)this.visitMapElement(key,o[key])
return o},visitMapElement:function(key,value){},visitTrue:function(){return!0},visitFalse:function(){return!1},visitNull:function(){return null},visitUndefined:function(){return void 0}},LoggingDAO={create:function(){var logger,delegate
return 2==arguments.length?(logger=arguments[0],delegate=arguments[1]):(logger=console.log.bind(console),delegate=arguments[0]),{__proto__:delegate,put:function(obj,sink){logger("put",obj),delegate.put(obj,sink)},remove:function(query,sink){logger("remove",query),delegate.remove(query,sink)},select:function(sink,options){return logger("select",options||""),delegate.select(sink,options)},removeAll:function(sink,options){return logger("removeAll",options),delegate.removeAll(sink,options)}}}},TimingDAO={create:function(name,delegate){function start(op){var str=name+"-"+op,key=activeOps[op]++?str+"-"+id++:str
return console.time(id),[key,str,window.performance.now(),op]}function end(act){activeOps[act[3]]--,id--,console.timeEnd(act[0]),console.log("Timing: ",act[1]," ",(window.performance.now()-act[2]).toFixed(3)," ms")}function endSink(act,sink){return{put:function(){end(act),sink&&sink.put&&sink.put.apply(sink,arguments)},remove:function(){end(act),sink&&sink.remove&&sink.remove.apply(sink,arguments)},error:function(){end(act),sink&&sink.error&&sink.error.apply(sink,arguments)},eof:function(){end(act),sink&&sink.eof&&sink.eof.apply(sink,arguments)}}}var id,activeOps={put:0,remove:0,find:0,select:0}
return{__proto__:delegate,put:function(obj,sink){var act=start("put")
delegate.put(obj,endSink(act,sink))},remove:function(query,sink){var act=start("remove")
delegate.remove(query,endSink(act,sink))},find:function(key,sink){var act=start("find")
delegate.find(key,endSink(act,sink))},select:function(sink,options){var act=start("select"),fut=afuture()
return delegate.select(sink,options)(function(s){end(act),fut.set(s)}),fut.get}}}},ObjectToJSON={__proto__:Visitor.create(),visitFunction:function(o){return o.toString()},visitObject:function(o){return this.push({model_:(o.model_["package"]?o.model_["package"]+".":"")+o.model_.name}),this.__proto__.visitObject.call(this,o),this.pop()},visitProperty:function(o,prop){prop.propertyToJSON(this,this.top(),o)},visitMap:function(o){return this.push({}),Visitor.visitMap.call(this,o),this.pop()},visitMapElement:function(key,value){this.top()[key]=this.visit(value)},visitArray:function(o){return this.push([]),this.__proto__.visitArray.call(this,o),this.pop()},visitArrayElement:function(arr,i){this.top().push(this.visit(arr[i]))}},JSONToObject={__proto__:ObjectToJSON.create(),visitString:function(o){try{return"function("===o.substr(0,9)?eval("("+o+")"):o}catch(x){return console.log(x,o),o}},visitObject:function(o){var model=X.lookup(o.model_)
if(!model)throw new Error("Unknown Model: "+o.model_)
var obj=model.create()
return Object_forEach(o,function(value,key){"model_"!==key&&(obj[key]=this.visit(value))}.bind(this)),obj},visitArray:Visitor.visitArray,visitArrayElement:function(arr,i){arr[i]=this.visit(arr[i])}}
CLASS({name:"FilteredDAO_",extendsModel:"foam.dao.ProxyDAO",documentation:"<p>Internal use only.</p>",properties:[{name:"query",required:!0}],methods:{select:function(sink,options){return this.delegate.select(sink,options?{__proto__:options,query:options.query?AND(this.query,options.query):this.query}:{query:this.query})},removeAll:function(sink,options){return this.delegate.removeAll(sink,options?{__proto__:options,query:options.query?AND(this.query,options.query):this.query}:{query:this.query})},listen:function(sink,options){return this.SUPER(sink,options?{__proto__:options,query:options.query?AND(this.query,options.query):this.query}:{query:this.query})},toString:function(){return this.delegate+".where("+this.query+")"}}}),CLASS({name:"OrderedDAO_",extendsModel:"foam.dao.ProxyDAO",documentation:function(){},properties:[{name:"comparator",required:!0}],methods:{select:function(sink,options){return options?options.order||(options={__proto__:options,order:this.comparator}):options={order:this.comparator},this.delegate.select(sink,options)},toString:function(){return this.delegate+".orderBy("+this.comparator+")"}}}),CLASS({name:"LimitedDAO_",extendsModel:"foam.dao.ProxyDAO",documentation:function(){},properties:[{name:"count",required:!0}],methods:{select:function(sink,options){return options=options?"limit"in options?{__proto__:options,limit:Math.min(this.count,options.limit)}:{__proto__:options,limit:this.count}:{limit:this.count},this.delegate.select(sink,options)},toString:function(){return this.delegate+".limit("+this.count+")"}}}),CLASS({name:"SkipDAO_",extendsModel:"foam.dao.ProxyDAO",documentation:function(){},properties:[{name:"skip",required:!0,postSet:function(){this.skip!==Math.floor(this.skip)&&console.warn("skip() called with non-integer value: "+this.skip)}}],methods:{select:function(sink,options){return options=options?{__proto__:options,skip:this.skip}:{skip:this.skip},this.delegate.select(sink,options)},toString:function(){return this.delegate+".skip("+this.skip+")"}}}),CLASS({name:"RelationshipDAO",extendsModel:"FilteredDAO_",documentation:"Adapts a DAO based on a Relationship.",properties:[{name:"relatedProperty",required:!0},{name:"relativeID",required:!0},{name:"query",lazyFactory:function(){return AND(NEQ(this.relatedProperty,""),EQ(this.relatedProperty,this.relativeID))}}],methods:[function put(obj,sink){obj[this.relatedProperty.name]=this.relativeID,this.SUPER(obj,sink)}]}),CLASS({name:"AbstractDAO",documentation:function(){},properties:[{name:"daoListeners_","transient":!0,hidden:!0,factory:function(){return[]},compareProperty:function(){return 0}}],methods:{update:function(expr){return this.select(UPDATE(expr,this))},select:function(sink,options){},remove:function(query,sink){},pipe:function(sink,options){sink=this.decorateSink_(sink,options,!0)
var fc=this.createFlowControl_(),self=this
this.select({put:function(){sink.put&&sink.put.apply(sink,arguments)},remove:function(){sink.remove&&sink.remove.apply(sink,arguments)},error:function(){sink.error&&sink.error.apply(sink,arguments)},eof:function(){fc.stopped?sink.eof&&sink.eof():self.listen(sink,options)}},options,fc)},decorateSink_:function(sink,options,isListener,disableLimit){return options&&(disableLimit||(options.limit&&(sink=limitedSink(options.limit,sink)),options.skip&&(sink=skipSink(options.skip,sink))),options.order&&!isListener&&(sink=orderedSink(options.order,sink)),options.query&&(sink=predicatedSink(options.query.partialEval?options.query.partialEval():options.query,sink))),sink},createFlowControl_:function(){return{stop:function(){this.stopped=!0},error:function(e){this.errorEvt=e}}},where:function(query){return(this.Y||X).lookup("FilteredDAO_").create({query:query,delegate:this})},limit:function(count){return(this.Y||X).lookup("LimitedDAO_").create({count:count,delegate:this})},skip:function(skip){return(this.Y||X).lookup("SkipDAO_").create({skip:skip,delegate:this})},orderBy:function(){return(this.Y||X).lookup("OrderedDAO_").create({comparator:1==arguments.length?arguments[0]:argsToArray(arguments),delegate:this})},listen:function(sink,options){this.daoListeners_.push(this.decorateSink_(sink,options,!0))},unlisten:function(sink){for(var ls=this.daoListeners_,i=0;i<ls.length;i++)if(ls[i].$UID===sink.$UID)return ls.splice(i,1),!0
console.assert(!DEBUG,"Phantom DAO unlisten: ",this,sink)},removeAll:function(sink,options){var self=this,future=afuture()
return this.select({put:function(obj){self.remove(obj,{remove:sink&&sink.remove})}})(function(){sink&&sink.eof(),future.set()}),future.get},notify_:function(fName,args){for(var i=0;i<this.daoListeners_.length;i++){var l=this.daoListeners_[i],fn=l[fName]
if(fn){args[2]={stop:function(fn,l){return function(){fn(l)}}(this.unlisten.bind(this),l),error:function(e){}}
try{fn.apply(l,args)}catch(err){err!==this.UNSUBSCRIBE_EXCEPTION&&(console.error("Error delivering event (removing listener): ",fName,err),DEBUG&&console.error(err.stack)),this.unlisten(l)}}}}}}),Function.prototype.put=function(){this.apply(this,arguments)},Function.prototype.remove=function(){this.apply(this,arguments)},Function.prototype.reset=function(){this.call(this)},function(){var pmap={}
for(var key in AbstractDAO.methods)pmap[AbstractDAO.methods[key].name]=AbstractDAO.methods[key].code
for(var key in pmap)Object.defineProperty(Array.prototype,key,{value:pmap[key],configurable:!0,writable:!0})}(),defineLazyProperty(Array.prototype,"daoListeners_",function(){return{value:[],configurable:!0}})
var ArraySink={__proto__:Array.prototype,put:function(obj,sink){this.push(obj),this.notify_("put",arguments),sink&&sink.put&&sink.put(obj)},clone:function(){return this.slice().sink},deepClone:function(){return Array.prototype.call(this).sink}}
MODEL0({extendsProto:"Array",properties:[{name:"dao",getter:function(){return this.__proto__=Array.prototype,this}},{name:"sink",getter:function(){return this.__proto__=ArraySink,this}}],methods:{listen:AbstractDAO.getPrototype().listen,unlisten:AbstractDAO.getPrototype().unlisten,notify_:AbstractDAO.getPrototype().notify_,deleteF:function(v){for(var a=this.clone(),i=0;i<a.length;i++)if(a[i]===v){a.splice(i,1)
break}return a},deleteI:function(v){for(var i=0;i<this.length;i++)if(this[i]===v)return this.splice(i,1),!0
return!1},removeF:function(p){for(var a=this.clone(),i=0;i<a.length;i++)if(p.f(a[i])){a.splice(i,1)
break}return a},removeI:function(p){for(var i=0;i<this.length;i++)p.f(this[i])&&(this.splice(i,1),breeak)
return this},pushF:function(obj){var a=this.clone()
return a.push(obj),a},id:function(obj){return obj.id||obj.$UID},put:function(obj,sink){for(var idx=0;idx<this.length;idx++)if(this[idx].id===obj.id)return this[idx]=obj,sink&&sink.put&&sink.put(obj),void this.notify_("put",arguments)
this.push(obj),this.notify_("put",arguments),sink&&sink.put&&sink.put(obj)},find:function(query,sink){if(query.f){for(var idx=0;idx<this.length;idx++)if(query.f(this[idx]))return void(sink&&sink.put&&sink.put(this[idx]))}else for(var idx=0;idx<this.length;idx++)if(this[idx].id===query)return void(sink&&sink.put&&sink.put(this[idx]))
sink&&sink.error&&sink.error("find",query)},remove:function(obj,sink){if(!obj)return void(sink&&sink.error&&sink.error("missing key"))
for(var objId=obj.id,id=void 0!==objId&&""!==objId?objId:obj,idx=0;idx<this.length;idx++)if(this[idx].id===id){var rem=this.splice(idx,1)[0]
return this.notify_("remove",[rem]),void(sink&&sink.remove&&sink.remove(rem))}sink&&sink.error&&sink.error("remove",obj)},removeAll:function(sink,options){options||(options={}),options.query||(options.query={f:function(){return!0}})
for(var i=0;i<this.length;i++){var obj=this[i]
if(options.query.f(obj)){var rem=this.splice(i,1)[0]
this.notify_("remove",[rem]),sink&&sink.remove&&sink.remove(rem),i--}}return sink&&sink.eof&&sink.eof(),anop()},select:function(sink,options){sink=sink||[].sink
var hasQuery=options&&(options.query||options.order),originalsink=sink
if(sink=this.decorateSink_(sink,options,!1,!hasQuery),!hasQuery&&GLOBAL.CountExpr&&CountExpr.isInstance(sink))return sink.count=this.length,aconstant(originalsink)
for(var fc=this.createFlowControl_(),start=Math.max(0,hasQuery?0:options&&options.skip||0),end=hasQuery?this.length:Math.min(this.length,start+(options&&options.limit||this.length)),i=start;end>i&&(sink.put(this[i],null,fc),!fc.stopped);i++)if(fc.errorEvt)return sink.error&&sink.error(fc.errorEvt),aconstant(originalsink,fc.errorEvt)
return sink.eof&&sink.eof(),aconstant(originalsink)}}}),CLASS({"package":"foam.ui",name:"Window",exports:["$$","$","addStyle","animate","cancelAnimationFrame","clearInterval","clearTimeout","console","document","framed","dynamic","dynamic2","dynamic3","error","info","installedModels","log","requestAnimationFrame","setInterval","setTimeout","warn","window","writeView","as FOAMWindow"],properties:[{name:"registeredModels",factory:function(){return{}}},{model_:"StringProperty",name:"name",defaultValue:"window"},{name:"window",postSet:function(_,w){this.X.subDocument&&this.X.subDocument(w.document),w.X=this.Y,this.document=w.document}},{name:"document"},{name:"installedModels",documentation:"Each new Window context introduces a new document and resets installedModels so models will install again in the new document.",factory:function(){return{}}},{model_:"BooleanProperty",name:"isBackground",defaultValue:!1},{name:"console",lazyFactory:function(){return this.window.console}}],methods:{addStyle:function(css,opt_source){if(opt_source&&(css+="\n\n/*# sourceURL="+opt_source+" */\n"),this.document&&this.document.createElement){var s=this.document.createElement("style")
s.innerHTML=css,this.document.head.insertBefore(s,this.document.head.firstElementChild)}},log:function(){this.console.log.apply(this.console,arguments)},warn:function(){this.console.warn.apply(this.console,arguments)},info:function(){this.console.info.apply(this.console,arguments)},error:function(){this.console.error.apply(this.console,arguments)},$:function(id){return this.document.FOAM_OBJECTS&&this.document.FOAM_OBJECTS[id]?this.document.FOAM_OBJECTS[id]:this.document.getElementById(id)},$$:function(cls){return this.document.getElementsByClassName(cls)},framed:function(listener){return EventService.framed(listener,this)},dynamic:function(fn,opt_fn){return Events.dynamic(fn,opt_fn,this.Y)},dynamic2:function(fn){var listener=this.framed(fn),propertyValues=[]
fn(),Events.onGet.push(function(obj,name,value){if(arguments.callee.caller.caller!==fn)return void console.log("false alarm ",fn.toString())
var value=obj.propertyValue(name)
value.addListener(listener),propertyValues.push(value)})
var ret=fn()
Events.onGet.pop()
var f=function(){propertyValues.forEach(function(p){p.removeListener(listener)})}
return f.destroy=f,f},dynamic3:function(obj,fn,opt_ret){for(var values=fn.dependencies.map(function(name){return obj.propertyValue(name)}),listener=this.framed(function(){var ret=fn.call(obj)
opt_ret&&opt_ret(ret)}),i=0;i<values.length;i++)values[i].addListener(listener)
var f=function(){for(var i=0;i<values.length;i++)values[i].removeListener(listener)}
return f.destroy=f,f},animate:function(duration,fn,opt_interp,opt_onEnd){return Movement.animate(duration,fn,opt_interp,opt_onEnd,this.Y)},setTimeout:function(f,t){return this.window.setTimeout.apply(this.window,arguments)},clearTimeout:function(id){this.window.clearTimeout(id)},setInterval:function(f,t){return this.window.setInterval.apply(this.window,arguments)},clearInterval:function(id){this.window.clearInterval(id)},requestAnimationFrame:function(f){return this.isBackground?this.setTimeout(f,16):(console.assert(this.window.requestAnimationFrame,"requestAnimationFrame not defined"),this.window.requestAnimationFrame(f))},cancelAnimationFrame:function(id){return this.isBackground?void this.clearTimeout(id):void(this.window.cancelAnimationFrame&&this.window.cancelAnimationFrame(id))},writeView:function(view,opt_X){var document=(opt_X||this.X).document,html=view.toHTML()
document.body.insertAdjacentHTML("beforeend",html),view.initHTML()}}}),function(){var w=foam.ui.Window.create({window:window,name:"DEFAULT WINDOW",isBackground:"object"==typeof process},X)
FObject.X=X=w.Y}(),CLASS({name:"IdGenerator","package":"foam.i18n",methods:[{name:"getMessageId",code:function(model,msg){return model.name+"_Message_"+msg.name}},{name:"getActionTextLabelId",code:function(model,action){return model.name+"_ActionLabel_"+action.name}},{name:"getActionSpeechLabelId",code:function(model,action){return model.name+"_ActionSpeechLabel_"+action.name}}]}),CLASS({name:"Visitor","package":"foam.i18n",todos:["When i18n integration is stable: Turn ActionLabel into ActionTextLabel ","When i18n integration is stable: Include package in model.name prefix"],requires:["foam.i18n.IdGenerator"],imports:["warn"],properties:[{model_:"BooleanProperty",name:"revisitModels",defaultValue:!1},{name:"visitedModels",lazyFactory:function(){return{}}},{name:"idGenerator",factory:function(){return this.IdGenerator.create()}}],methods:[{name:"avisitModel",code:function(model){if(!this.revisitModels&&this.visitedModels[model.id])return aconstant(model)
var self=this,modelPrefix=model.translationHint?model.translationHint+" ":"",i,key,msg,action
if(model.messages)for(i=0;i<model.messages.length;++i)msg=model.messages[i],this.visitMessage(model,msg,i)
if(model.actions)for(i=0;i<model.actions.length;++i)action=model.actions[i],action.translationHint&&(action.label||action.speechLabel)&&this.visitAction(model,action,i)
return this.visitedModels[model.id]=!0,aconstant(model)}},{name:"visitMessage",code:function(model){return this.warn("Visitor without visitMessage implementation: "+this.name_),this}},{name:"visitAction",code:function(model){return this.warn("Visitor without visitAction implementation: "+this.name_),this}}]}),CLASS({name:"MessagesExtractor","package":"foam.i18n",extendsModel:"foam.i18n.Visitor",requires:["foam.i18n.Message","foam.i18n.MessageGenerator","foam.i18n.MessageBundle","foam.i18n.Placeholder"],imports:["console"],properties:[{model_:"foam.core.types.DAOProperty",name:"dao",lazyFactory:function(){return[]}},{name:"messageGenerator",lazyFactory:function(){return this.MessageGenerator.create({idGenerator:this.idGenerator})}},{name:"messageBundleFactory",lazyFactory:function(){return this.MessageBundle.create.bind(this.MessageBundle)}}],methods:[{name:"visitMessage",code:function(model,msg){var i18nMsg=this.messageGenerator.generateMessage(model,msg)
return this.dao.put(i18nMsg),i18nMsg}},{name:"visitAction",code:function(model,action){for(var msgs=this.messageGenerator.generateActionMessages(model,action),keys=Object.keys(msgs),i=0;i<keys.length;++i)this.dao.put(msgs[keys[i]])
return msgs}},{name:"achromeMessages",code:function(ret){var msgs={}
this.dao.select({put:function(msg){msgs[msg.id]=msg.toChromeMessage()},eof:function(){ret(msgs)}})}},{name:"amessages",code:function(ret){this.abuildMessages_(ret)}},{name:"amessagesFile",code:function(dataId,ret){this.abuildMessages_(function(msgs){msgs.id=dataId,ret("__DATA("+JSONUtil.compact.where(NOT_TRANSIENT).stringify(msgs)+");")})}},{name:"abuildMessages_",code:function(ret){var msgs=this.messageBundleFactory(),arr=msgs.messages
this.dao.select({put:function(msg){arr.push(msg)}.bind(this),eof:function(){ret(msgs)}})}},{name:"ai18n",code:function(format,ret){throw'ERROR: i18n output format "'+format+'" not recognized'}}]}),CLASS({name:"ChromeMessagesInjector","package":"foam.i18n",extendsModel:"foam.i18n.Visitor",imports:["warn"],methods:[{name:"visitMessage",code:function(model,msg,msgIdx){this.maybeSetMessage(model.messages[msgIdx],"value",this.idGenerator.getMessageId(model,msg))}},{name:"visitAction",code:function(model,action,actionIdx){action.translationHint&&(action.label&&this.maybeSetMessage(model.actions[actionIdx],"label",this.idGenerator.getActionTextLabelId(model,action)),action.speechLabel&&this.maybeSetMessage(model.actions[actionIdx],"speechLabel",this.idGenerator.getActionSpeechLabelId(model,action)))}},{name:"maybeSetMessage",code:function(obj,objKey,msgKey){var i18nMessage=GLOBAL.chrome&&GLOBAL.chrome.i18n&&GLOBAL.chrome.i18n.getMessage&&GLOBAL.chrome.i18n.getMessage(msgKey)
i18nMessage?obj[objKey]=i18nMessage:this.warn('ChromeMessagesInjector: "'+msgKey+'": No such message')}}]}),CLASS({"package":"foam.i18n",name:"GlobalController",requires:["foam.i18n.IdGenerator","foam.i18n.MessagesExtractor","foam.i18n.MessagesInjector","foam.i18n.ChromeMessagesInjector"],properties:[{name:"idGenerator",factory:function(){return this.IdGenerator.create()}},{name:"extractor",lazyFactory:function(){return this.MessagesExtractor.create({idGenerator$:this.idGenerator$})}},{name:"injector",lazyFactory:function(){return GLOBAL.chrome&&GLOBAL.chrome.runtime&&GLOBAL.chrome.runtime.id?this.ChromeMessagesInjector.create({idGenerator$:this.idGenerator$}):this.MessagesInjector.create({idGenerator$:this.idGenerator$})}}],methods:[{name:"avisitAllCurrentModels",code:function(ret,visitors){for(var par=[],modelNames=Object.keys(USED_MODELS),i=0;i<modelNames.length;++i)par.push(this.avisitModel(visitors,lookup(modelNames[i])))
return apar.apply(null,par)}},{name:"avisitAllKnownModels",code:function(visitors){var par=[],modelNames,i
for(modelNames=Object.keys(USED_MODELS),i=0;i<modelNames.length;++i)par.push(this.avisitModel(visitors,lookup(modelNames[i])))
for(modelNames=Object.keys(UNUSED_MODELS),i=0;i<modelNames.length;++i)par.push(this.avisitModel(visitors,lookup(modelNames[i])))
return apar.apply(null,par)}},{name:"avisitModel",code:function(visitors,model){for(var par=[],i=0;i<visitors.length;++i)par.push(visitors[i].avisitModel(model))
return apar.apply(null,par)}}]}),X.arequire("foam.i18n.GlobalController")(function(GlobalController){var i18nGC=GlobalController.create()
GLOBAL.X.i18nModel=function(ret,model,X){i18nGC.avisitModel([i18nGC.injector],model)(ret)}}),!1 in Math&&(Math.log10=function(a){return Math.log(a)/Math.LN10})
var DEFAULT_OP=function(a1,a2){return a2}
DEFAULT_OP.toString=function(){return""},CLASS({name:"Calc",translationHint:"Calculator",requires:["foam.apps.calc.CalcView","foam.apps.calc.History","foam.apps.calc.NumberFormatter","foam.graphics.ActionButtonCView","foam.graphics.CViewView","foam.input.touch.GestureManager","foam.input.touch.TouchManager","foam.ui.animated.Label","foam.ui.md.Flare","foam.ui.DAOListView","AbstractDAO"],exports:["gestureManager","touchManager"],constants:{MAX_HISTORY:30},messages:[{name:"CalcName",value:"Calculator",translationHint:"name of application for performing simple calculations"}],properties:[{name:"numberFormatter",factory:function(){return this.NumberFormatter.create()}},{name:"degreesMode",defaultValue:!1},{name:"memory",defaultValue:0},{name:"a1",defaultValue:0},{name:"a2",defaultValue:""},{name:"editable",defaultValue:!0},{name:"op",defaultValue:DEFAULT_OP},{model_:"ArrayProperty",name:"history",view:"foam.ui.DAOListView",factory:function(){return[].sink}},{model_:"StringProperty",name:"row1",view:"foam.ui.animated.Label"},{name:"touchManager",factory:function(){var tm=this.TouchManager.create()
return window.X.touchManager=tm,tm}},{name:"gestureManager",factory:function(){var gm=this.GestureManager.create()
return window.X.gestureManager=gm,gm}}],methods:{factorial:function(n){if(n>170)return this.error(),1/0
if(n=parseFloat(n),!Number.isInteger(n))return gamma(n+1)
for(var r=1;n>0;)r*=n--
return r},permutation:function(n,r){return this.factorial(n)/this.factorial(n-r)},combination:function(n,r){return this.permutation(n,r)/this.factorial(r)},error:function(){this.X.$$("calc-display")[0]&&setTimeout(this.Flare.create({element:this.X.$$("calc-display")[0],color:"#f44336"}).fire,100),this.history.put(this.History.create(this)),this.a1=0,this.a2="",this.op=DEFAULT_OP,this.row1="",this.editable=!0},init:function(){this.SUPER(),Events.dynamic(function(){this.op,this.a2}.bind(this),EventService.framed(function(){Number.isNaN(this.a2)&&this.error()
var a2=this.numberFormatter.formatNumber(this.a2)
this.row1=this.op+(""!==a2?"&nbsp;"+a2:"")}.bind(this)))},push:function(a2,opt_op){for((a2!=this.a2||(opt_op||DEFAULT_OP)!=this.op)&&(this.row1=""),this.history.put(this.History.create(this));this.history.length>this.MAX_HISTORY;)this.history.shift()
this.a1=this.a2,this.op=opt_op||DEFAULT_OP,this.a2=a2},replace:function(op){this.op=op||DEFAULT_OP}},actions:[num(1),num(2),num(3),num(4),num(5),num(6),num(7),num(8),num(9),num(0),binaryOp("div",["/"],function(a1,a2){return a1/a2},"","divide","divide"),binaryOp("mult",["*"],function(a1,a2){return a1*a2},"","multiply","multiply"),binaryOp("plus",["+"],function(a1,a2){return a1+a2},"+","plus","plus"),binaryOp("minus",["-"],function(a1,a2){return a1-a2},"","minus","minus"),{name:"ac",label:"AC",speechLabel:"all clear",translationHint:"all clear (calculator button label)",keyboardShortcuts:["a","c"],code:function(){if(this.row1="",this.a1="0",this.a2="",this.editable=!0,this.op=DEFAULT_OP,this.history=[].sink,this.X.$$("calc-display")[0]){var now=Date.now()
if(this.lastFlare_&&now-this.lastFlare_<1e3)return
this.lastFlare_=now,this.Flare.create({element:this.X.$$("calc-display")[0],color:"#2196F3"}).fire(),this.X.window.getSelection().removeAllRanges()}}},{name:"sign",label:"+/-",speechLabel:"negate",keyboardShortcuts:["n"],translationHint:"switch positive/negative sign of number",code:function(){this.a2=-this.a2}},{name:"point",labelFn:function(){return this.numberFormatter.useComma?",":"."},speechLabel:"point",keyboardShortcuts:[".",","],translationHint:"decimal point",code:function(){this.editable?-1==this.a2.toString().indexOf(".")&&(this.a2=(this.a2?this.a2:"0")+".",this.editable=!0):(this.push("0."),this.editable=!0)}},{name:"equals",label:"=",speechLabel:"equals",keyboardShortcuts:["=",13],translationHint:"compute operation and display result",code:function(){if("string"!=typeof this.a2||""!=this.a2){if(this.op==DEFAULT_OP){var last=this.history[this.history.length-1]
if(!last||last.op===DEFAULT_OP)return
last.op.binary?(this.push(this.a2),this.a2=last.a2):this.a1=this.a2,this.op=last.op}this.push(this.op(parseFloat(this.a1),parseFloat(this.a2))),this.editable=!1}}},{name:"backspace",label:"",speechLabel:"backspace",translationHint:"delete one input character",keyboardShortcuts:[8],code:function(){var selection=this.X.window.getSelection().toString()
return selection&&selection.split("\n").length==this.history.length+1?void this.ac():void(this.editable&&(this.a2.toString().length?this.a2=this.a2.toString().substring(0,this.a2.length-1):this.op=DEFAULT_OP))}},{name:"pi",label:"",keyboardShortcuts:["p"],translationHint:"mathematical constant, pi",code:function(){this.a2=Math.PI}},{name:"e",label:"e",keyboardShortcuts:["e"],translationHint:"mathematical constant, e",code:function(){this.a2=Math.E}},{name:"percent",label:"%",speechLabel:"percent",keyboardShortcuts:["%"],translationHint:"convert number to percentage",code:function(){this.a2/=100}},unaryOp("inv",["i"],function(a){return 1/a},"1/x",void 0,"inverse","inverse"),unaryOp("sqroot",[],Math.sqrt,"","square root","square root"),unaryOp("square",["@"],function(a){return a*a},"x","x squared","x squared"),unaryOp("ln",[],Math.log,"ln","natural logarithm","natural logarithm"),unaryOp("exp",[],Math.exp,"e",void 0,"e to the power of n"),unaryOp("log",[],function(a){return Math.log(a)/Math.LN10},"log","logarithm","log base 10"),binaryOp("root",[],function(a1,a2){return Math.pow(a2,1/a1)}," Y",void 0,"the enth root of y"),binaryOp("pow",["^"],Math.pow,"y",void 0,"y to the power of n"),unaryOp("sin",[],trigFn(Math.sin),"sin","sine","sine"),unaryOp("cos",[],trigFn(Math.cos),"cos","cosine","cosine"),unaryOp("tan",[],trigFn(Math.tan),"tan","tangent","tangent"),{name:"deg",speechLabel:"switch to degrees",keyboardShortcuts:[],translationHint:'short form for "degrees" calculator mode',code:function(){this.degreesMode=!0}},{name:"rad",speechLabel:"switch to radians",keyboardShortcuts:[],translationHint:'short form for "radians" calculator mode',code:function(){this.degreesMode=!1}},unaryOp("asin",[],invTrigFn(Math.asin),"asin","inverse-sine","arcsine"),unaryOp("acos",[],invTrigFn(Math.acos),"acos","inverse-cosine","arccosine"),unaryOp("atan",[],invTrigFn(Math.atan),"atan","inverse-tangent","arctangent"),unaryOp("fact",["!"],function(n){return this.factorial(n)},"x!","factorial","factorial"),binaryOp("mod",[],function(a1,a2){return a1%a2},"mod","modulo","modulo"),binaryOp("p",[],function(n,r){return this.permutation(n,r)},"nPr","permutations (n permute r)","permutation"),binaryOp("c",[],function(n,r){return this.combination(n,r)},"nCr","combinations (n combine r))","combination"),unaryOp("round",[],Math.round,"rnd","round","round"),{name:"rand",label:"rand",speechLabel:"random",keyboardShortcuts:[],translationHint:"generate random number",code:function(){this.a2=Math.random()}},unaryOp("store",[],function(n){return this.memory=n,n},"a=","store in memory","store in memory"),{name:"fetch",label:"a",speechLabel:"fetch from memory",keyboardShortcuts:[],translationHint:"load memorized number",code:function(){this.a2=this.memory}}]}),CLASS({"package":"foam.apps.calc",name:"CalcView",extendsModel:"foam.ui.View",requires:["foam.apps.calc.HistoryCitationView","foam.ui.SlidePanel","foam.apps.calc.MainButtonsView","foam.apps.calc.SecondaryButtonsView","foam.apps.calc.TertiaryButtonsView","foam.apps.calc.CalcButton","foam.apps.calc.CalcSpeechView","foam.apps.calc.Fonts","foam.apps.calc.NumberFormatter","foam.ui.animated.Label"],imports:["document"],exports:["data"],properties:[{model_:"StringProperty",name:"row1Formatted",preSet:function(_,nu){return this.numberFormatter.i18nNumber(nu)},view:"foam.ui.animated.Label"},{name:"data",postSet:function(){this.numberFormatter=this.data.numberFormatter,Events.follow(this.data.row1$,this.row1Formatted$)}},{name:"installFonts_",hidden:!0,factory:function(){return this.document.head.querySelector("link[rel=stylesheet][href*=Roboto]")?"":this.Fonts.create()}},{model_:"IntProperty",name:"animating_",postSet:function(old,nu){if(!nu&&old!==nu&&this.$){var outerHeight=this.$outer.clientHeight,innerHeight=this.$inner.clientHeight
this.$inner.style.top=outerHeight>innerHeight?"calc(100% - "+innerHeight+"px)":"0px"}},defaultValue:!1},{name:"$inner",getter:function(){return this.$.querySelector(".inner-calc-display")}},{name:"$outer",getter:function(){return this.$.querySelector(".calc-display")}}],methods:[function initHTML(){this.SUPER(),this.$.addEventListener("paste",this.onPaste)
var move=EventService.framed(EventService.framed(function(){if(this.$){var value=DOMValue.create({element:this.$outer,property:"scrollTop"})
Movement.compile([function(){++this.animating_}.bind(this),[200,function(){value.value=this.$inner.clientHeight}.bind(this)],function(){--this.animating_}.bind(this)])()}}.bind(this)))
Events.dynamic(function(){this.data.op,this.data.history,this.data.a1,this.data.a2}.bind(this),move),this.X.window.addEventListener("resize",move),this.$.querySelector(".keypad").addEventListener("mousedown",function(e){return e.preventDefault(),!1})}],listeners:[{name:"onPaste",code:function(evt){var CMD={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9","+":"plus","-":"minus","*":"mult","/":"div","%":"percent","=":"equals"}
CMD[this.data.numberFormatter.useComma?",":"."]="point"
for(var data=evt.clipboardData.getData("text/plain"),i=0;i<data.length;i++){var c=data.charAt(i)
"-"!==c||i||this.data.history.length||this.data.row1||this.data[0]()
var cmd=CMD[c]
cmd&&this.data[cmd]()}},whenIdle:!0}],templates:[{name:"CSS",code:ConstantTemplate("* {box-sizing:border-box;outline:none;}html {height:100%;margin:0;overflow:initial;padding:0;width:100%;}body {-webkit-user-select:none;-webkit-font-smoothing:antialiased;font-family:RobotoDraft, 'Helvetica Neue', Helvetica, Arial;font-size:30px;font-weight:300;height:100%;position:fixed;margin:0;overflow:hidden;padding:0;width:100%;}::-webkit-scrollbar {display:none;}::-webkit-scrollbar-thumb {display:none;}.calc {background-color:#eee;border:0;display:-webkit-flex;display:flex;flex-direction:column;-webkit-flex-direction:column;height:100%;margin:0;padding:0px;}.deg, .rad {background-color:#eee;color:#111;font-size:22px;font-weight:400;opacity:0;padding-left:8px;padding-right:10px;transition:opacity 0.8s;}.active {opacity:1;z-index:2;}.calc-display, .calc-display:focus {border:none;letter-spacing:1px;line-height:36px;margin:0;min-width:140px;padding:0 25pt 2pt 25pt;text-align:right;-webkit-user-select:text;overflow-y:scroll;overflow-x:hidden;}.edge {background:linear-gradient(to bottom, rgba(240,240,240,1) 0%,\nrgba(240,240,240,0) 100%);height:20px;position:absolute;top:0;width:100%;z-index:1;}.calc .buttons {flex:1 1 100%;-webkit-flex:1 1 100%;width:100%;height:252px;}.button-row {display:-webkit-flex;display:flex;flex-direction:row;-webkit-flex-direction:row;flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex:1 1 100%;-webkit-flex:1 1 100%;justify-content:space-between;-webkit-justify-content:space-between;}.button {flex-grow:1;-webkit-flex-grow:1;justify-content:center;-webkit-justify-content:center;display:-webkit-flex;display:flex;align-items:center;-webkit-align-items:center;background-color:#4b4b4b;}.rhs-ops {border-left-width:1px;border-left-style:solid;border-left-color:rgb(68, 68, 68);background:#777;}.rhs-ops .button {background-color:#777;}.button-column {display:-webkit-flex;display:flex;flex-direction:column;-webkit-flex-direction:column;flex-wrap:nowrap;-webkit-flex-wrap:nowrap;}.inner-calc-display {position:absolute;right:20pt;top:100%;width:100%;padding-left:50px;padding-bottom:11px;}.calc-display {flex-grow:5;-webkit-flex-grow:5;position:relative;}.secondaryButtons {padding-left:30px;background:rgb(52, 153, 128);}.secondaryButtons .button {background:rgb(52, 153, 128);}.tertiaryButtons {padding-left:35px;background:rgb(29, 233, 182);}.tertiaryButtons .button {background:rgb(29, 233, 182);}.keypad {flex-grow:0;-webkit-flex-grow:0;flex-shrink:0;-webkit-flex-shrink:0;margin-bottom:-4px;z-index:5;}.alabel {font-size:30px;}hr {border-style:outset;opacity:0.5;}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this)
return out("\n        ",this.CalcSpeechView.create({calc:this.data}),"\n        \n        "),X.registerModel(this.CalcButton,"foam.ui.ActionButton"),out('\n        <div style="position: relative;z-index: 100;">\n          <div tabindex="1" style="position: absolute;">\n            <span aria-label="',Calc.RAD.label,'" style="top: 10;left: 0;position: absolute;" id="',this.setClass("active",function(){return!this.data.degreesMode}),'" class="rad" title="',Calc.RAD.label,'"></span>\n            <span aria-label="',Calc.DEG.label,'" style="top: 10;left: 0;position: absolute;" id="',this.setClass("active",function(){return this.data.degreesMode}),'" class="deg" title="',Calc.DEG.label,'"></span>\n          </div>\n        </div>\n\n        <div class="edge"></div>\n        <div id="',self.id,'" class="calc">\n          <div class="calc-display">\n            <div class="inner-calc-display">\n              ',self.createTemplateView("history",{rowView:"foam.apps.calc.HistoryCitationView"}),"\n              <div>",self.createTemplateView("row1Formatted",{mode:"read-only",tabIndex:3,escapeHTML:!1}),'</div>\n            </div>\n          </div>\n          <div class="keypad">\n          <div class="edge2"></div>\n          ',this.SlidePanel.create({data:this.data,side:"right",minWidth:310,minPanelWidth:320,panelRatio:.55,mainView:"foam.apps.calc.MainButtonsView",stripWidth:30,panelView:{factory_:"foam.ui.SlidePanel",side:"right",stripWidth:30,minWidth:320,minPanelWidth:220,panelRatio:3/7,mainView:"foam.apps.calc.SecondaryButtonsView",panelView:"foam.apps.calc.TertiaryButtonsView"}}),"\n          </div>\n        </div>\n      "),out.toString()},language:"html"}]}),CLASS({"package":"foam.apps.calc",name:"HistoryCitationView",extendsModel:"foam.ui.View",templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this)
return out('\n      <div class="history" tabindex="2">',this.data.op,"&nbsp;",escapeHTML(this.data.a2),""),this.data.op.toString()&&out('<hr aria-label="',escapeHTML(Calc.EQUALS.speechLabel),'" tabindex="2">'),out("</div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.ui",name:"View",extendsModel:"foam.ui.DestructiveDataView",traits:["foam.ui.HTMLViewTrait"],requires:["Property"],exports:["propertyViewProperty"],properties:[{name:"propertyViewProperty",type:"Property",defaultValueFn:function(){return this.Property.DETAIL_VIEW}}]}),CLASS({"package":"foam.ui",name:"HTMLViewTrait",label:"HTMLView",requires:["foam.input.touch.GestureTarget","foam.ui.ActionBorder","foam.ui.PropertyView","foam.ui.AsyncLoadingView"],properties:[{name:"id",label:"Element ID",type:"String",factory:function(){return this.instance_.id||this.nextID()}},{model_:"foam.core.types.DocumentInstallProperty",name:"installCSS",documentInstallFn:function(X){for(var i=0;i<this.model_.templates.length;i++){var t=this.model_.templates[i]
if("CSS"===t.name)return void t.futureTemplate(function(){X.addStyle(this.CSS(),this.model_.id.split(".").join("/")+".CSS")}.bind(this))}}},{name:"shortcuts",type:"Array[Shortcut]",factory:function(){return[]}},{name:"$",mode:"read-only",hidden:!0,getter:function(){return this.X.document.getElementById(this.id)},setter:function(){},help:"DOM Element."},{name:"tagName",defaultValue:"span"},{name:"className",defaultValue:"",help:"CSS class name(s), space separated."},{name:"tooltip"},{name:"tabIndex"},{name:"extraClassName",defaultValue:""},{name:"propertyViewProperty",type:"Property",defaultValueFn:function(){return this.X.Property.VIEW}},{name:"initializers_",factory:function(){return[]}},{name:"destructors_",factory:function(){return[]}},{model_:"BooleanProperty",name:"showActions",postSet:function(oldValue,showActions){!oldValue&&showActions&&this.addDecorator(this.ActionBorder.create())},defaultValue:!1},{name:"minWidth",defaultValue:0},{name:"minHeight",defaultValue:0},{name:"preferredWidth",defaultValue:400},{name:"preferredHeight",defaultValue:40},{name:"maxWidth",defaultValue:1e4},{name:"maxHeight",defaultValue:1e4},{name:"$parent",getter:function(){return this.$?this.$.parentElement:null}}],constants:[{name:"KEYPRESS_CODES",value:{8:!0,33:!0,34:!0,37:!0,38:!0,39:!0,40:!0}},{name:"NAMED_CODES",value:{37:"left",38:"up",39:"right",40:"down"}},{name:"ON_HIDE",value:["onHide"]},{name:"ON_SHOW",value:["onShow"]}],methods:[function strToHTML(str){return XMLUtil.escape(str.toString())},function cssClassAttr(){if(!this.className&&!this.extraClassName)return""
var s=' class="'
return this.className&&(s+=this.className,this.extraClassName&&(s+=" ")),this.extraClassName&&(s+=this.extraClassName),s+'"'},function bindSubView(view,prop){view.setValue(this.propertyValue(prop.name))},function focus(){this.$&&this.$.focus&&this.$.focus()},function addChild(child){return child.toView_&&(child=child.toView_()),-1==this.children.indexOf(child)?this.SUPER(child):void 0},function addShortcut(key,callback,context){this.shortcuts.push([key,callback,context])},function nextID(){return"view"+(arguments.callee._nextId=(arguments.callee._nextId||0)+1)},function addInitializer(f){this.initializers_.push(f)},function addDestructor(f){this.destructors_.push(f)},function tapClick(){},function resize(){var e=this.X.document.createEvent("Event")
e.initEvent("resize",!0,!0),this.$&&this.X.window.getComputedStyle(this.$),this.X.window.dispatchEvent(e)},function on(event,listener,opt_id){if(opt_id=opt_id||this.nextID(),listener=listener.bind(this),"click"===event&&this.X.gestureManager){var self=this,manager=this.X.gestureManager,target=this.GestureTarget.create({containerID:opt_id,enforceContainment:!0,handler:{tapClick:function(pointMap){return listener({preventDefault:function(){},stopPropagation:function(){},pointMap:pointMap,target:self.X.$(opt_id)})}},gesture:"tap"})
return manager.install(target),this.addDestructor(function(){manager.uninstall(target)}),opt_id}return this.addInitializer(function(){var e=this.X.$(opt_id)
e&&e.addEventListener(event,listener,!1)}.bind(this)),opt_id},function setAttribute(attributeName,valueFn,opt_id){var self=this
opt_id=opt_id||this.nextID(),valueFn=valueFn.bind(this),this.addInitializer(function(){self.X.dynamic(valueFn,function(){var e=self.X.$(opt_id)
if(!e)throw EventService.UNSUBSCRIBE_EXCEPTION
var newValue=valueFn(e.getAttribute(attributeName))
void 0==newValue?e.removeAttribute(attributeName):e.setAttribute(attributeName,newValue)})})},function setStyle(styleName,valueFn,opt_id){var self=this
return opt_id=opt_id||this.nextID(),valueFn=valueFn.bind(this),this.addInitializer(function(){self.X.dynamic(valueFn,function(value){var e=self.X.$(opt_id)
if(!e)throw EventService.UNSUBSCRIBE_EXCEPTION
e.style[styleName]=value})}),opt_id},function setClass(className,predicate,opt_id){var self=this
return opt_id=opt_id||this.nextID(),predicate=predicate.bind(this),this.addInitializer(function(){self.addDestructor(self.X.dynamic(predicate,function(){var e=self.X.$(opt_id)
if(!e)throw EventService.UNSUBSCRIBE_EXCEPTION
DOM.setClass(e,className,predicate())}).destroy)}),opt_id},function setClasses(map,opt_id){opt_id=opt_id||this.nextID()
for(var keys=Objects.keys(map),i=0;i<keys.length;i++)this.setClass(keys[i],map[keys[i]],opt_id)
return opt_id},function insertInElement(name){var e=this.X.$(name)
e.innerHTML=this.toHTML(),this.initHTML()},function write(opt_X){var X=opt_X||this.X
X.writeView(this,X)},function updateHTML(){this.$&&(this.destroy(),this.construct())},function construct(){this.SUPER(),this.generateContent()},function generateContent(){this.$&&(this.$.innerHTML=this.toInnerHTML(),this.initInnerHTML())},function toInnerHTML(){return""},function toHTML(){return this.invokeDestructors(),"<"+this.tagName+' id="'+this.id+'"'+this.cssClassAttr()+">"+this.toInnerHTML()+"</"+this.tagName+">"},function initHTML(){this.initInnerHTML(),this.initKeyboardShortcuts()},function maybeInitTooltip(){this.tooltip&&this.$&&(this.$.addEventListener("mouseenter",this.openTooltip),this.$.addEventListener("mouseleave",this.closeTooltip))},function initInnerHTML(){this.invokeInitializers(),this.initChildren()},function initChildren(){if(this.children)for(var i=0;i<this.children.length;i++)try{this.children[i].initHTML&&this.children[i].initHTML()}catch(x){console.log("Error on View.child.initHTML",x,x.stack)}},function invokeInitializers(){for(var i=0;i<this.initializers_.length;i++)this.initializers_[i]()
this.initializers_=[]},function invokeDestructors(){for(var i=0;i<this.destructors_.length;i++)this.destructors_[i]()
this.destructors_=[]},function evtToCharCode(evt){var s=""
return evt.altKey&&(s+="alt-"),evt.ctrlKey&&(s+="ctrl-"),evt.shiftKey&&"keydown"===evt.type&&(s+="shift-"),evt.metaKey&&(s+="meta-"),s+="keydown"===evt.type?this.NAMED_CODES[evt.which]||String.fromCharCode(evt.which):String.fromCharCode(evt.charCode)},function initKeyboardShortcuts(){function init(actions,opt_value){actions.forEach(function(action){for(var j=0;j<action.keyboardShortcuts.length;j++){var key=action.keyboardShortcuts[j]
"number"==typeof key&&(key=String.fromCharCode(key)),keyMap[key]=opt_value?function(){action.maybeCall(self.X,opt_value.get())}:action.maybeCall.bind(action,self.X,self),found=!0}})}var keyMap={},found=!1,self=this
if(init(this.model_.getRuntimeActions()),this.data&&this.data.model_&&this.data.model_.getRuntimeActions().length&&init(this.data.model_.getRuntimeActions(),this.data$),found){console.assert(this.$,"View must define outer id when using keyboard shortcuts: "+this.name_),this.keyMap_=keyMap
var target=this.$parent
target.setAttribute("tabindex",target.tabIndex+""),target.addEventListener("keydown",this.onKeyboardShortcut),target.addEventListener("keypress",this.onKeyboardShortcut)}},function destroy(isParentDestroyed){this.invokeDestructors(),this.SUPER(isParentDestroyed),delete this.instance_.$},function close(){this.$&&this.$.remove(),this.destroy(),this.publish("closed")},function rectOnPage(){for(var node=this.$,x=0,y=0,parent,rect=this.$.getBoundingClientRect();node;)parent=node,x+=node.offsetLeft,y+=node.offsetTop,node=node.offsetParent
return{top:y,left:x,right:x+rect.width,bottom:y+rect.height,width:rect.width,height:rect.height}},function rectOnViewport(){return this.$.getBoundingClientRect()},function viewportOnPage(){var bodyRect=this.X.document.documentElement.getBoundingClientRect(),vpSize=this.viewportSize()
return{left:-bodyRect.left,top:-bodyRect.top,width:vpSize.width,height:vpSize.height,right:-bodyRect.left+vpSize.width,bottom:-bodyRect.top+vpSize.height}},function viewportSize(){return{height:window.innerHeight||this.X.document.documentElement.clientHeight,width:window.innerWidth||this.X.document.documentElement.clientWidth}},function createView(prop,opt_args){var X=opt_args&&opt_args.X||this.Y,v=this.PropertyView.create({id:(this.nextID?this.nextID():this.id)+"PROP",prop:prop,copyFrom:opt_args},X)
return this[prop.name+"View"]=v.view,v},function removeChild(child){this.PropertyView.isInstance(child)&&child.prop&&delete this[child.prop.name+"View"],this.SUPER(child)},function createRelationshipView(r,opt_args){if(opt_args.model_)return this.createView(r,opt_args)
var X=opt_args&&opt_args.X||this.Y,v=this.AsyncLoadingView.create({id:this.nextID(),name:r.name,model:"foam.ui.RelationshipView",args:{relationship:r},copyFrom:opt_args},X)
return v.view&&(v=v.view),this[r.name+"View"]=v,v},function createActionView(action,opt_args){var X=opt_args&&opt_args.X||this.Y,modelName=opt_args&&opt_args.model_?opt_args.model_:"foam.ui.ActionButton",v=this.AsyncLoadingView.create({id:this.nextID(),name:action.name,model:modelName,args:{action:action},copyFrom:opt_args},X)
return v.view&&(v=v.view),this[action.name+"View"]=v.cview||v,v},function createTemplateView(name,opt_args){var args=opt_args||{},X=this.Y,myData=this.data$
if(myData&&myData.value&&myData.value.model_){var o=myData.value.model_.getFeature(name)
if(o){var v
return v=Action.isInstance(o)?this.createActionView(o,args):Relationship.isInstance(o)?this.createRelationshipView(o,args):this.createView(o,args),this.addDataChild(v),v}}var o=this.model_.getFeature(name)
if(!o)throw"Unknown View Name: "+name
var v
return v=Action.isInstance(o)?this.createActionView(o,args):Relationship.isInstance(o)?this.createRelationshipView(o,args):this.createView(o,args),this.addSelfDataChild(v),v},function dynamicTag(tagName,f){var id=this.nextID(),self=this
return this.addInitializer(function(){self.X.dynamic(function(){var html=f(),e=self.X.$(id)
e&&(e.innerHTML=html)})}),"<"+tagName+' id="'+id+'"></'+tagName+">"}],listeners:[{name:"openTooltip",code:function(e){console.assert(!this.tooltip_,"Tooltip already defined"),this.X.arequire("foam.ui.Tooltip")(function(Tooltip){this.tooltip_=Tooltip.create({text:this.tooltip,target:this.$},this.Y)}.bind(this))}},{name:"closeTooltip",code:function(e){this.tooltip_&&(this.tooltip_.close(),this.tooltip_=null)}},{name:"onKeyboardShortcut",code:function(evt){if("keydown"!==evt.type||this.KEYPRESS_CODES[evt.which]){var action=this.keyMap_[this.evtToCharCode(evt)]
action&&(action(),evt.preventDefault(),evt.stopPropagation())}}}]}),CLASS({"package":"foam.input.touch",name:"GestureTarget",properties:[{name:"id"},{name:"gesture",help:"The name of the gesture to be tracked."},{name:"containerID",help:"The containing DOM node's ID. Used for checking what inputs are within which gesture targets."},{model_:"BooleanProperty",name:"enforceContainment",help:"Require that the start and end of a matching gesture be inside the container.",defaultValue:!1},{name:"getElement",defaultValue:function(){return this.X.$(this.containerID)},help:"Function to retrieve the element this gesture is attached to. Defaults to $(containerID)."},{name:"handler",help:"The target for the gesture's events, after it has been recognized."}],help:"Created by each view that wants to receive gestures."}),CLASS({"package":"foam.ui",name:"ActionBorder",methods:[function toHTML(border,delegate,args){var str=""
str+=delegate.apply(this,args),str+='<div class="actionToolbar">'
for(var actions=this.model_.getRuntimeActions(),i=0;i<actions.length;i++){var v=this.createActionView(actions[i])
this.addSelfDataChild(v),str+=" "+v.toView_().toHTML()+" "}if(this.X.lookup("foam.ui.DetailView").isInstance(this)){actions=this.model.actions
for(var i=0;i<actions.length;i++){var v=this.createActionView(actions[i])
this.addDataChild(v),str+=" "+v.toView_().toHTML()+" "}}return str+="</div>"}]}),CLASS({"package":"foam.ui",name:"PropertyView",extendsModel:"foam.ui.AsyncLoadingView",properties:[{name:"prop",type:"Property",postSet:function(old,nu){old&&this.bound_&&this.unbindData(this.data),nu&&!this.bound_&&this.bindData(this.data),this.args=nu,this.model=this.innerView||nu.view}},{name:"data",postSet:function(old,nu){old&&this.bound_&&this.unbindData(old),nu&&this.bindData(nu)}},{name:"childData"},{name:"innerView",postSet:function(old,nu){this.model=nu},help:"Override for prop.view"},{name:"view",type:"foam.ui.View",adapt:function(_,v){return v&&v.toView_?v.toView_():v}},{model_:"BooleanProperty",name:"bound_",defaultValue:!1},{name:"parent",type:"foam.ui.View",postSet:function(_,p){p&&(p[this.prop.name+"View"]=this.view,this.view&&(this.view.parent=p))}}],methods:[function unbindData(oldData){if(this.bound_&&oldData&&this.prop){var pValue=oldData.propertyValue(this.prop.name)
Events.unlink(pValue,this.childData$),this.bound_=!1}},function bindData(data){var self=this
if(!this.bound_&&data&&this.prop){var pValue=data.propertyValue(this.prop.name)
Events.link(pValue,this.childData$),this.prop.validate&&this.X.dynamic3(data,this.prop.validate,function(error){self.view&&(self.view.$.style.border=error?"2px solid red":"")}),this.bound_=!0}},function toString(){return"PropertyView("+this.prop.name+", "+this.view+")"},function destroy(isParentDestroyed){this.unbindData(this.data),this.SUPER(isParentDestroyed)},function construct(){this.bindData(this.data),this.SUPER()},function finishRender(view){view.prop=this.prop,this.SUPER(view)},function addDataChild(child){Events.link(this.childData$,child.data$),this.addChild(child)}]}),CLASS({"package":"foam.ui",name:"AsyncLoadingView",extendsModel:"foam.ui.BaseView",properties:[{name:"id",label:"Element ID",type:"String"},{name:"name",label:"The parent view's name for this"},{name:"model",label:"View model name, model definition, or JSON with a factory_ specified."},{name:"args",label:"View construction arguments",defaultValueFn:function(){return{}}},{name:"copyFrom",label:"Additional arguments to this.copyFrom(...) when ready.",lazyFactory:function(){return{}}},{name:"view",type:"foam.ui.View"}],methods:[function init(){this.SUPER()
var skipKeysArgDecorator=Object.create(this.args)
if(skipKeysArgDecorator.hasOwnProperty=this.skipKeysFn_hasOwnProperty,skipKeysArgDecorator.inner=this.args,this.copyFrom&&this.copyFrom.model&&(skipKeysArgDecorator.model=this.copyFrom.model),this.copyFrom&&this.copyFrom.model_){if("string"==typeof this.copyFrom.model_)return this.requireModelName(this.copyFrom.model_,skipKeysArgDecorator)
if(Model.isInstance(this.copyFrom.model_))return this.finishRender(this.copyFrom.model_.create(skipKeysArgDecorator,this.Y))}return"string"==typeof this.model?this.requireModelName(this.model,skipKeysArgDecorator):this.model.model_&&"string"==typeof this.model.model_?this.requireViewInstance(FOAM(this.model)):this.model.model_?Model.isInstance(this.model)?this.finishRender(this.model.create(skipKeysArgDecorator,this.Y)):(this.mergeWithCopyFrom(this.model),this.finishRender(this.model.model_.create(skipKeysArgDecorator,this.Y))):this.model.factory_?(this.mergeWithCopyFrom(this.model),this.requireModelName(this.model.factory_,skipKeysArgDecorator)):"function"==typeof this.model?this.finishRender(this.model(skipKeysArgDecorator,this.Y)):void console.warn("AsyncLoadingView: View load with invalid model. ",this.model,this.args,this.copyFrom)},function mergeWithCopyFrom(other){for(var key in other)"factory_"!=key&&(this.copyFrom[key]=other[key])},function skipKeysFn_hasOwnProperty(name){return"factory_"!=name&&"model_"!=name&&"view"!=name&&this.inner.hasOwnProperty(name)},function requireViewInstance(view){view.arequire()(function(m){this.finishRender(view)}.bind(this))},function requireModelName(name,args){this.X.arequire(name)(function(m){this.finishRender(m.create(args,this.Y))}.bind(this))},function finishRender(view){if(this.copyFrom){var skipKeysCopyFromDecorator=Object.create(this.copyFrom)
skipKeysCopyFromDecorator.hasOwnProperty=this.skipKeysFn_hasOwnProperty,skipKeysCopyFromDecorator.inner=this.copyFrom,view.copyFrom(skipKeysCopyFromDecorator)}this.view=view.toView_(),this.addDataChild(this.view)
var el=this.X.$(this.id)
el&&(el.outerHTML=this.toHTML(),this.initHTML())},function toHTML(){return this.view?this.view.toHTML():'<div id="'+this.id+'"></div>'},function initHTML(){this.view&&this.view.initHTML()},function toString(){return"AsyncLoadingView("+this.model+", "+this.view+")"},function fromElement(e){return this.view.fromElement(e),this}]}),CLASS({"package":"foam.ui",name:"BaseView",extendsModel:"foam.patterns.ChildTreeTrait",properties:[{name:"data"}],methods:[function addDataChild(child){Events.link(this.data$,child.data$),this.addChild(child)},function addSelfDataChild(child){child.data=this,this.addChild(child)},function toView_(){return this}]}),CLASS({"package":"foam.patterns",name:"ChildTreeTrait",properties:[{name:"parent",type:"foam.patterns.ChildTreeTrait",hidden:!0},{name:"children",type:"Array[foam.patterns.ChildTreeTrait]",factory:function(){return[]}}],methods:[function onAncestryChange_(){Array.prototype.forEach.call(this.children,function(c){c.onAncestryChange_&&c.onAncestryChange_()})},function addChild(child){if(child.parent!==this){child.parent=this,child.onAncestryChange_&&child.onAncestryChange_()
var children=this.children
return children.push(child),this.children=children,this}},function removeChild(child){return child.destroy&&child.destroy(!0),this.children.deleteI(child),child.parent=void 0,this},function removeAllChildren(isParentDestroyed){var list=this.children
this.children=[],Array.prototype.forEach.call(list,function(child){this.removeChild(child)}.bind(this))},function addChildren(){for(var i=0;i<arguments.length;++i)this.addChild(arguments[i])
return this},function destroy(isParentDestroyed){return isParentDestroyed?Array.prototype.forEach.call(this.children,function(child){child.destroy&&child.destroy(!0)}):this.removeAllChildren(),this},function construct(){return this},function deepPublish(topic){var count=this.publish.apply(this,arguments)
if(this.children)for(var i=0;i<this.children.length;i++){var child=this.children[i]
count+=child.deepPublish.apply(child,arguments)}return count}]}),CLASS({"package":"foam.core.types",name:"DocumentInstallProperty",extendsModel:"Property",properties:[{model_:"FunctionProperty",name:"documentInstallFn"}],methods:[function initPropertyAgents(proto,fastInit){this.SUPER(proto,fastInit)
var thisProp=this,DocumentInstallProperty=thisProp.model_
if(proto.addInitAgent(12,": install in document ",function(o,X,Y){var model=o.model_
model&&X.installedModels&&!X.installedModels[model.id]&&thisProp.documentInstallFn.call(proto,X)}),proto.__proto__.model_){var recurse=function(baseProto){var baseProp=baseProto.model_.getProperty(thisProp.name)
baseProp&&(proto.addInitAgent(12,": inherited install in document ",function(o,X,Y){var model=baseProto.model_
model&&X.installedModels&&!X.installedModels[model.id]&&baseProp.documentInstallFn.call(baseProto,X)}),proto.addInitAgent(13,": completed inherited install in document ",function(o,X,Y){X.installedModels[baseProto.model_.id]=!0}),baseProto.__proto__.model_&&recurse(baseProto.__proto__))}
recurse(proto.__proto__)}proto.addInitAgent(13,": completed install in document ",function(o,X,Y){X.installedModels[o.model_.id]=!0})}],help:"Describes a function property that runs once per document"}),CLASS({"package":"foam.ui",name:"DestructiveDataView",extendsModel:"foam.ui.BaseView",requires:["SimpleValue"],properties:[{name:"data",preSet:function(old,nu){return this.shouldDestroy(old,nu)&&this.destroy(),nu},postSet:function(old,nu){this.shouldDestroy(old,nu)&&this.construct()}},{name:"dataLinkedChildren",type:"Array[foam.patterns.ChildTreeTrait]",factory:function(){return[]}}],methods:[function shouldDestroy(old,nu){return!0},function destroy(isParentDestroyed){isParentDestroyed||(this.dataLinkedChildren.forEach(function(child){Events.unfollow(this.data$,child.data$)}.bind(this)),this.dataLinkedChildren=[]),this.SUPER(isParentDestroyed)},function addDataChild(child){Events.follow(this.data$,child.data$),this.dataLinkedChildren.push(child),this.addChild(child)}]}),CLASS({"package":"foam.ui",name:"SlidePanel",extendsModel:"foam.ui.View",requires:["foam.input.touch.GestureTarget"],imports:["clearTimeout","document","gestureManager","setTimeout"],properties:[{name:"side",lazyFactory:function(){return this.LEFT},adapt:function(_,side){return"left"===side?this.LEFT:"right"===side?this.RIGHT:side}},{name:"state",postSet:function(oldState,newState){var layout=this.state.layout.call(this)
oldState!==newState||this.af_?this.desiredLayout=layout:this.currentLayout=layout}},{name:"currentLayout",postSet:function(_,layout){this.panelWidth=Math.max(layout[1],this.minPanelWidth),this.panelX=Math.min(this.parentWidth-this.stripWidth,this.parentWidth-layout[2]),this.mainWidth=Math.max(layout[0],this.panelX)}},{name:"desiredLayout",postSet:function(_,layout){if(!this.currentLayout)return void(this.currentLayout=layout)
var startLayout=this.currentLayout,start=Date.now(),end=start+this.ANIMATION_DELAY,animate=function(){var now=Date.now(),p=(now-start)/(end-start)
if(1>p){var mainWidth=this.currentLayout=[startLayout[0]*(1-p)+layout[0]*p,startLayout[1]*(1-p)+layout[1]*p,startLayout[2]*(1-p)+layout[2]*p]
this.af_&&this.X.cancelAnimationFrame(this.af_),this.af_=this.X.requestAnimationFrame(animate)}else this.currentLayout=layout,this.af_=null}.bind(this)
animate()}},{model_:"ViewFactoryProperty",name:"mainView"},{model_:"ViewFactoryProperty",name:"panelView"},{model_:"IntProperty",name:"minWidth",defaultValueFn:function(){var e=this.main$()
return e?toNum(this.X.window.getComputedStyle(e).width):300}},{model_:"IntProperty",name:"mainWidth",hidden:!0,postSet:function(_,x){this.main$().style.width=x+"px"
var x=this.side.mainX.call(this)
this.main$().style.webkitTransform="translate3d("+x+"px, 0,0)",this.main$().style.MozTransform="translate3d("+x+"px, 0,0)"},help:"Set internally by the resize handler"},{model_:"IntProperty",name:"panelWidth",hidden:!0,postSet:function(_,x){this.panel$().style.width=x+2+"px",this.panelView_&&this.panelView_.onResize&&this.panelView_.onResize()},help:"Set internally by the resize handler"},{model_:"IntProperty",name:"minPanelWidth",defaultValueFn:function(){if(this.panelView&&this.panelView.minWidth)return this.panelView.minWidth+(this.panelView.stripWidth||0)
var e=this.panel$()
return e?toNum(this.X.window.getComputedStyle(e).width):250}},{model_:"IntProperty",name:"parentWidth",lazyFactory:function(){return toNum(this.X.window.getComputedStyle(this.$.parentNode).width)},help:"A pseudoproperty that returns the current width (CSS pixels) of the containing element"},{model_:"IntProperty",name:"stripWidth",help:"The width in (CSS) pixels of the minimal visible strip of panel",defaultValue:30},{model_:"FloatProperty",name:"panelRatio",help:"The ratio (0-1) of the total width occupied by the panel, when the containing element is wide enough for expanded view.",defaultValue:.5},{model_:"IntProperty",name:"panelX",postSet:function(oldX,x){this.currentLayout&&(this.currentLayout[2]=this.parentWidth-x),oldX!==x&&(this.dir_=oldX.compareTo(x)),x=this.side.panelX.call(this,x),this.panel$().style.webkitTransform="translate3d("+x+"px, 0,0)",this.panel$().style.MozTransform="translate3d("+x+"px, 0,0)"}},{name:"dragGesture",hidden:!0,"transient":!0,lazyFactory:function(){return this.GestureTarget.create({containerID:this.id+"-panel",handler:this,gesture:"drag"})}},{name:"tapGesture",hidden:!0,"transient":!0,lazyFactory:function(){return this.GestureTarget.create({containerID:this.id+"-panel",handler:this,gesture:"tap"})}}],constants:[{name:"ANIMATION_DELAY",value:150},{name:"LEFT",value:{panelX:function(x){return this.parentWidth-x-this.panelWidth},invPanelX:function(x){return x-this.parentWidth+this.panelWidth},mainX:function(){return this.parentWidth-this.mainWidth},dragDir:-1}},{name:"RIGHT",value:{panelX:function(x){return x},invPanelX:function(x){return x},mainX:function(){return 0},dragDir:1}},{name:"CLOSED",value:{name:"CLOSED",layout:function(){return[this.parentWidth-this.stripWidth,this.minPanelWidth,this.stripWidth]},onResize:function(){this.parentWidth>this.minWidth+this.minPanelWidth&&(this.state=this.EXPANDED)},toggle:function(){this.open()},open:function(){this.state=this.OPEN},over:!0}},{name:"EXPANDED",value:{name:"EXPANDED",layout:function(){var extraWidth=this.parentWidth-this.minWidth-this.minPanelWidth,panelWidth=this.minPanelWidth+extraWidth*this.panelRatio
return[this.parentWidth-panelWidth,panelWidth,panelWidth]},onResize:function(){this.parentWidth<this.minWidth+this.minPanelWidth&&(this.state=this.CLOSED)}}},{name:"OPEN",value:{name:"OPEN",layout:function(){return[this.parentWidth-this.stripWidth,this.minPanelWidth,this.minPanelWidth]},onResize:function(){this.parentWidth>this.minWidth+this.minPanelWidth&&(this.state=this.OPEN_EXPANDED)},close:function(){this.state=this.CLOSED},toggle:function(){this.close()},over:!0}},{name:"OPEN_EXPANDED",value:{name:"OPEN_EXPANDED",layout:function(){return this.EXPANDED.layout.call(this)},onResize:function(){this.parentWidth<this.minWidth+this.minPanelWidth&&(this.state=this.OPEN)}}}],methods:[function initHTML(){this.CLOSED.onResize.call(this),this.state||(this.state=this.CLOSED),this.gestureManager&&(this.gestureManager.install(this.dragGesture),this.gestureManager.install(this.tapGesture)),this.X.window.addEventListener("resize",this.onResize),this.main$().addEventListener("click",this.onMainFocus),this.main$().addEventListener("DOMFocusIn",this.onMainFocus),this.panel$().addEventListener("DOMFocusIn",this.onPanelFocus),this.initChildren()},function interpolate(state1,state2){var layout1=state1.layout.call(this),layout2=state2.layout.call(this)
return[layout1[0]*this.progress+layout2[0]*(1-this.progress),layout1[1]*this.progress+layout2[1]*(1-this.progress),layout1[2]*this.progress+layout2[2]*(1-this.progress)]},function main$(){return this.X.$(this.id+"-main")},function panel$(){return this.X.$(this.id+"-panel")},function shadow$(){return this.X.$(this.id+"-shadow")},function open(){this.state.open&&this.state.open.call(this)},function close(){this.state.close&&this.state.close.call(this)},function toggle(){this.state.toggle&&this.state.toggle.call(this)}],listeners:[{name:"onPanelFocus",code:function(e){this.open()},isMerged:1},{name:"onMainFocus",code:function(e){this.close()},isMerged:1},{name:"onResize",code:function(e){this.clearProperty("parentWidth"),this.$&&(this.state.onResize.call(this),this.shadow$().style.display=this.state.over?"inline":"none",this.state=this.state)},isFramed:!0},{name:"tapClick",code:function(){this.toggle()}},{name:"dragStart",code:function(point){if(this.state!==this.EXPANDED&&this.state!==this.OPEN_EXPANDED){var self=this,originalX=this.panelX
Events.map(point.x$,this.panelX$,function(x){return x=this.side.invPanelX.call(this,originalX+this.side.dragDir*point.totalX),x<=this.parentWidth-this.panelWidth?this.parentWidth-this.panelWidth:x>=this.parentWidth-this.stripWidth?this.parentWidth-this.stripWidth:x}.bind(this))}}},{name:"dragEnd",code:function(point){var currentLayout=this.currentLayout
this.af_&&this.X.cancelAnimationFrame(this.af_),this.af_=null,this.dir_<0?this.close():this.open()
var layout=this.state.layout.call(this)
this.currentLayout=currentLayout,this.desiredLayout=layout}}],templates:[{name:"CSS",code:ConstantTemplate(".SlidePanel .left-shadow {background:linear-gradient(to left, rgba(0,0,0,0.2) 0%,\nrgba(0,0,0,0) 100%);height:100%;left:-8px;position:absolute;width:8px;}.SlidePanel .right-shadow {background:linear-gradient(to right, rgba(0,0,0,0.2) 0%,\nrgba(0,0,0,0) 100%);height:100%;right:-8px;position:absolute;width:8px;top:0;}"),language:"css"},{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this)
return out('\n      <div id="',self.id,'" style="display: inline-block;position: relative;" class="SlidePanel">\n        <div id="',self.id,'-main" class="main">\n          <div style="width:0;position:absolute;"></div>\n          ',this.mainView({data$:this.data$}),'\n        </div>\n        <div id="',self.id,'-panel" class="panel" style="position: absolute; top: 0; left: -1;">\n          '),this.side===this.RIGHT&&out(' <div id="',self.id,'-shadow" class="left-shadow"></div> '),out("\n          ",this.panelView_=this.panelView({data$:this.data$}),"\n          "),this.side===this.LEFT&&out(' <div id="',self.id,'-shadow" class="right-shadow"></div> '),out("\n        </div>\n      </div>\n    "),out.toString()},language:"html"}],help:'A controller that shows a main view with a small strip of the secondary view visible at the right edge. This "panel" can be dragged by a finger or mouse pointer to any position from its small strip to fully exposed. If the containing view is wide enough, both panels will always be visible.'}),CLASS({"package":"foam.apps.calc",name:"MainButtonsView",extendsModel:"foam.ui.View",requires:["foam.apps.calc.CalcButton"],templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this)
return out('\n      <div id="',self.id,'" class="buttons button-row" style="background:#4b4b4b;">\n        <div class="button-column" style="flex-grow: 3;-webkit-flex-grow: 3;">\n          <div class="button-row">\n            ',self.createTemplateView("7",{tabIndex:101})," ",self.createTemplateView("8",{tabIndex:102})," ",self.createTemplateView("9",{tabIndex:103}),'\n          </div>\n          <div class="button-row">\n            ',self.createTemplateView("4",{tabIndex:104}),"",self.createTemplateView("5",{tabIndex:105}),"",self.createTemplateView("6",{tabIndex:106}),'\n         </div>\n          <div class="button-row">\n            ',self.createTemplateView("1",{tabIndex:107}),"",self.createTemplateView("2",{tabIndex:108}),"",self.createTemplateView("3",{tabIndex:109}),'\n          </div>\n          <div class="button-row">\n            ',self.createTemplateView("point",{tabIndex:111}),"",self.createTemplateView("0",{tabIndex:111}),"",self.createTemplateView("equals",{tabIndex:112}),"\n          </div>\n        </div>\n      "),this.X.registerModel(this.CalcButton.xbind({background:"#777",width:70,height:45,font:"300 26px RobotoDraft"}),"foam.ui.ActionButton"),out('\n        <div class="button-column rhs-ops" style="flex-grow: 1;-webkit-flex-grow: 1;padding-top: 7px; padding-bottom: 10px;">\n          ',self.createTemplateView("ac",{tabIndex:201,font:"300 24px RobotoDraft"}),"\n          ",self.createTemplateView("plus",{tabIndex:202}),"\n          ",self.createTemplateView("minus",{tabIndex:203}),"\n          ",self.createTemplateView("div",{tabIndex:204}),"\n          ",self.createTemplateView("mult",{tabIndex:205}),"\n        </div>\n      </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.apps.calc",name:"CalcButton",extendsModel:"foam.graphics.ActionButtonCView",properties:[{name:"color",defaultValue:"white"},{name:"background",defaultValue:"#4b4b4b"},{name:"width",defaultValue:60},{name:"height",defaultValue:60},{name:"font",defaultValue:"300 28px RobotoDraft"},{name:"role",defaultValue:"button"}],methods:[function init(){this.SUPER(),setTimeout(function(){this.view.paint()}.bind(this),1e3)},function toView_(){var v=this.SUPER()
return v.decorate("toHTML",function(SUPER){return'<div class="button">'+SUPER.call(this)+"</div>"},v.toHTML)}]}),CLASS({"package":"foam.graphics",name:"ActionButtonCView",extendsModel:"foam.graphics.CView",requires:["foam.ui.md.Halo","foam.input.touch.GestureTarget"],imports:["gestureManager"],properties:[{name:"action",postSet:function(oldValue,action){this.bindIsAvailableAndEnabled()}},{name:"font",type:"String",defaultValue:""},{name:"data",postSet:function(){this.bindIsAvailableAndEnabled()}},{name:"label",defaultValue:""},{name:"showLabel",defaultValueFn:function(){return this.action.showLabel}},{name:"iconUrl",defaultValueFn:function(){return this.action.iconUrl},postSet:function(_,v){this.image_&&(this.image_.src=v)}},{name:"haloColor",defaultValue:"rgb(241, 250, 65)"},{name:"halo",factory:function(){return this.Halo.create({alpha:0,r:10,color$:this.haloColor$,isEnabled:function(){return this.action.isEnabled.call(this.data,this.action)}.bind(this)})},postSet:function(old,nu){old&&this.removeChild(old),nu&&this.addChild(nu)}},{name:"iconWidth",type:"int",defaultValue:0},{name:"iconHeight",type:"int",defaultValue:0},{name:"radius",type:"int",defaultValue:0,postSet:function(_,r){r&&(this.width=this.height=2*r)}},{name:"tapGesture",hidden:!0,"transient":!0,lazyFactory:function(){return this.GestureTarget.create({containerID:this.view.id,handler:this,gesture:"tap"})}},{name:"className",defaultValueFn:function(){return"actionButtonCView actionButtonCView-"+this.action.name},help:"CSS class name(s), space separated."},{name:"tooltip",defaultValueFn:function(){return this.action.help}},{name:"speechLabel",defaultValueFn:function(){return this.action.speechLabel}},{name:"tabIndex"},{name:"role"},{name:"state_",defaultValue:"default"}],methods:[function init(){this.SUPER(),this.X.dynamic(function(){this.iconUrl,this.iconWidth,this.iconHeight}.bind(this),function(){this.iconUrl&&(this.image_=new Image,this.image_.onload=function(){this.iconWidth||(this.iconWidth=this.image_.width),this.iconHeight||(this.iconHeight=this.image_.height),this.view.$&&this.view.paint()}.bind(this),this.image_.src=this.iconUrl)}.bind(this))},function bindIsAvailableAndEnabled(){if(this.action&&this.data){var self=this
this.X.dynamic(function(){self.action.isAvailable.call(self.data,self.action),self.action.isEnabled.call(self.data,self.action)},function(){self.action.isAvailable.call(self.data,self.action)?self.oldWidth_&&self.oldHeight_&&(self.x=self.oldX_,self.y=self.oldY_,self.width=self.oldWidth_,self.height=self.oldHeight_):(self.width||self.height)&&(self.oldX_=self.x,self.oldY_=self.y,self.oldWidth_=self.width,self.oldHeight_=self.height,self.width=0,self.height=0,self.x=0,self.y=0),self.action.isEnabled.call(self.data,self.action)?self.alpha=1:self.alpha=.5,self.view&&self.view.paint()})}},function initCView(){this.gestureManager&&this.gestureManager.install(this.tapGesture),this.$.addEventListener("keypress",function(e){32!=e.charCode||e.altKey||e.ctrlKey||e.shiftKey||(e.preventDefault(),e.stopPropagation(),this.tapClick())}.bind(this)),this.$.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),(e.x||e.y)&&this.gestureManager||this.tapClick()}.bind(this))},function destroy(isParentDestroyed){this.SUPER(isParentDestroyed),this.gestureManager&&this.gestureManager.uninstall(this.tapGesture)},function erase(){var c=this.canvas
c.clearRect(0,0,this.width,this.height)
var r=Math.min(this.width,this.height)/2
c.fillStyle=this.background,c.beginPath(),c.arc(this.width/2,this.height/2,r,0,2*Math.PI,!0),c.closePath(),c.fill()},function paintSelf(){var c=this.canvas
this.font&&(c.font=this.font),c.globalAlpha=this.alpha,c.textAlign="center",c.textBaseline="middle",c.fillStyle=this.color,this.image_&&this.image_.complete?c.drawImage(this.image_,this.x+(this.width-this.iconWidth)/2,this.y+(this.height-this.iconHeight)/2,this.iconWidth,this.iconHeight):c.fillText(this.label||this.action.labelFn.call(this.data,this.action),this.x+this.width/2,this.y+this.height/2)}],listeners:[{name:"tapClick",code:function(){this.action.maybeCall(this.X,this.data)}}]}),CLASS({"package":"foam.ui.md",name:"Halo",extendsModel:"foam.graphics.Circle",properties:[{name:"style",defaultValue:"solid",postSet:function(_,style){style!==this.RING_INNER_COLOR&&this.setColorAndBorder()}},{name:"state_",defaultValue:"default"},{name:"nextColor_",defaultValueFn:function(){return this.color}},{name:"color",preSet:function(old,nu){return"default"!==this.state_?(this.nextColor_=nu,old):nu}},{name:"easeInTime",defaultValue:200},{name:"easeOutTime",defaultValue:150},{name:"startAlpha",defaultValue:.8},{name:"pressedAlpha",defaultValue:.4},{name:"finishAlpha",defaultValue:0},{name:"alpha",defaultValue:0},{name:"recentering",defaultValue:!0},{model_:"FunctionProperty",name:"isEnabled",defaultValue:function(){return!0}}],methods:[function setColorAndBorder(){if("ring"===this.style){var color=this.color
this.border=color,this.borderWidth=12,this.color=this.RING_INNER_COLOR}},function initCView(){this.$.addEventListener("mousedown",this.onMouseDown),this.$.addEventListener("mouseup",this.onMouseUp),this.$.addEventListener("mouseleave",this.onMouseUp),this.$.addEventListener("touchstart",this.onMouseDown),this.$.addEventListener("touchend",this.onMouseUp),this.$.addEventListener("touchleave",this.onMouseUp),this.$.addEventListener("touchcancel",this.onMouseUp)},function isTouchInRect(t,rect){return t.clientX>=rect.left&&t.clientX<=rect.right&&t.clientY>=rect.top&&t.clientY<=rect.bottom}],listeners:[{name:"onMouseDown",code:function(evt){if("default"===this.state_&&this.isEnabled()){if(this.state_="pressing","touchstart"===evt.type){for(var rect=this.$.getBoundingClientRect(),touchFound=!1,t,i=0;i<evt.touches.length;++i)if(t=evt.touches[i],this.isTouchInRect(t,rect)){touchFound=!0
break}touchFound?(this.x=t.clientX-rect.left,this.y=t.clientY-rect.top):(console.warn("No touches",evt.touches,"in element rect",rect),this.x=rect.width/2,this.y=rect.height/2)}else this.x=evt.offsetX,this.y=evt.offsetY
this.r=2,this.alpha=this.startAlpha
var recentering=this.recentering
this.X.animate(this.easeInTime,function(){recentering?(this.x=this.parent.width/2,this.y=this.parent.height/2,this.r=Math.min(28,Math.min(this.$.clientWidth,this.parent.height)/2)):this.r=Math.max(28,Math.max(this.$.clientWidth,this.parent.height)),this.alpha=this.pressedAlpha}.bind(this),void 0,function(){"cancelled"===this.state_?(this.state_="pressed",this.onMouseUp()):this.state_="pressed"}.bind(this))()}}},{name:"onMouseUp",code:function(evt){return"default"!==this.state_?"pressing"===this.state_?void(this.state_="cancelled"):void("cancelled"!==this.state_&&(this.state_="released",this.X.animate(this.easeOutTime,function(){this.alpha=this.finishAlpha}.bind(this),Movement.easeIn(.5),function(){"released"===this.state_&&(this.state_="default",this.color=this.nextColor_)}.bind(this))())):void 0}}]}),CLASS({"package":"foam.graphics",name:"Circle",extendsModel:"foam.graphics.CView",properties:[{name:"border",label:"Border Color",type:"String",defaultValue:""},{name:"borderWidth",type:"int",defaultValue:1},{name:"r",label:"Radius",type:"int",defaultValue:20},{name:"startAngle",defaultValue:0},{name:"endAngle",defaultValue:6.283185307179586},{name:"width",defaultValueFn:function(){return 2*this.r}},{name:"height",defaultValueFn:function(){return 2*this.r}}],methods:[function paintSelf(){var c=this.canvas
c&&this.r&&(this.color&&(c.beginPath(),c.moveTo(0,0),c.arc(0,0,this.r,-this.endAngle,-this.startAngle,!1),c.closePath(),c.fillStyle=this.color,c.fill()),this.paintBorder())},function paintBorder(){if(this.border){var c=this.canvas
c.lineWidth=this.borderWidth,c.beginPath(),c.arc(0,0,this.r+this.borderWidth/2-1,-this.endAngle,-this.startAngle,!1),c.closePath(),c.strokeStyle=this.border,c.stroke()}},function intersects(c){var r=this.r+c.r
return this.border&&(r+=this.borderWidth),c.border&&(r+=c.borderWidth),Movement.distance(this.x-c.x,this.y-c.y)<r}]}),CLASS({"package":"foam.graphics",name:"CView",label:"CView",traits:["foam.patterns.ChildTreeTrait"],requires:["foam.graphics.PositionedCViewView","foam.graphics.CViewView"],properties:[{name:"view",type:"Canvas2",hidden:!0,"transient":!0,postSet:function(_,view){for(var key in this.children){var child=this.children[key]
child.view=view,view&&child.addListener(view.paint)}}},{name:"children",hidden:!0},{name:"canvas",hidden:!0,"transient":!0,getter:function(){return this.view&&this.view.canvas}},{name:"$",hidden:!0,"transient":!0,getter:function(){return this.view&&this.view.$}},{name:"state",defaultValue:"initial"},{model_:"BooleanProperty",name:"suspended",defaultValue:!1},{name:"className",defaultValue:"",postSet:function(){this.$&&(this.$.className=this.className)},help:"CSS class name(s), space separated. Used if adapted with a CViewView."},{model_:"FloatProperty",name:"x",defaultValue:0},{model_:"FloatProperty",name:"y",defaultValue:0},{model_:"FloatProperty",name:"a",label:"Rotation",defaultValue:0},{model_:"FloatProperty",name:"scaleX",defaultValue:1},{model_:"FloatProperty",name:"scaleY",defaultValue:1},{name:"canvasX",hidden:!0,getter:function(){return this.x+(this.parent?this.parent.canvasX:0)}},{name:"canvasY",hidden:!0,getter:function(){return this.y+(this.parent?this.parent.canvasY:0)}},{model_:"IntProperty",name:"width",defaultValue:10},{model_:"IntProperty",name:"height",defaultValue:10},{model_:"FloatProperty",name:"alpha",defaultValue:1},{name:"color",label:"Foreground Color",type:"String",defaultValue:"black"},{name:"background",label:"Background Color",type:"String",defaultValue:"white"},{name:"font"},{model_:"BooleanProperty",name:"clipped",defaultValue:!1}],methods:[function toView_(){if(!this.view){var params={cview:this}
this.className&&(params.className=this.className),this.tooltip&&(params.tooltip=this.tooltip),this.speechLabel&&(params.speechLabel=this.speechLabel),this.tabIndex&&(params.tabIndex=this.tabIndex),this.role&&(params.role=this.role),this.data$&&(params.data$=this.data$),this.view=this.CViewView.create(params)}return this.view},function toGLView_(){var model=this.X.lookup("foam.graphics.webgl.CViewGLView")
return model?model.create({sourceView:this}):""},function toPositionedView_(){if(!this.view){var params={cview:this}
this.className&&(params.className=this.className),this.view=this.PositionedCViewView.create(params)}return this.view},function initCView(){},function write(opt_X){var X=opt_X||this.X
X.writeView(this.toView_(),X)},function addChild(child){return this.SUPER(child),this.view&&(child.view=this.view,child.addListener(this.view.paint),this.view.paint()),this},function removeChild(child){return this.SUPER(child),child.view=void 0,this.view&&(child.removeListener(this.view.paint),this.view.paint()),this},function removeAllChildren(child){for(var i=this.children.length-1;i>=0;i--)this.removeChild(this.children[i])
return this},function findChildAt(x,y){for(var c2={x:x,y:y,r:1},cs=this.children,i=cs.length-1;i>=0;i--){var c1=cs[i]
if(c1.intersects&&c1.intersects(c2))return c1}},function erase(){this.canvas.fillStyle=this.background,this.canvas.fillRect(0,0,this.width,this.height)},function paintChildren(){for(var i=0;i<this.children.length;i++){var child=this.children[i]
this.canvas.save(),this.canvas.beginPath(),child.paint(),this.canvas.restore()}},function paintSelf(){},function paint(){if(this.$&&this.width&&this.height&&("initial"===this.state&&(this.state="active",this.initCView()),!this.suspended)){var c=this.canvas
c.save(),c.globalAlpha*=this.alpha,this.transform(),this.clipped&&(c.rect(0,0,this.width,this.height),c.clip()),this.paintSelf(),this.paintChildren(),c.restore()}},function transform(){this.canvas.translate(this.x,this.y),this.canvas.scale(this.scaleX,this.scaleY),this.a&&this.canvas.rotate(this.a)},function scale(s){this.scaleX=this.scaleY=s},function mapToParent(point){return point.x+=this.x,point.y+=this.y,point},function mapToCanvas(point){return this.mapToParent(point),this.parent&&this.parent.mapToCanvas&&this.parent.mapToCanvas(point),point},function destroy(){}]}),CLASS({"package":"foam.graphics",name:"PositionedCViewView",extendsModel:"foam.graphics.AbstractCViewView",traits:["foam.ui.layout.PositionedDOMViewTrait"],properties:[{name:"tagName",factory:function(){return"canvas"}}],methods:[function init(){this.SUPER(),this.X.dynamic(function(){this.cview,this.width,this.height}.bind(this),function(){this.cview&&(this.cview.width=this.width,this.cview.height=this.height)}.bind(this))},function toHTML(){var className=this.className?' class="'+this.className+'"':""
return'<canvas id="'+this.id+'"'+className+' width="'+this.canvasWidth()+'" height="'+this.canvasHeight()+'" '+this.layoutStyle()+"></canvas>"}],listeners:[{name:"resize",code:function(){this.$&&(this.$.width=this.canvasWidth(),this.$.style.width=this.styleWidth(),this.$.height=this.canvasHeight(),this.$.style.height=this.styleHeight(),this.cview.width=this.width,this.cview.height=this.height,this.paint())},isFramed:!0}]}),CLASS({"package":"foam.ui.layout",name:"PositionedDOMViewTrait",traits:["foam.ui.layout.PositionedViewTrait"],properties:[{name:"tagName",defaultValue:"div"}],methods:[function toHTML(){return"<"+this.tagName+' id="'+this.id+'"'+this.layoutStyle()+this.cssClassAttr()+">"+this.toInnerHTML()+"</div>"},function layoutStyle(){return' style="-webkit-transform:'+this.transform()+";width:"+this.styleWidth()+";height:"+this.styleHeight()+';position:absolute;"'},function initHTML(){this.SUPER()
var self=this
this.X.dynamic(function(){self.x,self.y,self.z},this.position),this.X.dynamic(function(){self.width,self.height},this.resize),this.$.style.position="absolute",this.position(),this.resize()},function transform(){return"translate3d("+this.x+"px,"+this.y+"px,"+this.z+"px)"},function styleWidth(){return this.width+"px"},function styleHeight(){return this.height+"px"}],listeners:[{name:"position",code:function(){this.$&&(this.$.style.webkitTransform=this.transform())}},{name:"resize",code:function(){this.$&&(this.$.style.width=this.styleWidth(),this.$.style.height=this.styleHeight())}}]}),CLASS({"package":"foam.ui.layout",name:"PositionedViewTrait",properties:[{model_:"FloatProperty",name:"x",units:"px",defaultValue:0},{model_:"FloatProperty",name:"y",units:"px",defaultValue:0},{model_:"FloatProperty",name:"z",units:"px",defaultValue:0},{model_:"IntProperty",name:"width",units:"px",defaultValue:100},{model_:"IntProperty",name:"height",units:"px",defaultValue:100},{model_:"IntProperty",name:"preferredWidth",units:"px",defaultValue:100},{model_:"IntProperty",name:"preferredHeight",units:"px",defaultValue:100}]}),CLASS({"package":"foam.graphics",name:"AbstractCViewView",extendsModel:"foam.ui.View",properties:[{name:"cview",type:"foam.graphics.CView",postSet:function(_,cview){cview.view=this,this.width=cview.x+cview.width,this.height=cview.y+cview.height}},{name:"className",defaultValue:"",help:"CSS class name(s), space separated."},{model_:"FloatProperty",name:"scalingRatio",preSet:function(_,v){return 0>=v?1:v},defaultValue:1},{name:"speechLabel"},{name:"role"},{name:"tabIndex"},{model_:"IntProperty",name:"width",defaultValue:100},{model_:"IntProperty",name:"height",defaultValue:100},{name:"canvas",getter:function(){return this.instance_.canvas?this.instance_.canvas:this.instance_.canvas=this.$&&this.$.getContext("2d")}},{name:"gl",getter:function(){return null}}],methods:[function init(){this.SUPER(),this.X.dynamic(function(){this.scalingRatio,this.width,this.height}.bind(this),this.resize)},function styleWidth(){return this.width+"px"},function canvasWidth(){return this.width*this.scalingRatio},function styleHeight(){return this.height+"px"},function canvasHeight(){return this.height*this.scalingRatio},function toString(){return"CViewView("+this.cview+")"},function toHTML(){var className=this.className?' class="'+this.className+'"':"",title=this.speechLabel?' aria-role="button" aria-label="'+this.speechLabel+'"':"",tabIndex=this.tabIndex?' tabindex="'+this.tabIndex+'"':"",role=this.role?' role="'+this.role+'"':""
return'<canvas id="'+this.id+'"'+className+title+tabIndex+role+' width="'+this.canvasWidth()+'" height="'+this.canvasHeight()+'" style="width:'+this.styleWidth()+";height:"+this.styleHeight()+";min-width:"+this.styleWidth()+";min-height:"+this.styleHeight()+'"></canvas>'},function initHTML(){if(this.$){this.maybeInitTooltip(),this.canvas=this.$.getContext("2d")
var devicePixelRatio=this.X.window.devicePixelRatio||1,backingStoreRatio=this.canvas.backingStoreRatio||this.canvas.webkitBackingStorePixelRatio||1
devicePixelRatio!==backingStoreRatio&&(this.scalingRatio=devicePixelRatio/backingStoreRatio)
var style=this.X.window.getComputedStyle(this.$)
style.backgroundColor&&!this.cview.hasOwnProperty("background")&&(this.cview.background=style.backgroundColor),this.paint()}},function destroy(isParentDestroyed){this.SUPER(isParentDestroyed)}],listeners:[{name:"resize",code:function(){this.$&&(this.$.width=this.canvasWidth(),this.$.style.width=this.styleWidth(),this.$.style.minWidth=this.styleWidth(),this.$.height=this.canvasHeight(),this.$.style.height=this.styleHeight(),this.$.style.minHeight=this.styleHeight(),this.paint())},isFramed:!0},{name:"paint",code:function(){if(!this.$)throw EventService.UNSUBSCRIBE_EXCEPTION
this.canvas.save(),this.canvas.clearRect(0,0,this.canvasWidth(),this.canvasHeight()),this.canvas.fillStyle=this.cview.background,this.canvas.fillRect(0,0,this.canvasWidth(),this.canvasHeight()),this.canvas.scale(this.scalingRatio,this.scalingRatio),this.cview.paint(),this.canvas.restore()},isFramed:!0}]}),CLASS({"package":"foam.graphics",name:"CViewView",extendsModel:"foam.graphics.AbstractCViewView",properties:[{name:"cview",postSet:function(_,cview){cview.view=this,this.X.dynamic(function(){var w=cview.x+cview.width,h=cview.y+cview.height
this.width=w?Math.max(this.width,w):0,this.height=h?Math.max(this.height,h):0}.bind(this))}}],methods:[function shouldDestroy(){return!1},function destroy(){this.SUPER(),this.cview&&this.cview.destroy()}],help:"DOM wrapper for a CView, auto adjusts it size to fit the given cview."}),CLASS({"package":"foam.apps.calc",name:"SecondaryButtonsView",extendsModel:"foam.ui.View",requires:["foam.apps.calc.CalcButton"],templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this)
return out("\n          "),this.X.registerModel(this.CalcButton.xbind({background:"rgb(52, 153, 128)",width:61,height:61,font:"300 20px RobotoDraft"}),"foam.ui.ActionButton"),out('\n          <div id="',self.id,'" class="buttons button-row secondaryButtons">\n            <div class="button-column" style="flex-grow: 1;-webkit-flex-grow: 1;">\n              <div class="button-row">\n                ',self.createTemplateView("backspace",{tabIndex:311,label:""}),"\n                ",self.createTemplateView("round",{tabIndex:312}),"\n                ",self.createTemplateView("fetch",{tabIndex:313}),"\n                ",self.createTemplateView("store",{tabIndex:314}),'\n              </div>\n              <div class="button-row">\n                ',self.createTemplateView("e",{tabIndex:321}),"\n                ",self.createTemplateView("ln",{tabIndex:322}),"\n                ",self.createTemplateView("log",{tabIndex:323}),"\n                ",self.createTemplateView("exp",{tabIndex:324}),'\n              </div>\n              <div class="button-row">\n                ',self.createTemplateView("inv",{tabIndex:331}),"\n                ",self.createTemplateView("pow",{tabIndex:332}),"\n                ",self.createTemplateView("sqroot",{tabIndex:333}),"\n                ",self.createTemplateView("root",{tabIndex:334}),'\n              </div>\n              <div class="button-row">\n                ',self.createTemplateView("sign",{tabIndex:341}),"\n                ",self.createTemplateView("percent",{tabIndex:342}),"\n                ",self.createTemplateView("square",{tabIndex:343}),"\n                ",self.createTemplateView("pi",{tabIndex:344}),"\n              </div>\n            </div>\n          </div>\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.apps.calc",name:"TertiaryButtonsView",extendsModel:"foam.ui.View",requires:["foam.apps.calc.CalcButton"],templates:[{name:"toHTML",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this)
out("\n          "),this.X.registerModel(this.CalcButton.xbind({width:61,height:61,color:"rgb(80, 80, 80)",background:"rgb(29, 233, 182)",font:"300 18px RobotoDraft"}),"foam.ui.ActionButton"),out('\n          <div id="',self.id,'" class="buttons button-row tertiaryButtons">\n            <div class="button-column" style="flex-grow: 1;-webkit-flex-grow: 1;">\n              <div class="button-row">\n                ',self.createTemplateView("deg",{tabIndex:411})," ",self.createTemplateView("rad",{tabIndex:412})," ",self.createTemplateView("fact",{tabIndex:413}),'\n              </div>\n              <div class="button-row">\n                ',self.createTemplateView("sin",{tabIndex:421})," ",self.createTemplateView("asin",{tabIndex:422})," ",self.createTemplateView("mod",{tabIndex:423}),'\n              </div>\n              <div class="button-row">\n                ',self.createTemplateView("cos",{tabIndex:431})," ",self.createTemplateView("acos",{tabIndex:432})," ",self.createTemplateView("p",{tabIndex:433}),'\n              </div>\n              <div class="button-row">\n                ',self.createTemplateView("tan",{tabIndex:441})," ",self.createTemplateView("atan",{tabIndex:442})," ",self.createTemplateView("c",{tabIndex:443}),"\n              </div>\n            </div>\n          </div>\n          ")
var l=function(_,_,_,degrees){this.degView.view&&(this.degView.view.paint(),this.radView.view.paint()),this.degView.font=degrees?"600 18px RobotoDraft":"300 18px RobotoDraft",this.radView.font=degrees?"300 18px RobotoDraft":"600 18px RobotoDraft"}.bind(this)
return this.data.degreesMode$.addListener(l),l(),out("\n    "),out.toString()},language:"html"}]}),CLASS({"package":"foam.apps.calc",name:"CalcSpeechView",extendsModel:"foam.ui.View",properties:[{name:"calc"},{name:"lastSaid"}],actions:[{name:"repeat",code:function(){this.say(this.lastSaid)},keyboardShortcuts:["r"]},{name:"sayState",code:function(){var last=this.calc.history[this.calc.history.length-1]
if(last){var unary=last&&last.op.unary
this.calc.op!==DEFAULT_OP?this.say(unary?this.calc.a2+" "+last.op.speechLabel:last.a2+" "+this.calc.op.speechLabel+" "+this.calc.a2):this.say(unary?last.a2+" "+last.op.speechLabel+" "+Calc.EQUALS.speechLabel+" "+this.calc.a2:last.op!==DEFAULT_OP?this.calc.history[this.calc.history.length-2].a2+" "+last.op.speechLabel+" "+last.a2+" "+Calc.EQUALS.speechLabel+" "+this.calc.a2:this.calc.a2)}else this.say(this.calc.a2)},keyboardShortcuts:["s"]},{name:"sayModeState",code:function(){this.say(this.calc.degreesMode?"degrees":"radians")},keyboardShortcuts:["t"]}],methods:[function say(msg){this.lastSaid=msg
var e=document.createTextNode(" "+msg+" ")
e.id=this.nextID(),this.$.appendChild(e),setTimeout(Movement.whenIdle(function(){e.remove()}),15e3)},function toHTML(){return'<output id="'+this.id+'" style="position:absolute;left:-1000000;" aria-live="polite"></output>'},function initHTML(){this.SUPER(),this.calc.subscribe(["action"],this.onAction)}],listeners:[{name:"onAction",code:function(calc,topic,action){var last=this.calc.history[this.calc.history.length-1],unary=last&&last.op.unary
this.say("equals"===action.name?action.speechLabel+" "+this.calc.a2:unary?action.speechLabel+" "+Calc.EQUALS.speechLabel+" "+this.calc.a2:action.speechLabel)},whenIdle:!0}]}),CLASS({"package":"foam.apps.calc",name:"Fonts",traits:["foam.ui.CSSLoaderTrait"],constants:[{name:"CSS_",value:"\n@font-face {\n  font-family: 'RobotoDraft';\n  font-style: normal;\n  font-weight: 300;\n  src: url('data:font/woff2;base64,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') format('woff2');\n  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;\n}\n"}],templates:[{name:"CSS",code:function(opt_out){var self=this,X=this.X,Y=this.Y,out=opt_out?opt_out:TOC(this)
return out("",this.CSS_,""),X.foam.grammars.CSS3.create().parser.parseString(out.toString()).toString()},language:"css"}]}),CLASS({"package":"foam.ui",name:"CSSLoaderTrait",properties:[{model_:"foam.core.types.DocumentInstallProperty",name:"installCSS",documentInstallFn:function(X){for(var i=0;i<this.model_.templates.length;i++){var t=this.model_.templates[i]
if("CSS"===t.name)return void t.futureTemplate(function(){X.addStyle(this.CSS())}.bind(this))}}}]}),CLASS({"package":"foam.apps.calc",name:"NumberFormatter",properties:[{model_:"BooleanProperty",name:"useComma"}],messages:[{model_:"Message",name:"nan",value:"Not a number",translationHint:"description of a value that isn't a number"}],methods:[function init(){if(window.chrome&&chrome.i18n)chrome.i18n.getAcceptLanguages(function(m){this.useComma=","==.5.toLocaleString(m[0]).substring(1,2)}.bind(this))
else{var lang=window.navigator.languages?window.navigator.languages[0]:window.navigator.language
this.useComma=","==.5.toLocaleString(lang).substring(1,2)}},function formatNumber(n){return"string"==typeof n?n:Number.isNaN(n)?this.nan:Number.isFinite(n)?parseFloat(n).toPrecision(12).replace(/(?:(\d+\.\d*[1-9])|(\d+)(?:\.))(?:(?:0+)$|(?:0*)(e.*)$|$)/,"$1$2$3"):""},function i18nNumber(n){return this.useComma?n.replace(/\./g,","):n}]}),CLASS({"package":"foam.ui.animated",name:"Label",extendsModel:"foam.ui.SimpleView",imports:["window"],properties:[{name:"data"},{name:"className",defaultValue:"alabel"},{name:"left",postSet:function(_,l){this.$.querySelector(".f1").style.left=l}}],methods:[function toInnerHTML(){var tabIndex=this.tabIndex?' tabindex="'+this.tabIndex+'"':""
return"<div"+tabIndex+' class="f1"></div><div class="f2"></div>'},function initHTML(){this.data$.addListener(this.onDataChange),this.window.addEventListener("resize",this.onResize)}],listeners:[{name:"onDataChange",code:function(_,_,oldValue,newValue){if(this.$){var f1$=this.$.querySelector(".f1"),f2$=this.$.querySelector(".f2"),data=this.data||"&nbsp;"
f1$.innerHTML=data,f2$.innerHTML=data,f1$.style.left=f2$.offsetLeft
var animate=this.data.length&&(oldValue.startsWith(newValue)||newValue.startsWith(oldValue))
DOM.setClass(this.$.querySelector(".f1"),"animated",animate)}},isFramed:!0},{name:"onResize",code:function(){this.$&&(DOM.setClass(this.$.querySelector(".f1"),"animated",!1),this.onDataChange())},isFramed:!0}],templates:[{name:"CSS",code:ConstantTemplate(".f1 {position:absolute;white-space:nowrap;}.f1.animated {transition:left .2s;}.f2 {display:inline;float:right;visibility:hidden;white-space:nowrap;}"),language:"css"}]}),CLASS({"package":"foam.ui",name:"SimpleView",extendsModel:"foam.ui.BaseView",traits:["foam.ui.HTMLViewTrait"],requires:["Property"],exports:["propertyViewProperty"],properties:[{name:"propertyViewProperty",type:"Property",defaultValueFn:function(){return this.Property.DETAIL_VIEW}}]}),CLASS({"package":"foam.apps.calc",name:"History",requires:["foam.apps.calc.NumberFormatter"],properties:[{name:"numberFormatter"},{name:"op"},{name:"a2",preSet:function(_,n){return this.formatNumber(n)}}],methods:[function formatNumber(n){var nu=this.numberFormatter.formatNumber(n)||"0"
return nu=nu.replace(/(.+?)(?:\.$|$)/,"$1"),this.numberFormatter.i18nNumber(nu)}]}),CLASS({"package":"foam.input.touch",name:"GestureManager",requires:["foam.input.touch.DragGesture","foam.input.touch.Gesture","foam.input.touch.GestureTarget","foam.input.touch.PinchTwistGesture","foam.input.touch.ScrollGesture","foam.input.touch.TapGesture","foam.input.touch.InputPoint"],imports:["document","touchManager"],properties:[{name:"gestures",factory:function(){return{verticalScroll:this.ScrollGesture.create(),verticalScrollMomentum:this.ScrollGesture.create({momentumEnabled:!0}),verticalScrollNative:this.ScrollGesture.create({nativeScrolling:!0}),horizontalScroll:this.ScrollGesture.create({direction:"horizontal"}),horizontalScrollMomentum:this.ScrollGesture.create({direction:"horizontal",momentumEnabled:!0}),horizontalScrollNative:this.ScrollGesture.create({direction:"horizontal",nativeScrolling:!0}),tap:this.TapGesture.create(),drag:this.DragGesture.create(),pinchTwist:this.PinchTwistGesture.create()}}},{name:"targets",factory:function(){return{}}},{name:"active",factory:function(){return{}},help:"Gestures that are active right now and should be checked for recognition. This is the gestures active on the FIRST touch. Rectangles are not checked for subsequent touches."},{name:"recognized",help:"Set to the recognized gesture. Cleared when all points are lifted."},{name:"points",factory:function(){return{}}},{name:"wheelTimer"},{name:"scrollWheelTimeout",defaultValue:300},{name:"scrollViewTargets",defaultValue:0}],methods:[function init(){this.SUPER(),this.touchManager.subscribe(this.touchManager.TOUCH_START,this.onTouchStart),this.touchManager.subscribe(this.touchManager.TOUCH_MOVE,this.onTouchMove),this.touchManager.subscribe(this.touchManager.TOUCH_END,this.onTouchEnd),this.document.addEventListener("mousedown",this.onMouseDown),this.document.addEventListener("mousemove",this.onMouseMove),this.document.addEventListener("mouseup",this.onMouseUp),this.document.addEventListener("wheel",this.onWheel),this.document.addEventListener("contextmenu",this.onContextMenu)},function install(target){target.containerID?(this.targets[target.containerID]||(this.targets[target.containerID]=[]),this.targets[target.containerID].push(target)):console.warn("no container ID on touch target")},function uninstall(target){var arr=this.targets[target.containerID]
if(arr){for(var i=0;i<arr.length;i++)if(arr[i]===target){arr.splice(i,1)
break}0===arr.length&&delete this.targets[target.containerID]}},function purge(){for(var keys=Object.keys(this.targets),count=0,i=0;i<keys.length;i++)this.document.getElementById(keys[i])||(delete this.targets[keys[i]],count++)
return console.log("Purged "+count+" targets"),count},function activateContainingGestures(x,y,opt_predicate){for(var e=this.X.document.elementFromPoint(x,y);e;){if(e.id){var matches=this.targets[e.id]
if(matches&&matches.length)for(var i=0;i<matches.length;i++){var t=matches[i],g=this.gestures[t.gesture]
!g||opt_predicate&&!opt_predicate(g)||(this.active[g.name]||(this.active[g.name]=[]),this.active[g.name].push(t))}}e=e.parentNode}},function checkRecognition(){if(!this.recognized){var self=this,matches=[]
if(Object.keys(this.active).forEach(function(name){var answer=self.gestures[name].recognize(self.points)
answer>=self.Gesture.WAIT?matches.push([name,answer]):delete self.active[name]}),0!==matches.length){var i,lastYes=-1
for(i=0;i<matches.length;i++)matches[i][1]===this.Gesture.YES&&(lastYes=i)
var lastMaybe=-1
for(i=0;i<matches.length;i++)matches[i][1]===this.Gesture.MAYBE&&(lastMaybe=i)
var match
if(0>lastYes){if(matches.length>1||0>lastMaybe)return
match=matches[lastMaybe][0]}else match=matches[lastYes][0]
var matched=this.active[match].filter(function(m){if(!m.enforceContainment)return!0
for(var r=m.getElement().getBoundingClientRect(),keys=Object.keys(self.points),i=0;i<keys.length;++i){var p=self.points[keys[i]]
if(p.x<r.left||p.x>r.right||p.y<r.top||p.y>r.bottom)return!1}return!0}),legal=[]
for(i=0;i<matched.length;i++){for(var m=matched[i].getElement(),contained=0,j=0;j<matched.length;j++){var n=matched[j].getElement()
m!==n&&m.contains(n)&&contained++}0===contained&&legal.push(matched[i].handler)}legal.length>0&&this.gestures[match].attach(this.points,legal),this.recognized=this.gestures[match]}}},function resetState(){this.active={},this.recognized=null,this.points={}}],listeners:[{name:"onTouchStart",code:function(_,__,touch){if(this.recognized)return void(this.recognized.addPoint&&this.recognized.addPoint(touch))
var pointCount=Object.keys(this.points).length
pointCount||this.activateContainingGestures(touch.x,touch.y),this.points[touch.id]=touch,this.checkRecognition()}},{name:"onMouseDown",code:function(event){var point=this.InputPoint.create({id:"mouse",type:"mouse",x:event.clientX,y:event.clientY})
if(this.recognized)return void(this.recognized.addPoint&&this.recognized.addPoint(point))
var pointCount=Object.keys(this.points).length
pointCount||this.activateContainingGestures(point.x,point.y),this.points[point.id]=point,this.checkRecognition()}},{name:"onTouchMove",code:function(_,__,touch){this.recognized||this.checkRecognition()}},{name:"onMouseMove",code:function(event){this.points.mouse&&(this.points.mouse.x=event.clientX,this.points.mouse.y=event.clientY,this.checkRecognition())}},{name:"onTouchEnd",code:function(_,__,touch){this.recognized||this.checkRecognition(),delete this.points[touch.id],this.active={},this.recognized=void 0}},{name:"onMouseUp",code:function(event){this.points.mouse&&(this.points.mouse.x=event.clientX,this.points.mouse.y=event.clientY,this.points.mouse.done=!0,this.recognized||this.checkRecognition(),delete this.points.mouse,this.active={},this.recognized=void 0)}},{name:"onWheel",code:function(event){if(this.wheelTimer)this.points.wheel.x-=event.deltaX,this.points.wheel.y-=event.deltaY,this.X.window.clearTimeout(this.wheelTimer),this.wheelTimer=this.X.window.setTimeout(this.onWheelDone,this.scrollWheelTimeout)
else{if(this.recognized||Object.keys(this.points).length>0)return
var wheel=this.InputPoint.create({id:"wheel",type:"wheel",x:event.clientX,y:event.clientY}),dir=Math.abs(event.deltaX)>Math.abs(event.deltaY)?"horizontal":"vertical",gestures=[dir+"Scroll",dir+"ScrollMomentum",dir+"ScrollNative"]
this.activateContainingGestures(wheel.x,wheel.y,function(g){return gestures.indexOf(g.name)>=0}),wheel.x-=event.deltaX,wheel.y-=event.deltaY
for(var i=0;i<gestures.length;i++){var gesture=gestures[i]
if(this.active[gesture]&&this.active[gesture].length){this.points.wheel||(this.points.wheel=wheel),this.gestures[gesture].attach(this.points,this.active[gesture].map(function(gt){return gt.handler})),this.recognized=this.gestures[gesture],this.wheelTimer=this.X.window.setTimeout(this.onWheelDone,this.scrollWheelTimeout)
break}}}}},{name:"onWheelDone",code:function(){this.wheelTimer=void 0,this.points.wheel.done=!0,delete this.points.wheel,this.recognized=void 0}},{name:"onContextMenu",code:function(){this.resetState()}}]}),CLASS({"package":"foam.input.touch",name:"DragGesture",extendsModel:"foam.input.touch.Gesture",properties:[{name:"name",defaultValue:"drag"}],constants:[{name:"DRAG_TOLERANCE",value:20}],methods:[function recognize(map){var keys=Object.keys(map)
if(keys.length>1)return this.NO
var point=map[keys[0]]
if(point.done)return this.NO
var delta=Math.max(Math.abs(point.totalX),Math.abs(point.totalY)),r=delta>=this.DRAG_TOLERANCE?this.YES:this.MAYBE
return r!=this.NO&&(point.shouldPreventDefault=!0),r},function attach(map,handlers){var point=map[Object.keys(map)[0]]
this.handlers=handlers||[],point.done$.addListener(this.onDone),this.pingHandlers("dragStart",point)},function pingHandlers(method,point){for(var i=0;i<this.handlers.length;i++){var h=this.handlers[i]
h&&h[method]&&h[method](point)}}],listeners:[{name:"onDone",code:function(obj,prop,old,nu){obj.done$.removeListener(this.onDone),this.pingHandlers("dragEnd",obj)}}],help:"Gesture that understands a hold and drag with mouse or one touch point."}),CLASS({"package":"foam.input.touch",name:"Gesture",properties:[{name:"name",required:!0}],constants:[{name:"YES",value:3},{name:"MAYBE",value:2},{name:"WAIT",value:1},{name:"NO",value:0}],methods:[function recognize(map){return this.NO},function attach(handlers){},function newPoint(point){}],help:"Installed in the GestureManager to watch for a particular kind of gesture"}),CLASS({"package":"foam.input.touch",name:"PinchTwistGesture",extendsModel:"foam.input.touch.Gesture",properties:[{name:"name",defaultValue:"pinchTwist"},{name:"handlers"},{name:"points"}],methods:[function getPoints(map){var keys=Object.keys(map)
return[map[keys[0]],map[keys[1]]]},function recognize(map){if(2!==Object.keys(map).length)return this.NO
var points=this.getPoints(map)
if(points[0].done||points[1].done)return this.NO
var moved=!(0===points[0].dx&&0===points[0].dy||0===points[1].dx&&0===points[1].dy)
return moved?this.YES:this.MAYBE},function attach(map,handlers){Object_forEach(map,function(p){p.shouldPreventDefault=!0}),this.points=this.getPoints(map),this.handlers=handlers||[],this.points.forEach(function(p){p.x$.addListener(this.onMove),p.y$.addListener(this.onMove),p.done$.addListener(this.onDone)}.bind(this)),this.pingHandlers("pinchStart"),this.onMove()},function pingHandlers(method,scale,rotation){for(var i=0;i<this.handlers.length;i++){var h=this.handlers[i]
h&&h[method]&&h[method](scale,rotation)}},function distance(x1,y1,x2,y2){var dx=x2-x1,dy=y2-y1
return Math.sqrt(dx*dx+dy*dy)}],listeners:[{name:"onMove",code:function(){for(var oldDist=this.distance(this.points[0].x0,this.points[0].y0,this.points[1].x0,this.points[1].y0),newDist=this.distance(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y),scale=newDist/oldDist,oldAngle=Math.atan2(this.points[1].y0-this.points[0].y0,this.points[1].x0-this.points[0].x0),newAngle=Math.atan2(this.points[1].y-this.points[0].y,this.points[1].x-this.points[0].x),rotation=newAngle-oldAngle;rotation<-Math.PI;)rotation+=2*Math.PI
for(;rotation>Math.PI;)rotation-=2*Math.PI
rotation*=360,rotation/=2*Math.PI,this.pingHandlers("pinchMove",scale,rotation)}},{name:"onDone",code:function(obj,prop,old,nu){this.points.forEach(function(p){p.x$.removeListener(this.onMove),p.y$.removeListener(this.onMove),p.done$.removeListener(this.onDone)}),this.pingHandlers("pinchEnd")}}],help:"Gesture that understands a two-finger pinch/stretch and rotation"}),CLASS({"package":"foam.input.touch",name:"ScrollGesture",extendsModel:"foam.input.touch.Gesture",properties:[{name:"name",factory:function(){return this.direction+"Scroll"+(this.momentumEnabled?"Momentum":this.nativeScrolling?"Native":"")}},{name:"direction",defaultValue:"vertical"},{name:"isVertical",factory:function(){return"vertical"===this.direction}},{name:"momentumEnabled",defaultValue:!1,help:'Set me to true (usually by attaching the "verticalScrollMomentum" gesture) to enable momentum'},{name:"nativeScrolling",defaultValue:!1,help:'Set me to true (usually by attaching the "verticalScrollNative" gesture) to enable native browser scrolling'},{name:"dragCoefficient",defaultValue:.94,help:"Each frame, the momentum will be multiplied by this coefficient. Higher means LESS drag."},{name:"dragClamp",defaultValue:.05,help:"The speed threshold (pixels/millisecond) below which the momentum drops to 0."},{name:"momentum",defaultValue:0,help:"The current speed, in pixels/millisecond, at which the scroller is sliding."},{name:"lastTime",hidden:!0,defaultValue:0,help:"The performance.now() value for the last time we computed the momentum slide."},{name:"tickRunning",hidden:!0,defaultValue:!1,help:"True when the physics tick should run."},{name:"handlers"}],constants:[{name:"DRAG_TOLERANCE",value:10}],methods:[function recognize(map){if(1!==Object.keys(map).length)return this.NO
var point=map[Object.keys(map)[0]]
if("mouse"===point.type||point.done)return this.NO
if(Math.abs(this.momentum)>0)return this.YES
var delta=Math.abs(this.isVertical?point.totalY:point.totalX)
return delta>this.DRAG_TOLERANCE?this.YES:this.MAYBE},function attach(map,handlers){var point=map[Object.keys(map)[0]]
this.handlers=handlers||[],this.nativeScrolling||(Object_forEach(map,function(p){p.shouldPreventDefault=!0}),(this.isVertical?point.y$:point.x$).addListener(this.onDelta),point.done$.addListener(this.onDone),0===this.momentum?this.pingHandlers(this.direction+"ScrollStart",0,0,this.isVertical?point.y0:point.x0):this.tickRunning=!1)},function pingHandlers(method,d,t,c){for(var i=0;i<this.handlers.length;i++){var h=this.handlers[i]
h&&h[method]&&h[method](d,t,c,this.stopMomentum)}},function sendEndEvent(point){var delta=this.isVertical?point.dy:point.dx,total=this.isVertical?point.totalY:point.totalX,current=this.isVertical?point.y:point.x
this.pingHandlers(this.direction+"ScrollEnd",delta,total,current)},function calculateInstantaneousVelocity(point){var now=this.X.performance.now(),lastTime=this.tickRunning?this.lastTime:point.lastTime,velocity=(this.isVertical?point.dy:point.dx)/(now-point.lastTime)
return this.tickRunning&&(this.lastTime=now),velocity}],listeners:[{name:"onDelta",code:function(obj,prop,old,nu){if(this.momentumEnabled){var velocity=this.calculateInstantaneousVelocity(obj),delta=velocity-this.momentum
this.momentum+=delta}var delta=this.isVertical?obj.dy:obj.dx,total=this.isVertical?obj.totalY:obj.totalX,current=this.isVertical?obj.y:obj.x
this.pingHandlers(this.direction+"ScrollMove",delta,total,current)}},{name:"onDone",code:function(obj,prop,old,nu){(this.isVertical?obj.y$:obj.x$).removeListener(this.onDelta),obj.done$.removeListener(this.onDone),this.momentumEnabled?Math.abs(this.momentum)<this.dragClamp?(this.momentum=0,this.sendEndEvent(obj)):(this.tickRunning=!0,this.lastTime=this.X.performance.now(),this.tick(obj)):this.sendEndEvent(obj)}},{name:"tick",code:function(touch){if(this.tickRunning){var xy=this.isVertical?"y":"x",now=this.X.performance.now(),elapsed=now-this.lastTime
this.lastTime=now
var distance=this.momentum*elapsed
touch[xy]+=distance
var delta,total,current
this.isVertical?(delta=touch.dy,total=touch.totalY,current=touch.y):(delta=touch.dx,total=touch.totalX,current=touch.x),0!=delta&&this.pingHandlers(this.direction+"ScrollMove",delta,total,current),this.momentum*=this.dragCoefficient,Math.abs(this.momentum)<this.dragClamp?(this.momentum=0,this.tickRunning=!1,this.sendEndEvent(touch)):this.tick(touch)}},isFramed:!0},{name:"stopMomentum",code:function(){this.momentum=0}}],help:"Gesture that understands vertical or horizontal scrolling."}),CLASS({"package":"foam.input.touch",name:"TapGesture",extendsModel:"foam.input.touch.Gesture",properties:[{name:"name",defaultValue:"tap"},{name:"handlers"}],constants:[{name:"DRAG_TOLERANCE",value:40}],methods:[function recognize(map){for(var response,doneCount=0,self=this,keys=Object.keys(map),i=0;i<keys.length;i++){var key=keys[i],p=map[key]
if(Math.abs(p.totalX)>=this.DRAG_TOLERANCE||Math.abs(p.totalY)>=this.DRAG_TOLERANCE)return this.NO
p.done&&doneCount++}return response===this.NO?response:doneCount===keys.length?this.YES:this.WAIT},function attach(map,handlers){if(handlers&&handlers.length){var points=0
Object_forEach(map,function(point){points++,point.shouldPreventDefault=!0}),handlers.forEach(function(h){h&&h.tapClick&&h.tapClick(map)})}}],help:"Gesture that understands a quick, possible multi-point tap. Calls into the handler: tapClick(numberOfPoints)."}),CLASS({"package":"foam.input.touch",name:"InputPoint",properties:[{name:"id"},{name:"type"},{model_:"BooleanProperty",name:"done"},{name:"x",postSet:function(old,nu){this.lastX=old}},{name:"y",postSet:function(old,nu){this.lastY=old}},{name:"x0",factory:function(){return this.x}},{name:"y0",factory:function(){return this.y}},{name:"lastX",factory:function(){return this.x}},{name:"lastY",factory:function(){return this.y}},{name:"dx",getter:function(){return this.x-this.lastX}},{name:"dy",getter:function(){return this.y-this.lastY}},{name:"totalX",getter:function(){return this.x-this.x0}},{name:"totalY",getter:function(){return this.y-this.y0}},{name:"lastTime"},{name:"shouldPreventDefault",defaultValue:!1}]}),CLASS({"package":"foam.input.touch",name:"TouchManager",requires:["foam.input.touch.InputPoint"],properties:[{name:"touches",factory:function(){return{}}}],constants:[{name:"TOUCH_START",value:["touch-start"]},{name:"TOUCH_END",value:["touch-end"]},{name:"TOUCH_MOVE",value:["touch-move"]}],methods:[function init(){this.SUPER(),this.X.document&&this.install(this.X.document)},function install(d){d.addEventListener("touchstart",this.onTouchStart)},function attach(e){e.addEventListener("touchmove",this.onTouchMove),e.addEventListener("touchend",this.onTouchEnd),e.addEventListener("touchcancel",this.onTouchCancel),e.addEventListener("touchleave",this.onTouchEnd)},function detach(e){e.removeEventListener("touchmove",this.onTouchMove),e.removeEventListener("touchend",this.onTouchEnd),e.removeEventListener("touchcancel",this.onTouchCancel),e.removeEventListener("touchleave",this.onTouchEnd)},function touchStart(i,t,e){this.touches[i]=this.InputPoint.create({id:i,type:"touch",x:t.pageX,y:t.pageY}),this.publish(this.TOUCH_START,this.touches[i])},function touchMove(i,t,e){var touch=this.touches[i]
touch.x=t.pageX,touch.y=t.pageY,touch.lastTime=this.X.performance.now(),touch.shouldPreventDefault&&e.preventDefault(),this.publish(this.TOUCH_MOVE,this.touch)},function touchEnd(i,t,e){var touch=this.touches[i]
touch.x=t.pageX,touch.y=t.pageY,touch.done=!0,this.publish(this.TOUCH_END,touch),touch.shouldPreventDefault&&e.cancelable&&e.preventDefault(),delete this.touches[i]},function touchCancel(i,t,e){this.touches[i].done=!0,this.publish(this.TOUCH_END,this.touches[i])},function touchLeave(i,t,e){this.touches[i].done=!0,this.publish(this.TOUCH_END,this.touches[i])}],listeners:[{name:"onTouchStart",code:function(e){e._touchcount||(e._touchcount=0),e._touchcount++,1==e._touchcount&&this.attach(e.target)
for(var i=0;i<e.changedTouches.length;i++){var t=e.changedTouches[i]
this.touchStart(t.identifier,t,e)}}},{name:"onTouchMove",code:function(e){for(var i=0;i<e.changedTouches.length;i++){var t=e.changedTouches[i],id=t.identifier
this.touches[id]?this.touchMove(id,t,e):console.warn("Touch move for unknown touch.")}}},{name:"onTouchEnd",code:function(e){e._touchcount--,0==e._touchcount&&this.detach(e.target)
for(var i=0;i<e.changedTouches.length;i++){var t=e.changedTouches[i],id=t.identifier
this.touches[id]?this.touchEnd(id,t,e):console.warn("Touch end for unknown touch "+id,Object.keys(this.touches))}}},{name:"onTouchCancel",code:function(e){this.detach(e.target)
for(var i=0;i<e.changedTouches.length;i++){var t=e.changedTouches[i],id=t.identifier
this.touches[id]?this.touchCancel(id,t,e):console.warn("Touch cancel for unknown touch.")}}},{name:"onTouchLeave",code:function(e){this.detach(e.target)
for(var i=0;i<e.changedTouches.length;i++){var t=e.changedTouches[i],id=t.identifier
this.touches[id]?this.touchLeave(id,t,e):console.warn("Touch cancel for unknown touch.")}}}]}),CLASS({"package":"foam.ui.md",name:"Flare",requires:["foam.graphics.Circle"],properties:[{name:"element"},{name:"color",defaultValue:"#aaaaaa"},{name:"startAlpha",defaultValue:1},{name:"startX",defaultValue:1},{name:"startY",defaultValue:1},{name:"startLocation",defaultValue:"percent"},{name:"cssPosition",defaultValue:"fixed"},{name:"flareState",defaultValue:"detached"},{model_:"IntProperty",name:"growTime",defaultValue:400},{model_:"IntProperty",name:"fadeTime",defaultValue:200}],listeners:[{name:"fire",code:function(){var w=this.element.offsetWidth,h=this.element.offsetHeight,x="percent"!==this.startLocation?this.startX:this.startX*w,y="percent"!==this.startLocation?this.startY:this.startY*h,c=this.Circle.create({r:0,width:w,height:h,x:x,y:y,color:this.color,alpha:this.startAlpha})
0==this.startX&&0==this.startY?(c.startAngle=1.5*Math.PI,c.endAngle=2*Math.PI):0==this.startX&&1==this.startY?(c.startAngle=0,c.endAngle=Math.PI/2):1==this.startX&&0==this.startY?(c.startAngle=Math.PI,c.endAngle=1.5*Math.PI):1==this.startX&&1==this.startY&&(c.startAngle=Math.PI/2,c.endAngle=Math.PI)
var view=c.toView_(),div=document.createElement("div"),dStyle=div.style
dStyle.position=this.cssPosition,dStyle.left=0,dStyle.top=0,dStyle.zIndex=4
var id=this.X.lookup("foam.ui.View").getPrototype().nextID()
div.id=id,div.innerHTML=view.toHTML(),this.flareState="growing",this.element.appendChild(div),view.initHTML(),Movement.compile([[this.growTime,function(){c.r=1.25*Math.sqrt(w*w+h*h)}],function(){this.flareState="fading"}.bind(this),[this.fadeTime,function(){c.alpha=0}],function(){div.remove(),this.flareState="detached"}.bind(this)])(),c.r$.addListener(EventService.framed(view.paint.bind(view))),c.alpha$.addListener(EventService.framed(view.paint.bind(view)))}}]}),CLASS({"package":"foam.ui",name:"DAOListView",extendsModel:"foam.ui.SimpleView",traits:["foam.ui.DAODataViewTrait"],requires:["SimpleValue"],properties:[{model_:"BooleanProperty",name:"isHidden",postSet:function(_,isHidden){this.dao&&!isHidden&&this.onDAOUpdate()},defaultValue:!1},{model_:"ViewFactoryProperty",name:"rowView",defaultValue:"foam.ui.DetailView"},{name:"mode",view:{factory_:"foam.ui.ChoiceView",choices:["read-only","read-write","final"]},defaultValue:"read-write"},{name:"useSelection",postSet:function(old,nu){this.useSelection&&!this.X.selection$&&(this.X.selection$=this.SimpleValue.create()),this.selection$=this.X.selection$},help:"Backward compatibility for selection mode. Create a X.selection$ value in your context instead."},{name:"selection",factory:function(){return this.SimpleValue.create()},help:"Backward compatibility for selection mode. Create a X.selection$ value in your context instead."},{name:"scrollContainer",help:"Containing element that is responsible for scrolling."},{name:"chunkSize",defaultValue:0,help:"Number of entries to load in each infinite scroll chunk."},{name:"chunksLoaded",defaultValue:1,help:"The number of chunks currently loaded."},{model_:"BooleanProperty",name:"painting","transient":!0,defaultValue:!1},{model_:"BooleanProperty",name:"repaintRequired","transient":!0,defaultValue:!1},{model_:"ArrayProperty",name:"propertyListeners_",lazyFactory:function(){return[]}}],constants:[{name:"ROW_CLICK",value:["row-click"]}],methods:[function init(){this.SUPER()
var self=this
this.subscribe(this.ON_HIDE,function(){self.isHidden=!0}),this.subscribe(this.ON_SHOW,function(){self.isHidden=!1}),this.X.selection$&&(this.selection$=this.X.selection$)},function initHTML(){if(this.SUPER(),this.chunkSize>0){for(var e=this.$;e&&"scroll"!==window.getComputedStyle(e).overflow;)e=e.parentElement
this.scrollContainer=e||window,this.scrollContainer.addEventListener("scroll",this.onScroll,!1)}this.isHidden||this.updateHTML()},function construct(){if(this.dao&&this.$){if(this.painting)return void(this.repaintRequired=!0)
this.painting=!0
var out=[]
this.children=[],this.initializers_=[]
var doneFirstItem=!1,d=this.dao
this.chunkSize&&(d=d.limit(this.chunkSize*this.chunksLoaded)),d.select({put:function(o){"read-write"===this.mode&&(o=o.model_.create(o,this.Y))
var view=this.rowView({data:o,model:o.model_},this.Y)
if(view.DAO=this.dao,"read-write"===this.mode&&this.addRowPropertyListener(o,view),this.addChild(view),doneFirstItem?this.separatorToHTML(out):doneFirstItem=!0,this.X.selection$){var itemId=this.on("click",function(){this.selection=o,this.publish(this.ROW_CLICK)}.bind(this))
this.setClass("dao-selected",function(){return equals(this.selection,o)}.bind(this),itemId),this.setClass(this.className+"-row",function(){return!0},itemId),out.push('<div id="'+itemId+'">')}out.push(view.toHTML()),this.X.selection$&&out.push("</div>")}.bind(this)})(function(){if(this.repaintRequired)return this.repaintRequired=!1,this.painting=!1,void this.realDAOUpdate()
var e=this.$
e&&(e.innerHTML=out.join(""),this.initInnerHTML(),this.painting=!1)}.bind(this))}},function destroy(isParentDestroyed){for(var listeners=this.propertyListeners_,i=0;i<listeners.length;++i)listeners[i].data.removePropertyListener(null,listeners[i].listener)
return this.propertyListeners_=[],this.SUPER(isParentDestroyed)},function fromElement(e){var children=e.children
1==children.length&&"rowView"===children[0].nodeName?this.SUPER(e):this.rowView=e.innerHTML},function separatorToHTML(out){},function addRowPropertyListener(data,view){var listener=function(o,topic){var prop=o.model_.getProperty(topic[1])
prop["transient"]||view.DAO.put(o.deepClone())}
data.addPropertyListener(null,listener),this.propertyListeners_.push({data:data,listener:listener})}],listeners:[{name:"onDAOUpdate",code:function(){this.realDAOUpdate()}},{name:"realDAOUpdate",code:function(){this.isHidden||this.updateHTML()},isFramed:!0},{name:"onScroll",code:function(){var e=this.scrollContainer
this.chunkSize>0&&e.scrollTop+e.offsetHeight>=e.scrollHeight&&(this.chunksLoaded++,this.updateHTML())}}]}),CLASS({"package":"foam.ui",name:"DAODataViewTrait",exports:["dao$ as daoViewCurrentDAO$"],properties:[{name:"data",preSet:function(old,nu){return this.dao!==nu&&(this.dao=nu),nu}},{model_:"foam.core.types.DAOProperty",name:"dao",label:"DAO",postSet:function(oldDAO,dao){dao?equals(this.data,dao)||(this.data=dao):this.data=""},help:"An alias for the data property.",onDAOUpdate:"onDAOUpdate"}],methods:[function onDAOUpdate(){}]}),CLASS({"package":"foam.core.types",name:"DAOProperty",extendsModel:"Property",requires:["foam.dao.FutureDAO","foam.dao.ProxyDAO"],imports:["console"],properties:[{name:"type",defaultValue:"DAO",help:"The FOAM type of this property."},{model_:"ModelProperty",name:"model",help:"The model for objects stored in the DAO."},{name:"view",defaultValue:"foam.ui.DAOListView"},{name:"onDAOUpdate"},{name:"install",defaultValue:function(prop){defineLazyProperty(this,prop.name+"$Proxy",function(){if(this[prop.name])delegate=this[prop.name]
else var future=afuture(),delegate=prop.FutureDAO.create({future:future.get})
var proxy=prop.ProxyDAO.create({delegate:delegate})
return this.addPropertyListener(prop.name,function(_,_,_,dao){return future?(future.set(dao),void(future=null)):void(proxy.delegate=dao)}),{get:function(){return proxy},configurable:!0}})}},{name:"fromElement_",defaultValue:function(e,p,model){for(var children=e.children,i=0;i<children.length;i++)this[p.name].put(model.create(null,this.Y).fromElement(children[i],p))}},{name:"fromElement",defaultValue:function(e,p){var model=e.getAttribute("model")||this[p.name]&&this[p.name].model||p.model||""
return model?void("string"==typeof model?this.X.arequire(model)(function(model){p.fromElement_.call(this,e,p,model)}.bind(this)):p.fromElement_.call(this,e,p,model)):void this.console.warn("Attempt to load DAO from element without model")}}],help:"Describes a DAO property."}),CLASS({"package":"foam.dao",name:"FutureDAO",extendsModel:"foam.dao.ProxyDAO",properties:[{name:"delegate",factory:function(){return null},postSet:function(oldDAO,newDAO){this.daoListeners_.length&&(oldDAO&&oldDAO.unlisten(this.relay()),newDAO.listen(this.relay()))}},{name:"future",required:!0},{name:"model",defaultValueFn:function(){return this.delegate?this.delegate.model:""}}],methods:[function init(){this.SUPER(),this.future(function(delegate){this.delegate=delegate}.bind(this))},function put(value,sink){this.delegate?this.delegate.put(value,sink):this.future(this.put.bind(this,value,sink))},function remove(query,sink){this.delegate?this.delegate.remove(query,sink):this.future(this.remove.bind(this,query,sink))},function removeAll(){if(this.delegate)return this.delegate.removeAll.apply(this.delegate,arguments)
var a=arguments,f=afuture()
return this.future(function(delegate){this.removeAll.apply(this,a)(f.set)}.bind(this)),f.get},function find(key,sink){this.delegate?this.delegate.find(key,sink):this.future(this.find.bind(this,key,sink))},function select(sink,options){if(this.delegate)return this.delegate.select(sink,options)
var a=arguments,f=afuture()
return this.future(function(){this.select.apply(this,a)(f.set)}.bind(this)),f.get}]}),CLASS({"package":"foam.dao",name:"ProxyDAO",extendsModel:"AbstractDAO",requires:["foam.dao.NullDAO"],properties:[{name:"delegate",type:"DAO",mode:"read-only",required:!0,hidden:!0,"transient":!0,factory:function(){return this.NullDAO.create()},postSet:function(oldDAO,newDAO){this.daoListeners_.length&&(oldDAO&&oldDAO.unlisten(this.relay()),newDAO.listen(this.relay()),this.X.lookup("foam.dao.FutureDAO")&&this.X.lookup("foam.dao.FutureDAO").isInstance(oldDAO)||this.notify_("reset",[]))}},{model_:"ModelProperty",name:"model",defaultValueFn:function(){return this.delegate.model},type:"Model"}],methods:[function relay(){if(!this.relay_){var self=this
this.relay_={put:function(){self.notify_("put",arguments)},remove:function(){self.notify_("remove",arguments)},reset:function(){self.notify_("reset",arguments)},toString:function(){return"RELAY("+this.$UID+", "+self.model_.name+", "+self.delegate+")"}}}return this.relay_},function put(value,sink){this.delegate.put(value,sink)},function remove(query,sink){this.delegate.remove(query,sink)},function removeAll(){return this.delegate.removeAll.apply(this.delegate,arguments)},function find(key,sink){this.delegate.find(key,sink)},function select(sink,options){return this.delegate.select(sink,options)},function listen(sink,options){!this.daoListeners_.length&&this.delegate&&this.delegate.listen(this.relay()),this.SUPER(sink,options)},function unlisten(sink){this.SUPER(sink),0===this.daoListeners_.length&&this.delegate&&this.delegate.unlisten(this.relay())},function toString(){return this.name_+"("+this.delegate+")"}]}),CLASS({"package":"foam.dao",name:"NullDAO",methods:[function put(obj,sink){sink&&sink.put&&sink.put(obj)},function remove(obj,sink){sink&&sink.remove&&sink.remove(obj)},function select(sink){return sink&&sink.eof&&sink.eof(),aconstant(sink||[].sink)},function find(q,sink){sink&&sink.error&&sink.error("find",q)},function listen(){},function removeAll(){},function unlisten(){},function pipe(){},function where(){return this},function limit(){return this},function skip(){return this},function orderBy(){return this}],help:"A DAO that stores nothing and does nothing."}),window.addEventListener("load",function(){apar(X.arequire("foam.apps.calc.CalcView"),X.arequire("Calc"))(function(v,c){X.writeView(v.create({data:c.create()}))})})

